<h1 id="nav_point_73">&#31532; 5 &#31456;&#12288;&#38754;&#21521;&#29983;&#20135;&#30340; Spring Boot</h1><blockquote>
<p><strong>&#26412;&#31456;&#20869;&#23481;</strong></p>
<ul>
<li class="&#31532;2&#32423;&#26080;&#24207;&#21015;&#34920;">&#36890;&#36807; Spring Boot Actuator &#20102;&#35299;&#36816;&#34892;&#24773;&#20917;</li>
<li class="&#31532;2&#32423;&#26080;&#24207;&#21015;&#34920;">&#23450;&#21046; Spring Boot Actuator &#30340;&#31471;&#28857;</li>
<li class="&#31532;2&#32423;&#26080;&#24207;&#21015;&#34920;">&#20351;&#29992; Micrometer &#36755;&#20986;&#24230;&#37327;&#25968;&#25454;</li>
<li class="&#31532;2&#32423;&#26080;&#24207;&#21015;&#34920;">Spring Boot &#24212;&#29992;&#31243;&#24207;&#30340;&#37096;&#32626;&#21450;&#21407;&#29702;</li>
</ul>
</blockquote><p>&#22312; 4.1.2 &#33410;&#20013;&#65292;&#25105;&#20204;&#20171;&#32461;&#20102; Spring Boot &#30340;&#22235;&#22823;&#26680;&#24515;&#32452;&#25104;&#37096;&#20998;&#65292;&#31532; 4 &#31456;&#20027;&#35201;&#20171;&#32461;&#20102;&#20854;&#20013;&#30340;&#36215;&#27493;&#20381;&#36182;&#19982;&#33258;&#21160;&#37197;&#32622;&#65292;&#26412;&#31456;&#23558;&#37325;&#28857;&#20171;&#32461; Spring Boot Actuator&#65292;&#21253;&#25324;&#22914;&#20309;&#36890;&#36807; Actuator &#25552;&#20379;&#30340;&#21508;&#31181;&#31471;&#28857;&#65288;endpoint&#65289;&#20102;&#35299;&#31995;&#32479;&#30340;&#36816;&#34892;&#24773;&#20917;&#65292;&#20351;&#29992; Micrometer &#20026;&#21508;&#31181;&#30417;&#25511;&#31995;&#32479;&#25552;&#20379;&#24230;&#37327;&#25351;&#26631;&#25968;&#25454;&#65292;&#26368;&#21518;&#36824;&#35201;&#20102;&#35299;&#22914;&#20309;&#25171;&#21253;&#37096;&#32626; Spring Boot &#24212;&#29992;&#31243;&#24207;&#12290;</p><h2 id="nav_point_74">5.1&#12288;Spring Boot Actuator &#27010;&#36848;</h2><p>Spring Boot Actuator &#26159; Spring Boot &#30340;&#37325;&#35201;&#21151;&#33021;&#27169;&#22359;&#65292;&#33021;&#20026;&#31995;&#32479;&#25552;&#20379;&#19968;&#31995;&#21015;&#22312;&#29983;&#20135;&#29615;&#22659;&#20013;&#36816;&#34892;&#25152;&#24517;&#38656;&#30340;&#21151;&#33021;&#65292;&#27604;&#22914;&#30417;&#25511;&#12289;&#24230;&#37327;&#12289;&#37197;&#32622;&#31649;&#29702;&#31561;&#12290;&#21482;&#38656;&#24341;&#20837; <code>org.springframework.boot:spring-boot-starter-actuator</code> &#36215;&#27493;&#20381;&#36182;&#21518;&#65292;&#25105;&#20204;&#23601;&#21487;&#20197;&#36890;&#36807; HTTP &#26469;&#35775;&#38382;&#36825;&#20123;&#21151;&#33021;&#65288;&#20063;&#21487;&#20197;&#20351;&#29992; JMX &#26469;&#35775;&#38382;&#65289;&#12290;Spring Boot &#36824;&#20026;&#25105;&#20204;&#39044;&#30041;&#20102;&#24456;&#22810;&#37197;&#32622;&#65292;&#21487;&#20197;&#26681;&#25454;&#33258;&#24049;&#30340;&#38656;&#27714;&#23545; Spring Boot Actuator &#30340;&#21151;&#33021;&#36827;&#34892;&#23450;&#21046;&#12290;</p><h3 id="nav_point_75">5.1.1&#12288;&#31471;&#28857;&#27010;&#35272;</h3><p>&#19981;&#30693;&#36947;&#22823;&#23478;&#26377;&#27809;&#26377;&#23581;&#35797;&#35299;&#20915;&#36807;&#31867;&#20284;&#19979;&#38754;&#30340;&#38382;&#39064;&#65306;</p><ul>
<li class="&#31532;1&#32423;&#26080;&#24207;&#21015;&#34920;">Spring &#19978;&#19979;&#25991;&#20013;&#21040;&#24213;&#23384;&#22312;&#21738;&#20123; Bean</li>
<li class="&#31532;1&#32423;&#26080;&#24207;&#21015;&#34920;">Spring Boot &#20013;&#30340;&#21738;&#20123;&#33258;&#21160;&#37197;&#32622;&#26368;&#32456;&#29983;&#25928;&#20102;</li>
<li class="&#31532;1&#32423;&#26080;&#24207;&#21015;&#34920;">&#24212;&#29992;&#31350;&#31455;&#33719;&#21462;&#21040;&#20102;&#21738;&#20123;&#37197;&#32622;&#39033;</li>
<li class="&#31532;1&#32423;&#26080;&#24207;&#21015;&#34920;">&#31995;&#32479;&#20013;&#23384;&#22312;&#21738;&#20123; URL&#65292;&#23427;&#20204;&#21448;&#26144;&#23556;&#21040;&#20102;&#21738;&#37324;</li>
</ul><p>&#22312;&#27809;&#26377; Spring Boot Actuator &#30340;&#26102;&#20505;&#65292;&#33719;&#21462;&#36825;&#20123;&#20449;&#24687;&#36824;&#26159;&#38656;&#35201;&#36153;&#19968;&#30058;&#21151;&#22827;&#30340;&#65307;&#20294;&#29616;&#22312;&#23601;&#19981;&#19968;&#26679;&#20102;&#65292;Spring Boot Actuator &#20869;&#32622;&#20102;&#22823;&#37327;&#30340;&#31471;&#28857;&#65292;&#36825;&#20123;&#31471;&#28857;&#21487;&#20197;&#24110;&#21161;&#22823;&#23478;&#20102;&#35299;&#31995;&#32479;&#20869;&#37096;&#30340;&#36816;&#34892;&#24773;&#20917;&#65292;&#24182;&#38024;&#23545;&#19968;&#20123;&#21151;&#33021;&#20570;&#20986;&#35843;&#25972;&#12290;</p><p>&#26681;&#25454;&#21151;&#33021;&#30340;&#19981;&#21516;&#65292;&#25105;&#20204;&#21487;&#20197;&#23558;&#36825;&#20123;&#31471;&#28857;&#21010;&#20998;&#25104;&#22235;&#31867;&#65306;&#20449;&#24687;&#31867;&#31471;&#28857;&#12289;&#30417;&#25511;&#31867;&#31471;&#28857;&#12289;&#25805;&#20316;&#31867;&#31471;&#28857;&#12289;&#38598;&#25104;&#31867;&#31471;&#28857;&#65292;&#20854;&#20013;&#37096;&#20998;&#31471;&#28857;&#38656;&#35201;&#24341;&#20837;&#29305;&#23450;&#30340;&#20381;&#36182;&#65292;&#25110;&#32773;&#37197;&#32622;&#29305;&#23450;&#30340; Bean&#12290;&#25509;&#19979;&#26469;&#25105;&#20204;&#20250;&#20381;&#27425;&#20171;&#32461;&#36825;&#22235;&#31867;&#31471;&#28857;&#65292;&#39318;&#20808;&#26159;&#29992;&#20110;&#33719;&#21462;&#31995;&#32479;&#36816;&#34892;&#20449;&#24687;&#30340;&#31471;&#28857;&#65292;&#22914;&#34920; 5-1 &#25152;&#31034;&#12290;</p><p><strong>&#34920; 5-1&#12288;Spring Boot Actuator &#20013;&#30340;&#20449;&#24687;&#31867;&#31471;&#28857;&#21015;&#34920;</strong></p><table border="1" width="90%">
<thead>
<tr>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#31471;&#28857; ID</p></th>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#40664;&#35748;&#24320;&#21551; HTTP</p></th>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#40664;&#35748;&#24320;&#21551; JMX</p></th>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#31471;&#28857;&#35828;&#26126;</p></th>
</tr>
</thead>
<tbody>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>auditevents</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21542;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#25552;&#20379;&#31995;&#32479;&#30340;&#23457;&#35745;&#20449;&#24687;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>beans</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21542;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#25552;&#20379;&#31995;&#32479;&#20013;&#30340; Bean &#21015;&#34920;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>caches</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21542;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#25552;&#20379;&#31995;&#32479;&#20013;&#30340;&#32531;&#23384;&#20449;&#24687;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>conditions</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21542;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#25552;&#20379;&#37197;&#32622;&#31867;&#30340;&#21305;&#37197;&#24773;&#20917;&#21450;&#26465;&#20214;&#36816;&#31639;&#32467;&#26524;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>configprops</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21542;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#25552;&#20379; <code>@ConfigurationProperties</code> &#30340;&#21015;&#34920;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>env</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21542;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#25552;&#20379; <code>ConfigurableEnvironment</code> &#20013;&#30340;&#23646;&#24615;&#20449;&#24687;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>flyway</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21542;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#25552;&#20379;&#24050;&#25191;&#34892;&#30340; Flyway &#25968;&#25454;&#24211;&#36801;&#31227;&#20449;&#24687;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>httptrace</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21542;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#25552;&#20379; HTTP &#36319;&#36394;&#20449;&#24687;&#65292;&#40664;&#35748;&#26368;&#36817; 100 &#26465;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>info</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26174;&#31034;&#20107;&#20808;&#35774;&#32622;&#22909;&#30340;&#31995;&#32479;&#20449;&#24687;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>integrationgraph</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21542;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#25552;&#20379; Spring Integration &#22270;&#20449;&#24687;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>liquibase</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21542;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#25552;&#20379;&#24050;&#25191;&#34892;&#30340; Liquibase &#25968;&#25454;&#24211;&#36801;&#31227;&#20449;&#24687;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>logfile</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21542;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26080;&#27492;&#21151;&#33021;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#22914;&#26524;&#35774;&#32622;&#20102; <code>logging.file.name</code> &#25110; <code>logging.file.path</code> &#23646;&#24615;&#65292;&#21017;&#26174;&#31034;&#26085;&#24535;&#25991;&#20214;&#20869;&#23481;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>mappings</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21542;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#25552;&#20379; <code>@RequestMapping</code> &#30340;&#26144;&#23556;&#21015;&#34920;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>scheduledtasks</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21542;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#25552;&#20379;&#31995;&#32479;&#20013;&#30340;&#35843;&#24230;&#20219;&#21153;&#21015;&#34920;</p></td>
</tr>
</tbody>
</table><p>&#31532;&#20108;&#31867;&#31471;&#28857;&#26159;&#30417;&#25511;&#19982;&#24230;&#37327;&#30456;&#20851;&#30340;&#31471;&#28857;&#65292;&#20855;&#20307;&#22914;&#34920; 5-2 &#25152;&#31034;&#12290;</p><p><strong>&#34920; 5-2&#12288;Spring Boot Actuator &#20013;&#30340;&#30417;&#25511;&#31867;&#31471;&#28857;&#21015;&#34920;</strong></p><table border="1" width="90%">
<thead>
<tr>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#31471;&#28857; ID</p></th>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#40664;&#35748;&#24320;&#21551; HTTP</p></th>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#40664;&#35748;&#24320;&#21551; JMX</p></th>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#31471;&#28857;&#35828;&#26126;</p></th>
</tr>
</thead>
<tbody>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>health</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#25552;&#20379;&#31995;&#32479;&#36816;&#34892;&#30340;&#20581;&#24247;&#29366;&#24577;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>metrics</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21542;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#25552;&#20379;&#31995;&#32479;&#30340;&#24230;&#37327;&#20449;&#24687;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>prometheus</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21542;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26080;&#27492;&#21151;&#33021;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#25552;&#20379; Prometheus &#31995;&#32479;&#21487;&#35299;&#26512;&#30340;&#24230;&#37327;&#20449;&#24687;</p></td>
</tr>
</tbody>
</table><p>&#25105;&#20204;&#23545;&#31532; 1 &#31456;&#30340; <code>helloworld</code> &#31034;&#20363;&#31245;&#20316;&#35843;&#25972;&#65292;&#22312;&#20854; pom.xml &#30340; <code>&lt;dependencies/&gt;</code> &#20013;&#22686;&#21152;&#22914;&#19979;&#20869;&#23481;&#21363;&#21487;&#24341;&#20837; Spring Boot Actuator &#30340;&#20381;&#36182;&#65306;</p><pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre><p>&#20174;&#19978;&#36848;&#20004;&#24352;&#34920;&#20013;&#25105;&#20204;&#21487;&#20197;&#21457;&#29616;&#65292;&#40664;&#35748;&#21482;&#26377; <code>info</code> &#21644; <code>health</code> &#20004;&#20010;&#31471;&#28857;&#26159;&#24320;&#21551;&#20102; HTTP &#35775;&#38382;&#30340;&#65292;&#22240;&#27492;&#22312;&#36816;&#34892;&#31243;&#24207;&#21518;&#65292;&#36890;&#36807;&#27983;&#35272;&#22120;&#25110;&#32773;&#20854;&#20182;&#26041;&#24335;&#35775;&#38382; <code>http://localhost:8080/actuator/health</code> &#23601;&#33021;&#35775;&#38382;&#21040; <code>health</code> &#31471;&#28857;&#30340;&#20449;&#24687;&#12290;&#22914;&#26524;&#22312; macOS &#25110; Linux &#19978;&#65292;&#25105;&#20204;&#21487;&#20197;&#20351;&#29992; <code>curl</code> &#21629;&#20196; <span class="&#27880;&#37322;&#32534;&#21495;">1</span>&#65292;&#20855;&#20307;&#36816;&#34892;&#32467;&#26524;&#22914;&#19979;&#65306;</p><p class="&#27880;&#37322;&#20869;&#23481;"><span class="&#27880;&#37322;&#32534;&#21495;&#19979;">1</span>&#22312; Windows &#19978;&#65292;&#25105;&#20204;&#20063;&#21487;&#20197;&#36890;&#36807; Cygwin &#26469;&#23433;&#35013; <code>curl</code> &#21629;&#20196;&#12290;</p><pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>&#9656; curl -v http://localhost:8080/actuator/health

*   Trying ::1...
* TCP_NODELAY set
* Connected to localhost (::1) port 8080 (#0)
&gt; GET /actuator/health HTTP/1.1
&gt; Host: localhost:8080
&gt; User-Agent: curl/7.64.1
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 200
&lt; Content-Type: application/vnd.spring-boot.actuator.v3+json
&lt; Transfer-Encoding: chunked
&lt; Date: Fri, 10 Jul 2020 15:38:54 GMT
&lt;
* Connection #0 to host localhost left intact
{"status":"UP"}* Closing connection 0</code></pre><p>&#22914;&#26524;&#20351;&#29992;&#27983;&#35272;&#22120;&#65292;&#35775;&#38382;&#30340;&#25928;&#26524;&#22914;&#22270; 5-1 &#25152;&#31034; <span class="&#27880;&#37322;&#32534;&#21495;">2</span>&#12290;</p><p class="&#27880;&#37322;&#20869;&#23481;"><span class="&#27880;&#37322;&#32534;&#21495;&#19979;">2</span>&#26412;&#20070;&#31034;&#20363;&#20013;&#20351;&#29992;&#20102; Chrome &#27983;&#35272;&#22120;&#65292;&#24182;&#23433;&#35013;&#20102; JSON Viewer &#25554;&#20214;&#20197;&#26041;&#20415;&#26597;&#30475; JSON &#26684;&#24335;&#30340;&#36755;&#20986;&#12290;</p><p class="&#22270;"><img alt="{%}" src="file:///[PrimaryStorage]local_pic/XueTouSpring_CongRuMenDaoXiangMuShiZhan/image00761.jpeg"/></p><p class="p-img-title"><strong>&#22270; 5-1&#12288;&#36890;&#36807; Chrome &#27983;&#35272;&#22120;&#26597;&#30475; <code>health</code> &#31471;&#28857;</strong></p><p>&#31532;&#19977;&#31867;&#31471;&#28857;&#21487;&#20197;&#25191;&#34892;&#19968;&#20123;&#23454;&#38469;&#30340;&#25805;&#20316;&#65292;&#20363;&#22914;&#35843;&#25972;&#26085;&#24535;&#32423;&#21035;&#65292;&#20855;&#20307;&#22914;&#34920; 5-3 &#25152;&#31034;&#12290;</p><p><strong>&#34920; 5-3&#12288;Spring Boot Actuator &#20013;&#30340;&#25805;&#20316;&#31867;&#31471;&#28857;&#21015;&#34920;</strong></p><table border="1" width="90%">
<thead>
<tr>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#31471;&#28857; ID</p></th>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#40664;&#35748;&#24320;&#21551; HTTP</p></th>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#40664;&#35748;&#24320;&#21551; JMX</p></th>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#31471;&#28857;&#35828;&#26126;</p></th>
</tr>
</thead>
<tbody>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>heapdump</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21542;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26080;&#27492;&#21151;&#33021;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#25191;&#34892; Heap Dump &#25805;&#20316;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>loggers</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21542;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26597;&#30475;&#24182;&#20462;&#25913;&#26085;&#24535;&#20449;&#24687;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>sessions</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21542;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#38024;&#23545;&#20351;&#29992;&#20102; Spring Session &#30340;&#31995;&#32479;&#65292;&#21487;&#33719;&#21462;&#25110;&#21024;&#38500;&#29992;&#25143;&#30340; Session</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>shutdown</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21542;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21542;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#20248;&#38597;&#22320;&#20851;&#38381;&#31995;&#32479;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>threaddump</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21542;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#25191;&#34892; Thread Dump &#25805;&#20316;</p></td>
</tr>
</tbody>
</table><p>&#26368;&#21518;&#19968;&#31867;&#31471;&#28857;&#27604;&#36739;&#29305;&#27530;&#65292;&#23427;&#30340;&#21151;&#33021;&#19982;&#38598;&#25104;&#26377;&#20851;&#65292;&#23601;&#21482;&#26377;&#19968;&#20010; <code>jolokia</code>&#65292;&#35265;&#34920; 5-4&#12290;</p><p><strong>&#34920; 5-4&#12288;Spring Boot Actuator &#20013;&#30340;&#38598;&#25104;&#31867;&#31471;&#28857;&#21015;&#34920;</strong></p><table border="1" width="90%">
<thead>
<tr>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#31471;&#28857; ID</p></th>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#40664;&#35748;&#24320;&#21551; HTTP</p></th>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#40664;&#35748;&#24320;&#21551; JMX</p></th>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#31471;&#28857;&#35828;&#26126;</p></th>
</tr>
</thead>
<tbody>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>jolokia</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21542;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26080;&#27492;&#21151;&#33021;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#36890;&#36807; HTTP &#26469;&#21457;&#24067; JMX Bean</p></td>
</tr>
</tbody>
</table><h3 id="nav_point_76">5.1.2&#12288;&#31471;&#28857;&#37197;&#32622;</h3><p>&#22312;&#20102;&#35299;&#20102; Spring Boot &#25552;&#20379;&#30340;&#31471;&#28857;&#21518;&#65292;&#25105;&#20204;&#23601;&#35201;&#23558;&#23427;&#20204;&#25237;&#20837;&#20855;&#20307;&#30340;&#29983;&#20135;&#20351;&#29992;&#24403;&#20013;&#20102;&#12290;Spring Boot Actuator &#38750;&#24120;&#28789;&#27963;&#65292;&#23427;&#25552;&#20379;&#20102;&#22823;&#37327;&#30340;&#24320;&#20851;&#37197;&#32622;&#65292;&#36824;&#26377;&#20004;&#31181;&#19981;&#21516;&#30340;&#35775;&#38382;&#26041;&#24335;&#21487;&#20379;&#25105;&#20204;&#36873;&#25321;&#12290;&#25509;&#19979;&#26469;&#22823;&#23478;&#23601;&#26469;&#19968;&#36215;&#20102;&#35299;&#19968;&#19979;&#36825;&#20123;&#37197;&#32622;&#12290;</p><ol>
<li><p><strong>&#24320;&#21551;&#25110;&#31105;&#29992;&#31471;&#28857;</strong></p>
<p>&#40664;&#35748;&#24773;&#20917;&#19979;&#65292;&#38500;&#20102; <code>shutdown</code> &#20197;&#22806;&#65292;&#25152;&#26377;&#30340;&#31471;&#28857;&#37117;&#26159;&#22788;&#20110;&#24320;&#21551;&#29366;&#24577;&#30340;&#65292;&#21482;&#26159;&#35775;&#38382;&#26041;&#24335;&#19981;&#21516;&#65292;&#25110;&#32773;&#20445;&#25252;&#29366;&#24577;&#19981;&#21516;&#12290;&#22914;&#26524;&#35201;&#24320;&#21551;&#25110;&#32773;&#31105;&#29992;&#26576;&#20010;&#31471;&#28857;&#65292;&#21487;&#20197;&#35843;&#25972; <code>management.endpoint.&lt;id&gt;.enabled</code> &#23646;&#24615;&#12290;&#20363;&#22914;&#65292;&#24819;&#35201;&#24320;&#21551; <code>shutdown</code> &#31471;&#28857;&#65292;&#23601;&#21487;&#20197;&#36825;&#26679;&#37197;&#32622;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>management.endpoint.shutdown.enabled=true</code></pre>
<p>&#20063;&#21487;&#20197;&#35843;&#25972;&#40664;&#35748;&#20540;&#65292;&#31105;&#29992;&#25152;&#26377;&#31471;&#28857;&#65292;&#38543;&#21518;&#24320;&#21551;&#25351;&#23450;&#31471;&#28857;&#12290;&#20363;&#22914;&#65292;&#21482;&#24320;&#21551; <code>health</code> &#31471;&#28857;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>management.endpoints.enabled-by-default=false
management.endpoint.health.enabled=true</code></pre>
<p>&#160;</p>
</li>
<li><p><strong>&#36890;&#36807; HTTP &#35775;&#38382;&#31471;&#28857;</strong></p>
<p>&#40664;&#35748;&#20165;&#26377; <code>health</code> &#21644; <code>info</code> &#31471;&#28857;&#26159;&#21487;&#20197;&#36890;&#36807; HTTP &#26041;&#24335;&#26469;&#35775;&#38382;&#30340;&#65292;&#22312; 5.1.1 &#33410;&#20013;&#65292;&#25105;&#20204;&#24050;&#32463;&#30475;&#21040;&#20102;&#22914;&#20309;&#36890;&#36807; <code>curl</code> &#21629;&#20196;&#21644;&#27983;&#35272;&#22120;&#26469;&#35775;&#38382; <code>health</code> &#31471;&#21475;&#12290;&#37027;&#22914;&#20309;&#25165;&#33021;&#24320;&#21551;&#20854;&#20182;&#31471;&#28857;&#30340; HTTP &#35775;&#38382;&#21151;&#33021;&#21602;&#65311;&#21487;&#20197;&#20351;&#29992; <code>management.endpoints.web.exposure.include</code> &#21644; <code>management.endpoints.web.exposure.exclude</code> &#36825;&#20004;&#20010;&#23646;&#24615;&#26469;&#25511;&#21046;&#21738;&#20123;&#31471;&#28857;&#21487;&#20197;&#36890;&#36807; HTTP &#26041;&#24335;&#21457;&#24067;&#65292;&#21738;&#20123;&#31471;&#28857;&#19981;&#34892;&#12290;&#21069;&#32773;&#30340;&#40664;&#35748;&#20540;&#20026; <code>health,info</code>&#65292;&#21518;&#32773;&#30340;&#40664;&#35748;&#20540;&#20026;&#31354;&#12290;</p>
<p>&#20363;&#22914;&#65292;&#25105;&#20204;&#24076;&#26395;&#22312;&#21407;&#26377;&#22522;&#30784;&#19978;&#20877;&#22686;&#21152; <code>beans</code> &#21644; <code>env</code> &#31471;&#28857;&#65292;&#23601;&#21487;&#20197;&#36825;&#26679;&#26469;&#35774;&#32622;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>management.endpoints.web.exposure.include=beans,env,health,info</code></pre>
<p>&#22914;&#26524;&#24076;&#26395;&#25918;&#24320;&#25152;&#26377;&#30340;&#31471;&#28857;&#65292;&#35753;&#23427;&#20204;&#37117;&#33021;&#36890;&#36807; HTTP &#26041;&#24335;&#26469;&#35775;&#38382;&#65292;&#25105;&#20204;&#23601;&#21487;&#20197;&#23558;&#19978;&#36848;&#23646;&#24615;&#35774;&#32622;&#20026; <code>*</code><span class="&#27880;&#37322;&#32534;&#21495;">3</span>&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>management.endpoints.web.exposure.include=*</code></pre>
<p>&#35201;&#26159;&#19968;&#20010;&#31471;&#28857;&#21516;&#26102;&#20986;&#29616;&#22312; <code>management.endpoints.web.exposure.include</code> &#21644; <code>management.endpoints.web.exposure.exclude</code> &#36825;&#20004;&#20010;&#23646;&#24615;&#37324;&#65292;&#37027;&#20040;&#21518;&#32773;&#30340;&#20248;&#20808;&#32423;&#20250;&#39640;&#20110;&#21069;&#32773;&#65292;&#20063;&#23601;&#26159;&#35828;&#35813;&#31471;&#28857;&#20250;&#34987;&#25490;&#38500;&#12290;</p>
<p>&#22914;&#26524;&#25105;&#20204;&#24076;&#26395;&#20102;&#35299; HTTP &#26041;&#24335;&#21487;&#20197;&#35775;&#38382;&#21738;&#20123;&#31471;&#28857;&#65292;&#21487;&#20197;&#30452;&#25509;&#35775;&#38382; <code>/actuator</code> &#22320;&#22336;&#65292;&#20250;&#24471;&#21040;&#31867;&#20284;&#19979;&#38754;&#30340; JSON &#20449;&#24687;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>{
    "_links": {
        "health": {
            "href": "http://localhost:8080/actuator/health",
            "templated": false
        },
        "health-path": {
            "href": "http://localhost:8080/actuator/health/{*path}",
            "templated": true
        },
        "info": {
            "href": "http://localhost:8080/actuator/info",
            "templated": false
        },
        "self": {
            "href": "http://localhost:8080/actuator",
            "templated": false
        }
    }
}</code></pre>
<p>&#20854;&#20013; <code>templated</code> &#20026; <code>true</code> &#30340; URL &#21487;&#20197;&#29992;&#20855;&#20307;&#30340;&#20540;&#21435;&#20195;&#26367; <code>{}</code> &#37324;&#30340;&#20869;&#23481;&#65292;&#27604;&#22914;&#65292;<code>http://localhost:8080/actuator/metrics/{requiredMetricName}</code> &#30340; <code>{requiredMetricName}</code> &#23601;&#21487;&#20197;&#29992; <code>http://localhost:8080/actuator/metrics</code> &#37324;&#25152;&#32599;&#21015;&#30340;&#21517;&#31216;&#20195;&#26367;&#12290;</p>
<p>&#38656;&#35201;&#29305;&#21035;&#35828;&#26126;&#19968;&#28857;&#65292;&#35201;&#21457;&#24067; HTTP &#31471;&#28857;&#65292;&#24517;&#39035;&#35201;&#26377; Web &#25903;&#25345;&#65292;&#22240;&#27492;&#39033;&#30446;&#38656;&#35201;&#24341;&#20837; <code>spring-boot-starter-web</code> &#36215;&#27493;&#20381;&#36182;&#12290;</p>
<p>&#160;</p>
</li>
<li><p><strong>&#36890;&#36807; JMX &#35775;&#38382;&#31471;&#28857;</strong></p>
<p>&#19982; HTTP &#26041;&#24335;&#31867;&#20284;&#65292;JMX &#20063;&#26377;&#20004;&#20010;&#23646;&#24615;&#65292;&#21363; <code>management.endpoints.jmx.exposure.include</code> &#21644; <code>management.endpoints.jmx.exposure.exclude</code>&#12290;&#21069;&#32773;&#30340;&#40664;&#35748;&#20540;&#20026; <code>*</code>&#65292;&#21518;&#32773;&#30340;&#40664;&#35748;&#20540;&#20026;&#31354;&#12290;</p>
<p>&#26377;&#19981;&#23569;&#24037;&#20855;&#21487;&#20197;&#29992;&#26469;&#35775;&#38382; JMX &#31471;&#28857;&#65292;&#27604;&#22914; JVisualVM &#21644; JConsole&#65292;&#23427;&#20204;&#37117;&#26159; JDK &#33258;&#24102;&#30340;&#24037;&#20855;&#12290;&#20197; JConsole &#20026;&#20363;&#65292;&#21551;&#21160; JConsole &#21518;&#20250;&#24377;&#20986;&#26032;&#24314;&#36830;&#25509;&#30028;&#38754;&#65292;&#20174;&#20013;&#21487;&#20197;&#36873;&#25321;&#24819;&#35201;&#36830;&#25509;&#30340;&#26412;&#22320; Java &#36827;&#31243;&#65292;&#20063;&#21487;&#20197;&#36890;&#36807;&#25351;&#23450;&#20449;&#24687;&#36830;&#25509;&#36828;&#31243;&#30340;&#36827;&#31243;&#65292;&#20855;&#20307;&#22914;&#22270; 5-2 &#25152;&#31034;&#12290;</p>
<p class="p-img"><img alt="{%}" src="file:///[PrimaryStorage]local_pic/XueTouSpring_CongRuMenDaoXiangMuShiZhan/image00762.jpeg"/></p>
<p class="p-img-title"><strong>&#22270; 5-2&#12288;JConsole &#30340;&#26032;&#24314;&#36830;&#25509;&#30028;&#38754;</strong></p>
<p>&#36873;&#20013;&#30446;&#26631;&#36827;&#31243;&#21518;&#65292;&#28857;&#20987;&#36830;&#25509;&#25353;&#38062;&#65292;&#31245;&#36807;&#19968;&#27573;&#26102;&#38388;&#21518;&#65292;&#23601;&#33021;&#36830;&#19978;&#30446;&#26631;&#36827;&#31243;&#20102;&#12290;&#38543;&#21518;&#36873;&#20013; MBean &#26631;&#31614;&#39029;&#65292;&#22312; <code>org.springframework.boot</code> &#30446;&#24405;&#19979;&#25214;&#21040; <code>Endpoint</code>&#65292;&#20854;&#20013;&#21015;&#20986;&#30340;&#23601;&#26159;&#21487;&#20197;&#35775;&#38382;&#30340; JMX &#31471;&#28857;&#12290;&#22270; 5-3 &#23601;&#26159;&#36873;&#25321;&#20102; <code>Health</code> &#21518;&#30028;&#38754;&#30340;&#26679;&#23376;&#65292;&#28857;&#20987; <code>health</code> &#25353;&#38062;&#21363;&#21487;&#33719;&#24471;&#20581;&#24247;&#26816;&#26597;&#30340; JSON &#32467;&#26524;&#12290;</p>
<p class="p-img"><img alt="{%}" src="file:///[PrimaryStorage]local_pic/XueTouSpring_CongRuMenDaoXiangMuShiZhan/image00763.jpeg"/></p>
<p class="p-img-title"><strong>&#22270; 5-3&#12288;&#36890;&#36807; JMX &#26041;&#24335;&#35775;&#38382; <code>health</code> &#31471;&#28857;</strong></p>
<p>&#160;</p>
</li>
<li><p><strong>&#20445;&#25252;&#31471;&#28857;</strong></p>
<p>&#22914;&#26524;&#22312;&#24037;&#31243;&#20013;&#24341;&#20837;&#20102; Spring Security&#65292;&#37027;&#20040; Spring Boot Actuator &#20250;&#33258;&#21160;&#23545;&#21508;&#31181;&#31471;&#28857;&#36827;&#34892;&#20445;&#25252;&#65292;&#20363;&#22914;&#65292;&#40664;&#35748;&#36890;&#36807;&#27983;&#35272;&#22120;&#35775;&#38382;&#26102;&#65292;&#27983;&#35272;&#22120;&#20250;&#26174;&#31034;&#19968;&#20010;&#39029;&#38754;&#65292;&#35201;&#27714;&#36755;&#20837;&#29992;&#25143;&#21517;&#21644;&#23494;&#30721;&#12290;&#22914;&#26524;&#25105;&#20204;&#27809;&#26377;&#37197;&#32622;&#36807;&#30456;&#20851;&#20449;&#24687;&#65292;&#37027;&#20040;&#22312;&#31995;&#32479;&#21551;&#21160;&#26102;&#65292;&#21487;&#20197;&#22312;&#26085;&#24535;&#20013;&#26597;&#25214;&#31867;&#20284;&#19979;&#38754;&#30340;&#26085;&#24535;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>Using generated security password: 4fbc8059-fdb8-46f9-a54e-21d5cb2e9eb2</code></pre>
<p>&#40664;&#35748;&#30340;&#29992;&#25143;&#21517;&#26159; <code>user</code>&#65292;&#23494;&#30721;&#23601;&#26159;&#19978;&#38754;&#36825;&#27573;&#38543;&#26426;&#29983;&#25104;&#30340;&#20869;&#23481;&#12290;&#20851;&#20110; Spring Security &#30340;&#26356;&#22810;&#32454;&#33410;&#65292;&#25105;&#20204;&#20250;&#22312;&#31532; 10 &#31456;&#20013;&#35814;&#32454;&#23637;&#24320;&#12290;&#27492;&#22788;&#65292;&#32473;&#20986;&#20004;&#20010;&#31034;&#20363;&#65292;&#23427;&#20204;&#37117;&#38656;&#35201;&#22312; pom.xml &#20013;&#22686;&#21152; <code>spring-boot-starter-actuator</code> &#21644; <code>spring-boot-starter-security</code> &#36215;&#27493;&#20381;&#36182;&#12290;&#36825;&#37324;&#20808;&#26469;&#28436;&#31034;&#22914;&#20309;&#19981;&#29992;&#30331;&#24405;&#39029;&#65292;&#32780;&#26159;&#20351;&#29992; HTTP Basic &#30340;&#26041;&#24335;&#36827;&#34892;&#39564;&#35777;&#65288;&#20294; <code>health</code> &#31471;&#28857;&#38500;&#22806;&#65289;&#65292;&#20855;&#20307;&#30340;&#37197;&#32622;&#22914;&#20195;&#30721;&#31034;&#20363; 5-1 &#25152;&#31034; <span class="&#27880;&#37322;&#32534;&#21495;">4</span>&#65292;&#27880;&#24847;&#20854;&#20013;&#30340; <code>EndpointRequest</code> &#29992;&#30340;&#26159; <code>org.springframework.boot.actuate.autoconfigure.security.servlet.EndpointRequest</code>&#12290;</p>
<blockquote>
<p><strong>&#20195;&#30721;&#31034;&#20363; 5-1</strong>&#12288;&#38656;&#35201;&#35748;&#35777;&#25165;&#21487;&#35775;&#38382;&#31471;&#28857;&#30340;&#37197;&#32622;&#20195;&#30721;&#29255;&#27573;</p>
</blockquote>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>@Configuration
public class ActuatorSecurityConfigurer extends WebSecurityConfigurerAdapter {
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.requestMatcher(EndpointRequest.toAnyEndpoint().excluding("health")).
authorizeRequests((requests) -&gt; requests.anyRequest().authenticated());
        http.httpBasic();
    }
}</code></pre>
<p>&#31532;&#20108;&#20010;&#28436;&#31034;&#38024;&#23545;&#25152;&#26377;&#31471;&#28857;&#65292;&#21487;&#20197;&#25552;&#20379;&#21311;&#21517;&#35775;&#38382;&#65292;&#20855;&#20307;&#22914;&#20195;&#30721;&#31034;&#20363; 5-2 &#25152;&#31034;&#12290;</p>
<blockquote>
<p><strong>&#20195;&#30721;&#31034;&#20363; 5-2</strong>&#12288;&#21487;&#21311;&#21517;&#35775;&#38382;&#31471;&#28857;&#30340;&#37197;&#32622;&#20195;&#30721;&#29255;&#27573;</p>
</blockquote>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>@Configuration
public class ActuatorSecurityConfigurer extends WebSecurityConfigurerAdapter {
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.requestMatcher(EndpointRequest.toAnyEndpoint()).authorizeRequests((requests) -&gt; requests.
anyRequest().anonymous());
        http.httpBasic();
    }
}</code></pre>
<blockquote>
<p><strong>&#33590;&#27463;&#26102;&#38388;&#65306;&#38024;&#23545; Web &#21644; Actuator &#20351;&#29992;&#19981;&#21516;&#31471;&#21475;&#30340;&#22909;&#22788;</strong></p>
<p>&#35797;&#24819;&#19968;&#19979;&#65292;&#25105;&#20204;&#30340;&#31995;&#32479;&#22312;&#23545;&#22806;&#25552;&#20379; HTTP &#26381;&#21153;&#65292;&#19968;&#33324;&#20250;&#22312;&#38598;&#32676;&#21069;&#22686;&#21152;&#19968;&#20010;&#36127;&#36733;&#22343;&#34913;&#35774;&#22791;&#65288;&#27604;&#22914; Nginx&#65289;&#65292;&#23558;&#22806;&#37096;&#23545; <code>80</code> &#31471;&#21475;&#30340;&#35831;&#27714;&#36716;&#21457;&#33267;&#31995;&#32479;&#30340; <code>8080</code> &#31471;&#21475;&#12290;&#22914;&#26524; Spring Boot Actuator &#30340;&#31471;&#21475;&#20063;&#22312; <code>8080</code>&#65292;&#32780;&#25105;&#20204;&#21448;&#27809;&#23545;&#31471;&#28857;&#20570;&#36275;&#22815;&#30340;&#20445;&#25252;&#65292;&#40657;&#23458;&#24456;&#36731;&#26494;&#22320;&#23601;&#33021;&#33719;&#21462;&#31995;&#32479;&#30340;&#20449;&#24687;&#12290;&#23601;&#31639;&#20570;&#20102;&#20445;&#25252;&#65292;&#40657;&#23458;&#20063;&#33021;&#36890;&#36807;&#31471;&#28857;&#20449;&#24687;&#25512;&#26029;&#20986;&#36825;&#20010;&#31995;&#32479;&#26159;&#36890;&#36807; Spring Boot &#23454;&#29616;&#30340;&#12289;&#21487;&#33021;&#23384;&#22312;&#21738;&#20123;&#28431;&#27934;&#12290;</p>
<p>&#19968;&#33324;&#25105;&#20204;&#37117;&#20250;&#22312;&#31995;&#32479;&#21551;&#21160;&#21518;&#65292;&#36890;&#36807; <code>health</code> &#31471;&#28857;&#26469;&#21028;&#26029;&#31995;&#32479;&#30340;&#20581;&#24247;&#24773;&#20917;&#65292;&#22914;&#26524;&#23545;&#36825;&#20010;&#31471;&#28857;&#20570;&#20102;&#36807;&#22810;&#20445;&#25252;&#65292;&#21453;&#32780;&#19981;&#20415;&#20110;&#33719;&#21462;&#20581;&#24247;&#26816;&#26597;&#32467;&#26524;&#12290;</p>
<p>&#19968;&#31181;&#20570;&#27861;&#26159;&#22312;&#38450;&#28779;&#22681;&#25110;&#32773;&#36127;&#36733;&#22343;&#34913;&#23618;&#38754;&#65292;&#31105;&#27490;&#22806;&#37096;&#35775;&#38382; Spring Boot Actuator &#30340; URL&#65292;&#20363;&#22914;&#65292;&#30452;&#25509;&#31105;&#27490;&#35775;&#38382; <code>/actuator</code> &#21450;&#20854;&#23376;&#36335;&#24452;&#12290;&#21478;&#19968;&#31181;&#20570;&#27861;&#65292;&#23601;&#26159;&#32034;&#24615;&#35753; Actuator &#30340;&#31471;&#28857;&#26292;&#38706;&#22312;&#19982;&#19994;&#21153;&#20195;&#30721;&#19981;&#21516;&#30340; HTTP &#31471;&#21475;&#19978;&#65292;&#27604;&#22914;&#65292;&#19981;&#20877;&#20849;&#29992; <code>8080</code> &#31471;&#21475;&#65292;&#32780;&#26159;&#21333;&#29420;&#25552;&#20379;&#19968;&#20010; <code>8081</code> &#31471;&#21475;&#65292;&#32780;&#38450;&#28779;&#22681;&#21644;&#36127;&#36733;&#22343;&#34913;&#35774;&#22791;&#21482;&#30693;&#36947; <code>8080</code> &#31471;&#21475;&#30340;&#23384;&#22312;&#65292;&#20063;&#21482;&#20250;&#36716;&#21457;&#35831;&#27714;&#21040; <code>8080</code> &#31471;&#21475;&#65292;&#23601;&#19981;&#29992;&#25285;&#24515;&#22806;&#37096;&#33021;&#35775;&#38382;&#21040; <code>8081</code> &#31471;&#21475;&#30340;&#38382;&#39064;&#20102;&#12290;</p>
<p>&#36890;&#36807; <code>management.server.port=8081</code> &#33021;&#23454;&#29616;&#35774;&#32622; Actuator &#19987;&#23646;&#31471;&#21475;&#30340;&#21151;&#33021;&#12290;&#26356;&#36827;&#19968;&#27493;&#65292;&#25105;&#20204;&#36824;&#21487;&#20197;&#20351;&#29992; <code>management.server.base-path</code> &#23646;&#24615;&#65288;&#20197;&#21069;&#26159; <code>management.server.servlet.context-path</code>&#65289;&#20026; Spring Boot Actuator &#35774;&#32622; Servlet &#19978;&#19979;&#25991;&#65292;&#40664;&#35748;&#20026;&#31354;&#65307;&#20351;&#29992; <code>management.endpoints.web.base-path</code> &#23646;&#24615;&#26469;&#35843;&#25972; <code>/actuator</code> &#36825;&#20010;&#40664;&#35748;&#30340;&#22522;&#30784;&#36335;&#24452;&#12290;&#22914;&#26524;&#20687;&#19979;&#38754;&#36825;&#26679;&#26469;&#20570;&#35774;&#32622;&#65292;&#23601;&#33021;&#23558; <code>health</code> &#31471;&#28857;&#35775;&#38382;&#30340; URL &#35843;&#25972;&#20026; <code>http://localhost:8081/management/my-actuator/health</code> &#20102;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>management.server.port=8081
management.server.base-path=/management
management.endpoints.web.base-path=/my-actuator</code></pre>
</blockquote>
</li>
</ol><p class="&#27880;&#37322;&#20869;&#23481;"><span class="&#27880;&#37322;&#32534;&#21495;&#19979;">3</span><code>*</code> &#22312; YAML &#20013;&#26377;&#29305;&#27530;&#21547;&#20041;&#65292;&#25105;&#20204;&#22914;&#26524;&#35201;&#20351;&#29992; YAML &#26684;&#24335;&#26469;&#37197;&#32622;&#25991;&#20214;&#65292;&#23601;&#38656;&#35201;&#20351;&#29992; <code>"*"</code> &#30340;&#26684;&#24335;&#26469;&#34920;&#31034;&#12290;</p><p class="&#27880;&#37322;&#20869;&#23481;"><span class="&#27880;&#37322;&#32534;&#21495;&#19979;">4</span>&#36825;&#37096;&#20998;&#19982;&#31471;&#28857;&#30456;&#20851;&#30340;&#31034;&#20363;&#65292;&#21253;&#25324; 5.1.3 &#20013;&#30340;&#20363;&#23376;&#37117;&#22312; ch5/helloworld-actuator &#24037;&#31243;&#20013;&#12290;</p><h3 id="nav_point_77">5.1.3&#12288;&#23450;&#21046;&#31471;&#28857;&#20449;&#24687;</h3><p>Spring Boot Actuator &#20013;&#30340;&#27599;&#20010;&#31471;&#28857;&#25110;&#22810;&#25110;&#23569;&#20250;&#26377;&#19968;&#20123;&#23646;&#20110;&#33258;&#24049;&#30340;&#37197;&#32622;&#23646;&#24615;&#65292;&#22823;&#23478;&#21487;&#20197;&#22312; <code>org.springframework.boot:spring-boot-actuator-autoconfigure</code> &#21253;&#20013;&#26597;&#30475;&#21508;&#31181;&#20197; <code>Properties</code> &#32467;&#23614;&#30340;&#23646;&#24615;&#31867;&#65292;&#20063;&#21487;&#20197;&#30452;&#25509;&#36890;&#36807; <code>configprops</code> &#31471;&#28857;&#26469;&#26597;&#30475;&#23646;&#24615;&#31867;&#12290;</p><p>&#20363;&#22914;&#65292;<code>EnvironmentEndpointProperties</code> &#23601;&#23545;&#24212;&#20102; <code>management.endpoint.env</code> &#20013;&#30340;&#23646;&#24615;&#65292;&#20854;&#20013;&#30340; <code>keysToSanitize</code> &#23601;&#26159;&#29615;&#22659;&#20013;&#35201;&#36807;&#28388;&#30340;&#33258;&#23450;&#20041;&#25935;&#24863;&#20449;&#24687;&#38190;&#21517;&#28165;&#21333;&#65292;&#26681;&#25454;&#20195;&#30721;&#27880;&#37322;&#65292;&#20854;&#20013;&#21487;&#20197;&#35774;&#32622;&#21305;&#37197;&#30340;&#32467;&#23614;&#23383;&#31526;&#20018;&#65292;&#20063;&#21487;&#20197;&#20351;&#29992;&#27491;&#21017;&#34920;&#36798;&#24335;&#12290;&#22312;&#35774;&#32622;&#20102; <code>management.endpoint.env.keys-to-sanitize=java.*,sun.*</code> &#21518;&#65292;<code>env</code> &#31471;&#28857;&#36820;&#22238;&#30340;&#23646;&#24615;&#20013;&#65292;&#25152;&#26377; <code>java</code> &#21644; <code>sun</code> &#25171;&#22836;&#30340;&#23646;&#24615;&#20540;&#37117;&#20250;&#20197; <code>*</code> &#26174;&#31034;&#12290;</p><p>Spring Boot Actuator &#40664;&#35748;&#20026; <code>info</code> &#21644; <code>health</code> &#31471;&#28857;&#24320;&#21551;&#20102; HTTP &#35775;&#38382;&#25903;&#25345;&#65292;&#37027;&#20040;&#23601;&#35753;&#25105;&#20204;&#26469;&#35814;&#32454;&#20102;&#35299;&#19968;&#19979;&#36825;&#20004;&#20010;&#31471;&#28857;&#26377;&#21738;&#20123;&#21487;&#20197;&#23450;&#21046;&#30340;&#22320;&#26041;&#21543;&#12290;</p><ol>
<li><p><strong>&#23450;&#21046; info &#31471;&#28857;&#20449;&#24687;</strong></p>
<p>&#26681;&#25454; <code>InfoEndpointAutoConfiguration</code> &#21487;&#20197;&#24471;&#30693;&#65292;<code>InfoEndpoint</code> &#20013;&#20250;&#27880;&#20837; Spring &#19978;&#19979;&#25991;&#20013;&#30340;&#25152;&#26377; <code>InfoContributor</code> Bean &#23454;&#20363;&#12290;<code>InfoContributorAutoConfiguration</code> &#33258;&#21160;&#27880;&#20876;&#20102; <code>env</code>&#12289;<code>git</code> &#21644; <code>build</code> &#36825;&#19977;&#20010; <code>InfoContributor</code>&#65292;Spring Boot Actuator &#25552;&#20379;&#30340; <code>InfoContributor</code> &#21015;&#34920;&#22914;&#34920; 5-5 &#25152;&#31034;&#12290;</p>
<p><strong>&#34920; 5-5&#12288;&#20869;&#32622; <code>InfoContributor</code> &#21015;&#34920;</strong></p>
<table border="1" class="table table-bordered table-striped table-condensed" width="90%"><tr><th>&#31867;&#21517;</th><th>&#40664;&#35748;&#24320;&#21551;</th><th>&#35828;&#26126;</th></tr><tr><td><code>BuildInfoContributor</code></td><td>&#26159;</td><td>&#25552;&#20379; <code>BuildProperties</code> &#30340;&#20449;&#24687;&#65292;&#36890;&#36807; <code>spring.info.build</code> &#26469;&#35774;&#32622;&#65292;&#40664;&#35748;&#35835;&#21462; <code>META-INF/build-info.properties</code></td></tr><tr><td><code>EnvironmentInfoContributor</code></td><td>&#26159;</td><td>&#23558;&#37197;&#32622;&#20013;&#20197; <code>info</code> &#25171;&#22836;&#30340;&#23646;&#24615;&#36890;&#36807;&#31471;&#28857;&#26292;&#38706;</td></tr><tr><td><code>GitInfoContributor</code></td><td>&#26159;</td><td>&#25552;&#20379; <code>GitProperties</code> &#30340;&#20449;&#24687;&#65292;&#36890;&#36807; <code>spring.info.git</code> &#26469;&#35774;&#32622;&#65292;&#40664;&#35748;&#35835;&#21462; <code>git.properties</code></td></tr><tr><td><code>InfoPropertiesInfoContributor</code></td><td>&#21542;</td><td>&#25277;&#35937;&#31867;&#65292;&#19968;&#33324;&#20316;&#20026;&#20854;&#20182; <code>InfoContributor</code> &#30340;&#29238;&#31867;</td></tr><tr><td><code>MapInfoContributor</code></td><td>&#21542;</td><td>&#23558;&#20869;&#32622; <code>Map</code> &#20316;&#20026;&#20449;&#24687;&#36755;&#20986;</td></tr><tr><td><code>SimpleInfoContributor</code></td><td>&#21542;</td><td>&#20165;&#21253;&#21547;&#19968;&#23545;&#38190;&#20540;&#23545;&#30340;&#20449;&#24687;</td></tr></table>
<p>&#20551;&#35774;&#22312;&#37197;&#32622;&#25991;&#20214;&#20013;&#35774;&#32622;&#20102;&#22914;&#19979;&#20869;&#23481;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>info.app=HelloWorld
info.welcome=Welcome to the world of Spring.</code></pre>
<p>&#20877;&#25552;&#20379;&#22914;&#19979;&#30340; Bean&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>@Bean
public SimpleInfoContributor simpleInfoContributor() {
    return new SimpleInfoContributor("simple", "HelloWorld!");
}</code></pre>
<p>&#37027; info &#31471;&#28857;&#36755;&#20986;&#30340;&#20869;&#23481;&#22823;&#33268;&#22914;&#19979;&#25152;&#31034;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>{
    "app": "HelloWorld",
    "simple": "HelloWorld!",
    "welcome": "Welcome to the world of Spring."
}</code></pre>
<p>&#160;</p>
</li>
<li><p><strong>&#23450;&#21046; health &#31471;&#28857;&#20449;&#24687;</strong></p>
<p>&#20581;&#24247;&#26816;&#26597;&#26159;&#19968;&#20010;&#24456;&#24120;&#29992;&#30340;&#21151;&#33021;&#65292;&#21487;&#20197;&#24110;&#21161;&#25105;&#20204;&#20102;&#35299;&#31995;&#32479;&#30340;&#20581;&#24247;&#29366;&#20917;&#65292;&#20363;&#22914;&#65292;&#31995;&#32479;&#22312;&#21551;&#21160;&#21518;&#26159;&#21542;&#20934;&#22791;&#22909;&#23545;&#22806;&#25552;&#20379;&#26381;&#21153;&#20102;&#65292;&#25152;&#20381;&#36182;&#30340;&#32452;&#20214;&#26159;&#21542;&#24050;&#23601;&#32490;&#31561;&#12290;</p>
<p>&#20581;&#24247;&#26816;&#26597;&#20027;&#35201;&#26159;&#20381;&#36182; <code>HealthIndicator</code><span class="&#27880;&#37322;&#32534;&#21495;">5</span> &#30340;&#21508;&#31181;&#23454;&#29616;&#26469;&#23436;&#25104;&#30340;&#12290;Spring Boot Actuator &#20869;&#32622;&#20102;&#36817; 20 &#31181;&#19981;&#21516;&#30340;&#23454;&#29616;&#65292;&#34920; 5-6 &#21015;&#20030;&#20102;&#19968;&#20123;&#24120;&#29992;&#30340; <code>HealthIndicator</code> &#23454;&#29616;&#65292;&#22522;&#26412;&#21487;&#20197;&#28385;&#36275;&#26085;&#24120;&#20351;&#29992;&#30340;&#38656;&#27714;&#12290;</p>
<p><strong>&#34920; 5-6&#12288;&#24120;&#29992;&#30340; <code>HealthIndicator</code> &#23454;&#29616;</strong></p>
<table border="1" class="table table-bordered table-striped table-condensed" width="90%"><tr><th>&#23454;&#29616;&#31867;</th><th>&#20316;&#29992;</th></tr><tr><td>`DataSourceHealthIndicator`</td><td>&#26816;&#26597; Spring &#19978;&#19979;&#25991;&#20013;&#33021;&#21462;&#21040;&#30340;&#25152;&#26377; `DataSource` &#26159;&#21542;&#20581;&#24247;</td></tr><tr><td>`DiskSpaceHealthIndicator`</td><td>&#26816;&#26597;&#30913;&#30424;&#31354;&#38388;</td></tr><tr><td>`LivenessStateHealthIndicator`</td><td>&#26816;&#26597;&#31995;&#32479;&#30340;&#23384;&#27963;&#65288;Liveness&#65289;&#24773;&#20917;&#65292;&#19968;&#33324;&#29992;&#20110; Kubernetes &#20013;</td></tr><tr><td>`ReadinessStateHealthIndicator`</td><td>&#26816;&#26597;&#31995;&#32479;&#26159;&#21542;&#22788;&#20110;&#23601;&#32490;&#65288;Readiness&#65289;&#29366;&#24577;&#65292;&#19968;&#33324;&#29992;&#20110; Kubernetes &#20013;</td></tr><tr><td>`RedisHealthIndicator`</td><td>&#26816;&#26597;&#25152;&#20381;&#36182;&#30340; Redis &#20581;&#24247;&#24773;&#20917;</td></tr></table>
<p>&#27599;&#20010; <code>HealthIndicator</code> &#26816;&#26597;&#21518;&#37117;&#20250;&#26377;&#33258;&#24049;&#30340;&#29366;&#24577;&#20449;&#24687;&#65292;Spring Boot Actuator &#26368;&#21518;&#20250;&#26681;&#25454;&#25152;&#26377;&#32467;&#26524;&#30340;&#29366;&#24577;&#20449;&#24687;&#32508;&#21512;&#24471;&#20986;&#31995;&#32479;&#30340;&#26368;&#32456;&#29366;&#24577;&#12290;<code>org.springframework.boot.actuate.health.Status</code> &#23450;&#20041;&#20102;&#20960;&#31181;&#40664;&#35748;&#29366;&#24577;&#65292;&#25353;&#29031;&#20248;&#20808;&#32423;&#38477;&#24207;&#25490;&#21015;&#20998;&#21035;&#20026; <code>DOWN</code>&#12289;<code>OUT_OF_SERVICE</code>&#12289;<code>UP</code> &#21644; <code>UNKNOWN</code>&#65292;&#25152;&#26377;&#32467;&#26524;&#29366;&#24577;&#20013;&#20248;&#20808;&#32423;&#26368;&#39640;&#30340;&#29366;&#24577;&#20250;&#25104;&#20026; <code>health</code> &#31471;&#28857;&#30340;&#26368;&#32456;&#29366;&#24577;&#12290;&#22914;&#26524;&#26377;&#38656;&#35201;&#65292;&#25105;&#20204;&#20063;&#21487;&#20197;&#36890;&#36807; <code>management.endpoint.health.status.order</code> &#26469;&#26356;&#25913;&#29366;&#24577;&#30340;&#20248;&#20808;&#32423;&#12290;</p>
<p>Spring Boot Actuator &#40664;&#35748;&#24320;&#21551;&#20102;&#25152;&#26377;&#30340; <code>HealthIndicator</code>&#65292;&#23427;&#20204;&#20250;&#26681;&#25454;&#24773;&#20917;&#33258;&#34892;&#21028;&#26029;&#26159;&#21542;&#29983;&#25928;&#65292;&#20063;&#21487;&#20197;&#36890;&#36807; <code>management.health.defaults.enabled=false</code> &#24320;&#20851;&#65288;&#40664;&#35748;&#20851;&#38381;&#65289;&#65292;&#38543;&#21518;&#20351;&#29992; <code>management.health.&lt;name&gt;.enabled</code> &#36873;&#25321;&#24615;&#22320;&#24320;&#21551; <code>HealthIndicator</code>&#12290;&#20363;&#22914;&#65292;<code>DataSourceHealthContributorAutoConfiguration</code> &#26159;&#36825;&#26679;&#23450;&#20041;&#30340;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>@Configuration(proxyBeanMethods = false)
@ConditionalOnClass({ JdbcTemplate.class, AbstractRoutingDataSource.class })
@ConditionalOnBean(DataSource.class)
@ConditionalOnEnabledHealthIndicator("db")
@AutoConfigureAfter(DataSourceAutoConfiguration.class)
public class DataSourceHealthContributorAutoConfiguration extends
    CompositeHealthContributorConfiguration
&lt;AbstractHealthIndicator, DataSource&gt;
    implements InitializingBean {}</code></pre>
<p>&#37027;&#20040;&#23427;&#30340;&#29983;&#25928;&#26465;&#20214;&#26159;&#36825;&#26679;&#30340;&#65306;</p>
<ul>
<li class="&#31532;2&#32423;&#26080;&#24207;&#21015;&#34920;">CLASSPATH &#20013;&#23384;&#22312; <code>JdbcTemplate</code> &#21644; <code>AbstractRoutingDataSource</code> &#31867;&#65307;</li>
<li class="&#31532;2&#32423;&#26080;&#24207;&#21015;&#34920;">Spring &#19978;&#19979;&#25991;&#20013;&#23384;&#22312; <code>DataSource</code> &#31867;&#22411;&#30340; Bean&#65307;</li>
<li class="&#31532;2&#32423;&#26080;&#24207;&#21015;&#34920;">&#40664;&#35748;&#24320;&#20851;&#25171;&#24320;&#65292;&#25110;&#32773; <code>management.health.db.enabled=true</code>&#65292;&#27492;&#22788; <code>@ConditionalOnEnabledHealthIndicator</code> &#20013;&#30340; <code>db</code> &#23601;&#26159; <code>name</code><span class="&#27880;&#37322;&#32534;&#21495;">6</span>&#12290;</li>
</ul>
<p>&#30693;&#36947;&#20102; <code>health</code> &#20013;&#30340;&#21508;&#20010; <code>HealthIndicator</code> &#21518;&#65292;&#24590;&#20040;&#25165;&#33021;&#30475;&#21040;&#32467;&#26524;&#21602;&#65311;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;&#37197;&#32622; <code>management.endpoint.health.show-details</code> &#21644; <code>management.endpoint.health.show-components</code> &#30340;&#23646;&#24615;&#20540;&#26469;&#26597;&#30475;&#32467;&#26524;&#65292;&#40664;&#35748;&#26159; <code>never</code>&#65292;&#23558;&#20854;&#35843;&#25972;&#20026; <code>always</code> &#21518;&#23601;&#20250;&#22987;&#32456;&#26174;&#31034;&#20855;&#20307;&#20869;&#23481;&#20102;&#12290;&#22914;&#26524;&#20381;&#36182;&#20013;&#23384;&#22312; Spring Security&#65292;&#20063;&#21487;&#20197;&#20165;&#23545;&#25480;&#26435;&#21518;&#30340;&#29992;&#25143;&#24320;&#25918;&#65292;&#23558;&#23646;&#24615;&#20540;&#37197;&#32622;&#20026; <code>when-authorized</code>&#65292;&#36825;&#26102;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807; <code>management.endpoint.health.roles</code> &#26469;&#35774;&#32622;&#21487;&#20197;&#35775;&#38382;&#30340;&#29992;&#25143;&#30340;&#35282;&#33394;&#12290;&#19968;&#33324;&#24773;&#20917;&#19979;&#65292;&#21487;&#20197;&#32771;&#34385;&#23558;&#20854;&#35843;&#25972;&#20026; <code>always</code>&#12290;</p>
<p>&#22914;&#20170;&#36234;&#26469;&#36234;&#22810;&#30340;&#31995;&#32479;&#36816;&#34892;&#22312; Kubernetes &#29615;&#22659;&#20013;&#65292;&#32780; Kubernetes &#38656;&#35201;&#26816;&#26597;&#31995;&#32479;&#26159;&#21542;&#23384;&#27963;&#65292;&#26159;&#21542;&#23601;&#32490;&#65292;&#23545;&#27492;&#65292;<code>health</code> &#31471;&#28857;&#20063;&#25552;&#20379;&#20102;&#23545;&#24212;&#30340; <code>LivenessStateHealthIndicator</code> &#21644; <code>ReadinessStateHealthIndicator</code>&#65292;&#40664;&#35748; URL &#20998;&#21035;&#20026; <code>/actuator/health/liveness</code> &#21644; <code>/actuator/health/readiness</code>&#12290;</p>
</li>
</ol><p class="&#27880;&#37322;&#20869;&#23481;"><span class="&#27880;&#37322;&#32534;&#21495;&#19979;">5</span><code>HealthContributor</code> &#25509;&#21475;&#30340;&#20004;&#20010;&#37325;&#35201;&#30340;&#23376;&#25509;&#21475;&#20998;&#21035;&#26159; <code>HealthIndicator</code> &#21644; <code>CompositeHealthContributor</code>&#65292;&#19968;&#33324;&#25105;&#20204;&#37117;&#30452;&#25509;&#20351;&#29992; <code>HealthIndicator</code>&#65292;<code>CompositeHealthContributor</code> &#29992;&#20110;&#32452;&#21512;&#19968;&#20123; <code>HealthContributor</code> &#30340;&#32467;&#26524;&#12290;</p><p class="&#27880;&#37322;&#20869;&#23481;"><span class="&#27880;&#37322;&#32534;&#21495;&#19979;">6</span>&#36890;&#24120;&#24773;&#20917;&#19979;&#65292;<code>name</code> &#26159; Bean &#30340;&#21517;&#31216;&#21435;&#38500; <code>HealthIndicator</code> &#25110; <code>HealthContributor</code> &#21518;&#32512;&#21518;&#30340;&#20869;&#23481;&#12290;</p><h3 id="nav_point_78">5.1.4&#12288;&#24320;&#21457;&#33258;&#24049;&#30340;&#32452;&#20214;&#19982;&#31471;&#28857;</h3><p>&#22312;&#19978;&#19968;&#33410;&#20013;&#65292;&#25105;&#20204;&#30475;&#21040;&#30340;&#22522;&#26412;&#37117;&#26159;&#23545;&#29616;&#26377;&#31471;&#28857;&#19982;&#32452;&#20214;&#30340;&#37197;&#32622;&#65292;Spring Boot Actuator &#25552;&#20379;&#20102;&#35753;&#25105;&#20204;&#33258;&#24049;&#25193;&#23637;&#31471;&#28857;&#25110;&#32773;&#23454;&#29616;&#26032;&#31471;&#28857;&#30340;&#21151;&#33021;&#12290;&#20363;&#22914;&#65292;&#22312;&#36827;&#34892;&#20581;&#24247;&#26816;&#26597;&#26102;&#65292;&#25105;&#20204;&#21487;&#20197;&#21152;&#20837;&#33258;&#24049;&#30340;&#26816;&#26597;&#36923;&#36753;&#65292;&#21482;&#38656;&#23454;&#29616; <code>HealthIndicator</code> &#21363;&#21487;&#12290;</p><ol>
<li><p><strong>&#24320;&#21457;&#33258;&#24049;&#30340; HealthIndicator</strong></p>
<p>&#20026;&#20102;&#22686;&#21152;&#33258;&#24049;&#30340;&#20581;&#24247;&#26816;&#26597;&#36923;&#36753;&#65292;&#25105;&#20204;&#21487;&#20197;&#23450;&#21046;&#19968;&#20010; HealthIndicator &#23454;&#29616;&#65292;&#36890;&#24120;&#20250;&#36873;&#25321;&#25193;&#23637; <code>AbstractHealthIndicator</code> &#31867;&#65292;&#23454;&#29616;&#20854;&#20013;&#30340; <code>doHealthCheck()</code> &#26041;&#27861;&#12290;</p>
<p>&#26681;&#25454; <code>HealthEndpointConfiguration</code> &#31867;&#30340;&#20195;&#30721;&#65292;&#25105;&#20204;&#21487;&#20197;&#30693;&#36947; <code>healthContributorRegistry</code> &#20250;&#20174; Spring &#19978;&#19979;&#25991;&#33719;&#21462;&#25152;&#26377; <code>HealthContributor</code> &#31867;&#22411;&#65288;<code>HealthIndicator</code> &#32487;&#25215;&#20102;&#36825;&#20010;&#25509;&#21475;&#65289;&#30340; Bean&#65292;&#24182;&#36827;&#34892;&#27880;&#20876;&#65292;&#25152;&#20197;&#25105;&#20204;&#20063;&#21482;&#38656;&#35201;&#25226;&#20889;&#22909;&#30340; <code>HealthIndicator</code> &#37197;&#32622;&#20026; Bean &#21363;&#21487;&#12290;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>@Configuration(proxyBeanMethods = false)
class HealthEndpointConfiguration {
@Bean
    @ConditionalOnMissingBean
    HealthContributorRegistry healthContributorRegistry(ApplicationContext applicationContext,
            HealthEndpointGroups groups) {
        Map&lt;String, HealthContributor&gt; healthContributors = new LinkedHashMap&lt;&gt;(applicationContext
            .getBeansOfType(HealthContributor.class));
        if (ClassUtils.isPresent("reactor.core.publisher.Flux", applicationContext.getClassLoader())) {
            healthContributors.putAll(new AdaptedReactiveHealthContributors(applicationContext).get());
        }
        return new AutoConfiguredHealthContributorRegistry(healthContributors, groups.getNames());
    }
    // &#30465;&#30053;&#20854;&#20182;&#20195;&#30721;
}</code></pre>
<p>&#25509;&#19979;&#26469;&#65292;&#25105;&#20204;&#20197;&#31532; 4 &#31456;&#30340; BinaryTea &#39033;&#30446;&#20316;&#20026;&#22522;&#30784;&#65292;&#22312;&#20854;&#20013;&#28155;&#21152;&#33258;&#24049;&#30340; <code>HealthIndicator</code>&#12290;&#22312; <code>ShopReadyHealthIndicator</code> &#19978;&#28155;&#21152; <code>@Component</code> &#27880;&#35299;&#65292;&#20197;&#20415;&#22312;&#25195;&#25551;&#21040;&#23427;&#21518;&#23601;&#33021;&#23558;&#20854;&#27880;&#20876;&#20026; Bean&#12290;&#36890;&#36807;&#26500;&#36896;&#26041;&#27861;&#27880;&#20837; <code>BinaryTeaProperties</code>&#65292;&#26816;&#26597;&#26102;&#22914;&#26524;&#27809;&#26377; <code>binaryTeaProperties</code> &#25110;&#32773;&#23646;&#24615;&#20013;&#30340; <code>ready</code> &#20026; <code>false</code>&#65292;&#26816;&#26597;&#21363;&#20026;&#22833;&#36133;&#65292;&#38500;&#27492;&#20043;&#22806;&#37117;&#31639;&#25104;&#21151;&#12290;&#20855;&#20307;&#22914;&#20195;&#30721;&#31034;&#20363; 5-3 &#25152;&#31034;&#12290;<span class="&#27880;&#37322;&#32534;&#21495;">7</span></p>
<blockquote>
<p><strong>&#20195;&#30721;&#31034;&#20363; 5-3</strong>&#12288;<code>ShopReadyHealthIndicator</code> &#20581;&#24247;&#26816;&#26597;&#22120;</p>
</blockquote>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>@Component
public class ShopReadyHealthIndicator extends AbstractHealthIndicator{
    private BinaryTeaProperties binaryTeaProperties;

    public ShopReadyHealthIndicator(ObjectProvider&lt;BinaryTeaProperties&gt; binaryTeaProperties) {
        this.binaryTeaProperties = binaryTeaProperties.getIfAvailable();
    }

    @Override
    protected void doHealthCheck(Health.Builder builder) throws Exception {
        if (binaryTeaProperties == null || !binaryTeaProperties.isReady()) {
            builder.down();
        } else {
            builder.up();
        }
    }
}</code></pre>
<p>&#36816;&#34892;&#20195;&#30721;&#21069;&#36824;&#38656;&#35201;&#22312; pom.xml &#20013;&#21152;&#20837; Spring Web &#21644; Spring Boot Actuator &#30340;&#20381;&#36182;&#65292;&#20855;&#20307;&#22914;&#19979;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
<p>&#21516;&#26102;&#22312; <code>application.properties</code> &#20013;&#22686;&#21152; <code>management.endpoint.health.show-details=always</code>&#65292;&#20197;&#20415;&#21487;&#20197;&#30475;&#21040; <code>ShopReadyHealthIndicator</code> &#30340;&#25928;&#26524;&#12290;&#36816;&#34892; <code>BinaryTeaApplication</code> &#21518;&#65292;&#22312;&#27983;&#35272;&#22120;&#20013;&#35775;&#38382; http://localhost:8080/actuator/health&#65292;&#23601;&#33021;&#30475;&#21040;&#31867;&#20284;&#19979;&#38754;&#30340; JSON &#36755;&#20986;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>{
    "components": {
        // &#30465;&#30053;&#37096;&#20998;&#20869;&#23481;
        "ping": {
            "status": "UP"
        },
        "shopReady": {
            "status": "UP"
        }
    },
    "status": "UP"
}</code></pre>
<p>&#20026;&#20102;&#33021;&#22815;&#36827;&#34892;&#33258;&#21160;&#27979;&#35797;&#65292;&#25105;&#20204;&#36824;&#21487;&#20197;&#22312; <code>ShopConfigurationEnableTest</code> &#21644; <code>ShopConfigurationDisableTest</code> &#20013;&#20998;&#21035;&#21152;&#20837;&#23545;&#24212;&#30340;&#27979;&#35797;&#29992;&#20363;&#65292;&#20877;&#20889;&#20010;&#27979;&#35797;&#26816;&#26597;&#26159;&#21542;&#27880;&#20876;&#20102;&#23545;&#24212;&#30340;&#20449;&#24687;&#65292;&#22914;&#20195;&#30721;&#31034;&#20363; 5-4 &#25152;&#31034;&#12290;</p>
<blockquote>
<p><strong>&#20195;&#30721;&#31034;&#20363; 5-4</strong>&#12288;&#38024;&#23545; <code>ShopReadyHealthIndicator</code> &#30340;&#21508;&#31181;&#21333;&#20803;&#27979;&#35797;&#29992;&#20363;</p>
</blockquote>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>// ShopConfigurationEnableTest&#20013;&#30340;&#27979;&#35797;&#29992;&#20363;
@Test
void testIndicatorUp() {
    ShopReadyHealthIndicator indicator = applicationContext.getBean(ShopReadyHealthIndicator.class);
    assertEquals(Status.UP, indicator.getHealth(false).getStatus());
}

// ShopConfigurationDisableTest&#20013;&#30340;&#27979;&#35797;&#29992;&#20363;
@Test
void testIndicatorDown() {
    ShopReadyHealthIndicator indicator = applicationContext.getBean(ShopReadyHealthIndicator.class);
    assertEquals(Status.DOWN, indicator.getHealth(false).getStatus());
}

// &#29420;&#31435;&#30340;ShopReadyHealthIndicatorTest&#65292;&#27979;&#35797;&#26159;&#21542;&#27880;&#20876;&#20102;shopReady
@SpringBootTest
public class ShopReadyHealthIndicatorTest {
    @Autowired
    private HealthContributorRegistry registry;

    @Test
    void testRegistryContainsShopReady() {
        assertNotNull(registry.getContributor("shopReady"));
    }
}</code></pre>
<p>&#22914;&#26524;&#19968;&#20999;&#39034;&#21033;&#65292;&#25191;&#34892; <code>mvn test</code> &#21518;&#25105;&#20204;&#24212;&#35813;&#23601;&#33021;&#30475;&#21040;&#27979;&#35797;&#36890;&#36807;&#30340;&#20449;&#24687;&#20102;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>[INFO] Results:
[INFO]
[INFO] Tests run: 7, Failures: 0, Errors: 0, Skipped: 0
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------</code></pre>
<blockquote>
<p><strong>&#33590;&#27463;&#26102;&#38388;&#65306;&#20026;&#20160;&#20040;&#35201;&#20248;&#20808;&#36890;&#36807; <code>ObjectProvider</code> &#33719;&#21462; Bean</strong></p>
<p>&#24403;&#25105;&#20204;&#38656;&#35201;&#20174; Spring &#19978;&#19979;&#25991;&#20013;&#33719;&#21462;&#20854;&#20182; Bean &#26102;&#65292;&#26368;&#30452;&#25509;&#30340;&#26041;&#27861;&#26159;&#20351;&#29992; <code>@Autowired</code> &#27880;&#35299;&#65292;&#20294;&#31995;&#32479;&#36816;&#34892;&#26102;&#30340;&#19981;&#30830;&#23450;&#24615;&#22826;&#22810;&#20102;&#65292;&#27604;&#22914;&#19981;&#30830;&#23450;&#26159;&#21542;&#23384;&#22312;&#38656;&#35201;&#30340;&#20381;&#36182;&#65292;&#36825;&#26102;&#23601;&#38656;&#35201;&#21152;&#19978; <code>required=false</code> &#65307;&#20063;&#26377;&#21487;&#33021;&#30446;&#26631;&#31867;&#22411;&#30340; Bean &#19981;&#27490;&#19968;&#20010;&#65292;&#32780;&#25105;&#20204;&#21482;&#38656;&#35201;&#19968;&#20010;&#65307;&#26500;&#36896;&#26041;&#27861;&#26377;&#22810;&#20010;&#21442;&#25968;&#8230;&#8230;</p>
<p>&#36825;&#26102;&#23601;&#35813; <code>ObjectProvider&lt;T&gt;</code> &#19978;&#22330;&#20102;&#65292;&#23427;&#22823;&#22810;&#29992;&#20110;&#26500;&#36896;&#26041;&#27861;&#27880;&#20837;&#30340;&#22330;&#26223;&#65292;&#35753;&#25105;&#20204;&#26377;&#33021;&#21147;&#22788;&#29702;&#37027;&#20123;&#23604;&#23596;&#30340;&#22330;&#38754;&#65292;&#20854;&#20013;&#30340; <code>getIfAvailable()</code> &#26041;&#27861;&#22312;&#23384;&#22312;&#23545;&#24212; Bean &#26102;&#36820;&#22238;&#23545;&#35937;&#65292;&#19981;&#23384;&#22312;&#26102;&#21017;&#36820;&#22238; <code>null</code>&#65307;<code>getIfUnique()</code> &#26041;&#27861;&#22312;&#26377;&#19988;&#20165;&#26377;&#19968;&#20010;&#23545;&#24212; Bean &#26102;&#36820;&#22238;&#23545;&#35937;&#65292;Bean &#19981;&#23384;&#22312;&#25110;&#19981;&#21807;&#19968;&#65292;&#19988;&#19981;&#21807;&#19968;&#26102;&#27809;&#26377;&#26631;&#27880; <code>Primary</code> &#30340;&#24773;&#20917;&#19979;&#36820;&#22238; <code>null</code>&#12290;&#20877;&#21152;&#19978;&#19968;&#20123;&#26816;&#26597;&#21644;&#36941;&#21382;&#30340;&#26041;&#27861;&#65292;&#36890;&#36807;&#26126;&#30830;&#30340;&#32534;&#30721;&#65292;&#25105;&#20204;&#23601;&#21487;&#20197;&#30830;&#20445;&#33258;&#24049;&#30340;&#20195;&#30721;&#33719;&#21462;&#21040;&#24517;&#35201;&#30340;&#20381;&#36182;&#65292;&#25110;&#21028;&#26029;&#20986;&#32570;&#23569;&#30340;&#19996;&#35199;&#65292;&#24182;&#21152;&#20197;&#22788;&#29702;&#12290;</p>
</blockquote>
<p>&#160;</p>
</li>
<li><p><strong>&#24320;&#21457;&#33258;&#24049;&#30340;&#31471;&#28857;</strong></p>
<p>&#22914;&#26524;&#20869;&#32622;&#30340;&#31471;&#28857;&#26080;&#27861;&#28385;&#36275;&#25105;&#20204;&#30340;&#38656;&#27714;&#65292;&#37027;&#26368;&#21518;&#19968;&#25307;&#23601;&#26159;&#20889;&#19968;&#20010;&#33258;&#24049;&#30340;&#31471;&#28857;&#12290;&#22909;&#22312; Spring Boot Actuator &#25903;&#25345;&#21040;&#20301;&#65292;&#21482;&#38656;&#31616;&#21333;&#20960;&#27493;&#23601;&#33021;&#24110;&#21161;&#25105;&#20204;&#23454;&#29616;&#19968;&#20010;&#31471;&#28857;&#12290;</p>
<p>&#39318;&#20808;&#65292;&#22312; Bean &#19978;&#28155;&#21152; <code>@Endpoint</code> &#27880;&#35299;&#65292;&#20854;&#20013;&#24102;&#26377; <code>@ReadOperation</code>&#12289;<code>@WriteOperation</code> &#21644; <code>@DeleteOperation</code> &#30340;&#26041;&#27861;&#33021;&#34987;&#21457;&#24067;&#20986;&#26469;&#65292;&#32780;&#19988;&#33021;&#36890;&#36807; JMX &#25110;&#32773; HTTP &#30340;&#26041;&#24335;&#35775;&#38382;&#21040;&#36825;&#20123;&#26041;&#27861;</p>
<p>&#25509;&#19979;&#26469;&#65292;&#22914;&#26524;&#25105;&#20204;&#24076;&#26395;&#38480;&#21046;&#21482;&#29992;&#20854;&#20013;&#30340;&#19968;&#31181;&#26041;&#24335;&#26469;&#21457;&#24067;&#65292;&#21017;&#21487;&#20197;&#23558; <code>@Endpoint</code> &#26367;&#25442;&#20026; <code>@JmxEndpoint</code> &#25110; <code>@WebEndpoint</code>&#12290;</p>
<p>&#22914;&#26524;&#26159;&#36890;&#36807; HTTP &#26041;&#24335;&#35775;&#38382;&#30340;&#65292;&#40664;&#35748;&#30340; URL &#26159; <code>/actuator/&lt;id&gt;</code>&#65292;&#20854;&#20013;&#30340; <code>id</code> &#23601;&#26159; <code>@Endpoint</code> &#27880;&#35299;&#20013;&#25351;&#23450;&#30340; <code>id</code>&#65292;&#32780; <code>@ReadOperation</code>&#12289;<code>@WriteOperation</code> &#21644; <code>@DeleteOperation</code> &#30340;&#26041;&#27861;&#20998;&#21035;&#23545;&#24212;&#20102; HTTP &#30340; <code>GET</code>&#12289;<code>POST</code> &#21644; <code>DELETE</code> &#26041;&#27861;&#12290;HTTP &#30340;&#21709;&#24212;&#30721;&#21017;&#21462;&#20915;&#20110;&#26041;&#27861;&#30340;&#36820;&#22238;&#20540;&#65292;&#22914;&#26524;&#23384;&#22312;&#36820;&#22238;&#20869;&#23481;&#65292;&#21017;&#21709;&#24212;&#30721;&#26159; <code>200 OK</code>&#65292;&#21542;&#21017; <code>@ReadOperation</code> &#26041;&#27861;&#20250;&#36820;&#22238; <code>404 Not Found</code>&#65292;&#32780;&#21478;&#20004;&#20010;&#21017;&#36820;&#22238; <code>204 No Content</code>&#65307;&#23545;&#20110;&#38656;&#35201;&#21442;&#25968;&#20294;&#21448;&#33719;&#21462;&#19981;&#21040;&#30340;&#24773;&#20917;&#65292;&#26041;&#27861;&#20250;&#36820;&#22238; <code>400 Bad Request</code>&#12290;</p>
<p>&#25105;&#20204;&#20026; BinaryTea &#32534;&#20889;&#20102;&#19968;&#20010;&#36820;&#22238;&#21830;&#24215;&#29366;&#24577;&#30340;&#31471;&#28857;&#65292;&#20855;&#20307;&#22914;&#20195;&#30721;&#31034;&#20363; 5-5 &#25152;&#31034;&#65292;&#22823;&#37096;&#20998;&#36923;&#36753;&#19982; <code>ShopReadyHealthIndicator</code> &#26159;&#31867;&#20284;&#30340;&#65292;&#36825;&#37324;&#23601;&#19981;&#20877;&#36184;&#36848;&#20102;&#12290;</p>
<blockquote>
<p><strong>&#20195;&#30721;&#31034;&#20363; 5-5</strong>&#12288;<code>ShopEndpoint</code> &#20195;&#30721;&#29255;&#27573;</p>
</blockquote>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>@Component
@Endpoint(id = "shop")
public class ShopEndpoint {
    private BinaryTeaProperties binaryTeaProperties;

    public ShopEndpoint(ObjectProvider&lt;BinaryTeaProperties&gt; binaryTeaProperties) {
        this.binaryTeaProperties = binaryTeaProperties.getIfAvailable();
    }

    @ReadOperation
    public String state() {
        if (binaryTeaProperties == null || !binaryTeaProperties.isReady()) {
            return "We're not ready.";
        } else {
            return "We open " + binaryTeaProperties.getOpenHours() + ".";
        }
    }
}</code></pre>
<p>&#20026;&#20102;&#33021;&#35775;&#38382;&#21040;&#25105;&#20204;&#30340;&#31471;&#28857;&#65292;&#38656;&#35201;&#22312; <code>application.properties</code> &#20013;&#20801;&#35768;&#23427;&#20197; Web &#24418;&#24335;&#21457;&#24067;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>management.endpoints.web.exposure.include=health,info,shop</code></pre>
<p>&#21551;&#21160;&#31995;&#32479;&#21518;&#65292;&#36890;&#36807; <code>http://localhost:8080/actuator/shop</code> &#21363;&#21487;&#35775;&#38382; <code>ShopEndpoint</code> &#30340;&#36755;&#20986;&#12290;</p>
</li>
</ol><p class="&#27880;&#37322;&#20869;&#23481;"><span class="&#27880;&#37322;&#32534;&#21495;&#19979;">7</span>&#21487;&#20197;&#22312;&#26412;&#20070;&#31034;&#20363;&#30340; ch5/binarytea-endpoint &#39033;&#30446;&#20013;&#25214;&#21040;&#36825;&#20010;&#20363;&#23376;&#12290;</p><h2 id="nav_point_79">5.2&#12288;&#22522;&#20110; Micrometer &#30340;&#31995;&#32479;&#24230;&#37327;</h2><p>&#31995;&#32479;&#22312;&#29983;&#20135;&#29615;&#22659;&#20013;&#36816;&#34892;&#26102;&#65292;&#25105;&#20204;&#38656;&#35201;&#36890;&#36807;&#21508;&#31181;&#26041;&#24335;&#20102;&#35299;&#31995;&#32479;&#30340;&#36816;&#20316;&#26159;&#21542;&#27491;&#24120;&#12290;&#20043;&#21069;&#25552;&#21040;&#30340; <code>health</code> &#31471;&#28857;&#21482;&#33021;&#21028;&#26029;&#26368;&#22522;&#26412;&#30340;&#24773;&#20917;&#65292;&#33267;&#20110;&#26356;&#22810;&#32454;&#33410;&#65292;&#36824;&#38656;&#35201;&#33719;&#21462;&#35814;&#32454;&#30340;&#24230;&#37327;&#25351;&#26631;&#65292;<code>metrics</code> &#31471;&#28857;&#23601;&#26159;&#29992;&#26469;&#25552;&#20379;&#31995;&#32479;&#24230;&#37327;&#20449;&#24687;&#30340;&#12290;</p><h3 id="nav_point_80">5.2.1&#12288;Micrometer &#27010;&#36848;</h3><p>&#20174; 2.0 &#29256;&#26412;&#24320;&#22987;&#65292;Spring Boot &#23601;&#25226; Micrometer &#20316;&#20026;&#40664;&#35748;&#30340;&#31995;&#32479;&#24230;&#37327;&#25351;&#26631;&#33719;&#21462;&#36884;&#24452;&#20102; <span class="&#27880;&#37322;&#32534;&#21495;">8</span>&#65292;&#22240;&#27492;&#26412;&#33410;&#20063;&#20808;&#20174; Micrometer &#35762;&#36215;&#12290;</p><p class="&#27880;&#37322;&#20869;&#23481;"><span class="&#27880;&#37322;&#32534;&#21495;&#19979;">8</span>Micrometer &#20063;&#26159; Pivotal &#24320;&#21457;&#30340;&#65292;&#25152;&#20197; Spring Boot &#23545;&#23427;&#20250;&#26377;&#19968;&#23450;&#30340;&#20559;&#22909;&#12290;</p><p>Java &#24320;&#21457;&#32773;&#24212;&#35813;&#37117;&#24456;&#29087;&#24713; SLF4J&#65288;Simple Logging Facade for Java&#65289;&#65292;&#23427;&#25552;&#20379;&#20102;&#19968;&#22871;&#26085;&#24535;&#26694;&#26550;&#30340;&#25277;&#35937;&#65292;&#23631;&#34109;&#20102;&#24213;&#23618;&#19981;&#21516;&#26085;&#24535;&#26694;&#26550;&#65288;&#27604;&#22914; Commons Logging&#12289;Log4j &#21644; Logback&#65289;&#23454;&#29616;&#19978;&#30340;&#24046;&#24322;&#65292;&#35753;&#24320;&#21457;&#32773;&#33021;&#20197;&#32479;&#19968;&#30340;&#26041;&#24335;&#22312;&#20195;&#30721;&#20013;&#25171;&#21360;&#26085;&#24535;&#12290;&#22914;&#26524;&#35828; Micrometer &#30340;&#30446;&#26631;&#23601;&#26159;&#25104;&#20026;&#24230;&#37327;&#30028;&#30340; SLF4J&#65292;&#30456;&#20449;&#22823;&#23478;&#23601;&#33021;&#29702;&#35299; Micrometer &#26159;&#24178;&#20160;&#20040;&#30340;&#20102;&#12290;</p><p>Micrometer &#20026;&#24456;&#22810;&#20027;&#27969;&#30340;&#30417;&#25511;&#31995;&#32479;&#25552;&#20379;&#20102;&#19968;&#22871;&#31616;&#21333;&#19988;&#24378;&#22823;&#30340;&#23458;&#25143;&#31471;&#38376;&#38754;&#65292;&#20808;&#26159;&#23450;&#20041;&#20102;&#19968;&#22871; SPI&#65288;Service Provider Interface&#65289;&#65292;&#20877;&#20026;&#19981;&#21516;&#30340;&#30417;&#25511;&#31995;&#32479;&#25552;&#20379;&#23454;&#29616;&#12290;&#25509;&#20837; Micrometer &#21518;&#65292;&#24320;&#21457;&#32773;&#36890;&#36807; Micrometer &#36827;&#34892;&#22475;&#28857;&#26102;&#23601;&#19981;&#20250;&#34987;&#32465;&#23450;&#22312;&#26576;&#20010;&#29305;&#23450;&#30340;&#30417;&#25511;&#31995;&#32479;&#19978;&#12290;&#23427;&#25903;&#25345;&#30340;&#30417;&#25511;&#31995;&#32479;&#65292;&#20197;&#21450;&#36825;&#20123;&#31995;&#32479;&#30340;&#29305;&#24615;&#65292;&#22914;&#34920; 5-7 &#25152;&#31034;&#12290;</p><p><strong>&#34920; 5-7&#12288;Micrometer &#25903;&#25345;&#30340;&#30417;&#25511;&#31995;&#32479;&#28165;&#21333;</strong></p><table border="1" width="90%">
<thead>
<tr>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#30417;&#25511;&#31995;&#32479;</p></th>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#26159;&#21542;&#25903;&#25345;&#22810;&#32500;&#24230;<span class="&#27880;&#37322;&#32534;&#21495;">9</span></p></th>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#25968;&#25454;&#32858;&#21512;&#26041;&#24335;</p></th>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#25968;&#25454;&#33719;&#21462;&#26041;&#24335;</p></th>
</tr>
</thead>
<tbody>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">AppOptics</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#32858;&#21512;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#25512;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">Atlas</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#32858;&#21512;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#25512;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">Azure Monitor</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#32858;&#21512;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#25512;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">Cloudwatch</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#32858;&#21512;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#25512;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">Datadog</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#32858;&#21512;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#25512;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">Datadog StatsD</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#32858;&#21512;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26381;&#21153;&#31471;&#25289;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">Dynatrace</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#32858;&#21512;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#25512;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">Elastic</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#32858;&#21512;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#25512;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">Etsy StatsD</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21542;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#32858;&#21512;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26381;&#21153;&#31471;&#25289;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">Ganglia</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21542;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#32858;&#21512;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#25512;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">Graphite</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21542;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#32858;&#21512;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#25512;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">Humio</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#32858;&#21512;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#25512;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">Influx</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#32858;&#21512;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#25512;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">JMX</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21542;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#32858;&#21512;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#25512;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">KairosDB</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#32858;&#21512;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#25512;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">New Relic</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#32858;&#21512;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#25512;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">Prometheus</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26381;&#21153;&#31471;&#32858;&#21512;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26381;&#21153;&#31471;&#25289;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">SignalFx</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#32858;&#21512;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#25512;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">Sysdig StatsD</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#32858;&#21512;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26381;&#21153;&#31471;&#25289;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">Telegraf StatsD</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#32858;&#21512;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26381;&#21153;&#31471;&#25289;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">Wavefront</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26381;&#21153;&#31471;&#32858;&#21512;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#25143;&#31471;&#25512;</p></td>
</tr>
</tbody>
</table><p class="&#27880;&#37322;&#20869;&#23481;"><span class="&#27880;&#37322;&#32534;&#21495;&#19979;">9</span>&#24230;&#37327;&#25351;&#26631;&#30340;&#21517;&#31216;&#26159;&#21542;&#25903;&#25345;&#37197;&#32622;&#22810;&#20010;&#26631;&#31614;&#12290;</p><p>Micrometer &#36890;&#36807; <code>Meter</code> &#25509;&#21475;&#26469;&#25910;&#38598;&#31995;&#32479;&#30340;&#24230;&#37327;&#25968;&#25454;&#65292;&#30001; <code>MeterRegistry</code> &#26469;&#21019;&#24314;&#24182;&#31649;&#29702; <code>Meter</code>&#65292;Micrometer &#25903;&#25345;&#30340;&#21508;&#31181;&#30417;&#25511;&#31995;&#32479;&#37117;&#26377;&#33258;&#24049;&#30340; <code>MeterRegistry</code> &#23454;&#29616;&#12290;&#20869;&#32622;&#30340; <code>Meter</code> &#23454;&#29616;&#20998;&#20026;&#20960;&#31181;&#65292;&#20855;&#20307;&#22914;&#34920; 5-8 &#25152;&#31034;&#12290;</p><p><strong>&#34920; 5-8&#12288;&#20960;&#31181;&#20027;&#35201;&#30340; <code>Meter</code> &#23454;&#29616;</strong></p><table border="1" width="90%">
<thead>
<tr>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;"><code>Meter</code> &#31867;&#22411;</p></th>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#35828;&#26126;</p></th>
</tr>
</thead>
<tbody>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>Timer</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#35745;&#26102;&#22120;&#65292;&#29992;&#26469;&#35760;&#24405;&#19968;&#20010;&#20107;&#20214;&#30340;&#32791;&#26102;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>Counter</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#35745;&#25968;&#22120;&#65292;&#29992;&#26469;&#34920;&#31034;&#19968;&#20010;&#21333;&#35843;&#36882;&#22686;&#30340;&#20540;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>Gauge</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#35745;&#37327;&#20202;&#65292;&#29992;&#26469;&#34920;&#31034;&#19968;&#20010;&#21464;&#21270;&#30340;&#20540;&#65292;&#36890;&#24120;&#33021;&#29992; <code>Counter</code> &#23601;&#19981;&#29992; <code>Gauge</code></p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>DistributionSummary</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#20998;&#24067;&#32479;&#35745;&#65292;&#29992;&#26469;&#35760;&#24405;&#20107;&#20214;&#30340;&#20998;&#24067;&#24773;&#20917;&#65292;&#21487;&#20197;&#35774;&#32622;&#19968;&#20010;&#33539;&#22260;&#65292;&#33719;&#21462;&#33539;&#22260;&#20869;&#30340;&#30452;&#26041;&#22270;&#21644;&#30334;&#20998;&#20301;&#25968;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>LongTaskTimer</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#38271;&#20219;&#21153;&#35745;&#26102;&#22120;&#65292;&#35760;&#24405;&#19968;&#20010;&#38271;&#26102;&#38388;&#20219;&#21153;&#30340;&#32791;&#26102;&#65292;&#21487;&#20197;&#35760;&#24405;&#24050;&#32463;&#32791;&#36153;&#30340;&#26102;&#38388;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>FunctionCounter</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#20989;&#25968;&#35745;&#25968;&#22120;&#65292;&#36861;&#36394;&#26576;&#20010;&#21333;&#35843;&#36882;&#22686;&#20989;&#25968;&#30340;&#35745;&#25968;&#22120;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>FunctionTimer</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#20989;&#25968;&#35745;&#26102;&#22120;&#65292;&#36861;&#36394;&#20004;&#20010;&#21333;&#35843;&#36882;&#22686;&#20989;&#25968;&#65292;&#19968;&#20010;&#35745;&#25968;&#65292;&#21478;&#19968;&#20010;&#35745;&#26102;</p></td>
</tr>
</tbody>
</table><p>&#35201;&#21019;&#24314; <code>Meter</code>&#65292;&#26082;&#21487;&#20197;&#36890;&#36807; <code>MeterRegistry</code> &#19978;&#30340;&#26041;&#27861;&#65292;&#20363;&#22914; <code>registry.timer("foo")</code>&#65292;&#20063;&#21487;&#20197;&#36890;&#36807; Fluent &#39118;&#26684;&#30340;&#26500;&#24314;&#26041;&#27861;&#65292;&#20363;&#22914; <code>Timer.builder("foo").tags("bar").register(registry)</code>&#12290;<code>Meter</code> &#30340;&#21629;&#21517;&#37319;&#29992;&#20197; <code>.</code> &#20998;&#38548;&#30340;&#20840;&#23567;&#20889;&#21333;&#35789;&#32452;&#21512;&#65292;&#19981;&#21516;&#30340;&#30417;&#25511;&#31995;&#32479;&#21151;&#33021;&#26377;&#19981;&#21516;&#30340;&#21629;&#21517;&#26041;&#24335;&#65292;Micrometer &#20250;&#36127;&#36131;&#23558; <code>Meter</code> &#30340;&#21517;&#31216;&#36716;&#20026;&#21512;&#36866;&#30340;&#26041;&#24335;&#65292;&#22312;&#23448;&#26041;&#25991;&#26723;&#20013;&#23601;&#32473;&#20986;&#20102;&#36825;&#26679;&#19968;&#20010;&#20363;&#23376;&#65306;</p><pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>registry.timer("http.server.requests");</code></pre><p>&#22312;&#20351;&#29992; Prometheus &#26102;&#65292;&#36825;&#20010; <code>Timer</code> &#30340;&#21517;&#23383;&#23601;&#20250;&#34987;&#36716;&#20026; <code>http_server_requests_duration_seconds</code>&#12290;</p><p>&#26631;&#31614;&#20063;&#36981;&#24490;&#19968;&#26679;&#30340;&#21629;&#21517;&#26041;&#24335;&#65292;Micrometer &#21516;&#26679;&#20063;&#20250;&#36127;&#36131;&#24110;&#25105;&#20204;&#23558; <code>Timer</code> &#30340;&#26631;&#31614;&#36716;&#25442;&#25104;&#19981;&#21516;&#30417;&#25511;&#31995;&#32479;&#25152;&#25512;&#33616;&#30340;&#21517;&#31216;&#12290;&#19979;&#38754;&#30340;&#26631;&#31614;&#21517;&#20026; <code>uri</code>&#65292;&#20540;&#20026; <code>/api/orders</code>&#65306;</p><pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>registry.timer("http.server.requests", "uri", "/api/orders");</code></pre><p>&#38024;&#23545;&#36890;&#29992;&#30340;&#26631;&#31614;&#65292;Micrometer &#36824;&#36148;&#24515;&#22320;&#25552;&#20379;&#20102;&#20844;&#20849;&#26631;&#31614;&#30340;&#21151;&#33021;&#65292;&#22312; <code>MeterRegistry</code> &#19978;&#35774;&#32622;&#26631;&#31614;&#65306;</p><pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>registry.config().commonTags("prod", "region", "cn-shanghai-1");</code></pre><h3 id="nav_point_81">5.2.2&#12288;&#24120;&#29992;&#24230;&#37327;&#25351;&#26631;</h3><p>Spring Boot Actuator &#20013;&#25552;&#20379;&#20102; <code>metrics</code> &#31471;&#28857;&#65292;&#36890;&#36807; <code>/actuator/metrics</code> &#25105;&#20204;&#21487;&#20197;&#33719;&#21462;&#31995;&#32479;&#30340;&#24230;&#37327;&#20540;&#12290;&#32780;&#19988; Spring Boot &#36824;&#20869;&#32622;&#20102;&#24456;&#22810;&#23454;&#29992;&#30340;&#25351;&#26631;&#65292;&#21487;&#20197;&#30452;&#25509;&#25343;&#26469;&#20351;&#29992;&#12290;</p><p>&#39318;&#20808;&#20171;&#32461;&#30340;&#26159; Micrometer &#26412;&#36523;&#25903;&#25345;&#30340; JVM &#30456;&#20851;&#25351;&#26631;&#65292;&#20855;&#20307;&#35265;&#34920; 5-9&#12290;</p><p><strong>&#34920; 5-9&#12288;Micrometer &#25903;&#25345;&#30340; JVM &#24230;&#37327;&#25351;&#26631;</strong></p><table border="1" width="90%">
<thead>
<tr>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#24230;&#37327;&#25351;&#26631;</p></th>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#35828;&#26126;</p></th>
</tr>
</thead>
<tbody>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>ClassLoaderMetrics</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#25910;&#38598;&#21152;&#36733;&#21644;&#21368;&#36733;&#30340;&#31867;&#20449;&#24687;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>JvmMemoryMetrics</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#25910;&#38598; JVM &#20869;&#23384;&#21033;&#29992;&#24773;&#20917;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>JvmGcMetrics</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#25910;&#38598; JVM &#30340; GC &#24773;&#20917;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>ProcessorMetrics</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#25910;&#38598; CPU &#36127;&#36733;&#24773;&#20917;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>JvmThreadMetrics</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#25910;&#38598; JVM &#20013;&#30340;&#32447;&#31243;&#24773;&#20917;</p></td>
</tr>
</tbody>
</table><p>&#29992;&#19979;&#38754;&#30340;&#35821;&#21477;&#23601;&#33021;&#32465;&#23450;&#19968;&#20010; <code>ClassLoaderMetrics</code>&#65306;</p><pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>new ClassLoaderMetrics().bindTo(registry);</code></pre><p>&#20294;&#22312; Spring Boot Actuator &#30340;&#24110;&#21161;&#19979;&#65292;&#25105;&#20204;&#26080;&#39035;&#33258;&#24049;&#26469;&#32465;&#23450;&#36825;&#20123;&#24230;&#37327;&#25351;&#26631;&#65292;Spring Boot &#20013; <code>JvmMetricsAutoConfiguration</code> &#20043;&#31867;&#30340;&#33258;&#21160;&#37197;&#32622;&#31867;&#24050;&#32463;&#26367;&#25105;&#20204;&#20570;&#22909;&#20102;&#32465;&#23450;&#30340;&#24037;&#20316;&#12290;&#27492;&#22806;&#65292;&#23427;&#36824;&#22312;&#27492;&#22522;&#30784;&#19978;&#25552;&#20379;&#20102; Spring MVC&#12289;Spring WebFlux&#12289;HTTP &#23458;&#25143;&#31471;&#21644;&#25968;&#25454;&#28304;&#31561;&#20854;&#20182;&#24230;&#37327;&#25351;&#26631;&#12290;</p><p>&#20173;&#28982;&#20197; 5.1.4 &#33410;&#30340; binarytea-endpoint &#20026;&#20363;&#65292;&#25105;&#20204;&#22312; <code>application.properties</code> &#20013;&#20570;&#20123;&#20462;&#25913;&#65292;&#23558; <code>metrics</code> &#31471;&#28857;&#21152;&#20837; Web &#21487;&#35775;&#38382;&#30340;&#31471;&#28857;&#20013;&#65306;</p><pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>management.endpoints.web.exposure.include=health,info,shop,metrics</code></pre><p>&#21551;&#21160;&#31243;&#24207;&#21518;&#65292;&#36890;&#36807; <code>http://localhost:8080/actuator/metrics</code> &#21487;&#20197;&#30475;&#21040;&#31867;&#20284;&#19979;&#38754;&#36825;&#26679;&#30340;&#19968;&#20010;&#28165;&#21333;&#65292;&#20854;&#20013;&#21015;&#20030;&#30340; <code>names</code> &#23601;&#26159;&#20855;&#20307;&#30340;&#24230;&#37327;&#25351;&#26631;&#21517;&#31216;&#65306;</p><pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>{
    "names": [
        "http.server.requests",
        "jvm.buffer.count",
        "jvm.buffer.memory.used",
        "jvm.buffer.total.capacity",
        "jvm.classes.loaded",
        "jvm.classes.unloaded",
        "jvm.gc.live.data.size",
        "jvm.gc.max.data.size",
        "jvm.gc.memory.allocated",
        "jvm.gc.pause",
        "jvm.memory.max",
        "jvm.memory.used",
        "jvm.threads.live",
        "jvm.threads.peak",
        "logback.events",
        "process.cpu.usage",
        "process.files.max",
        "process.start.time",
        "process.uptime",
        "system.cpu.usage",
        "system.load.average.1m",
        "tomcat.sessions.active.current",
        "tomcat.sessions.active.max",
        "tomcat.sessions.rejected"
        // &#21015;&#34920;&#20013;&#30465;&#30053;&#20102;&#19968;&#20123;&#20869;&#23481;
    ]
}</code></pre><p>&#22312; URI &#21518;&#22686;&#21152;&#20855;&#20307;&#30340;&#21517;&#31216;&#65292;&#20363;&#22914;&#65292;<code>http://localhost:8080/actuator/metrics/jvm.classes.loaded</code>&#65292;&#23601;&#33021;&#26597;&#30475;&#20855;&#20307;&#30340;&#24230;&#37327;&#20449;&#24687;&#65306;</p><pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>{
    "availableTags": [

    ],
    "baseUnit": "classes",
    "description": "The number of classes that are currently loaded in the Java virtual machine",
    "measurements": [
        {
        "statistic": "VALUE",
        "value": 7232.0
        }
    ],
    "name": "jvm.classes.loaded"
}</code></pre><ol>
<li><p><strong>Spring MVC</strong></p>
<p>&#40664;&#35748;&#25152;&#26377;&#22522;&#20110; Spring MVC &#30340; Web &#35831;&#27714;&#37117;&#20250;&#34987;&#35760;&#24405;&#19979;&#26469;&#65292;&#36890;&#36807; <code>/actuator/metrics/http.server.requests</code> &#25105;&#20204;&#21487;&#20197;&#26597;&#30475;&#31867;&#20284;&#19979;&#38754;&#36825;&#26679;&#30340;&#36755;&#20986;&#65292;&#20854;&#20013;&#21253;&#21547;&#20102;&#22823;&#37327;&#30340;&#20449;&#24687;&#65292;&#27604;&#22914;&#29992;&#36807;&#30340; HTTP &#26041;&#27861;&#12289;&#35775;&#38382;&#36807;&#30340;&#22320;&#22336;&#12289;&#36820;&#22238;&#30340; HTTP &#21709;&#24212;&#30721;&#12289;&#35831;&#27714;&#30340;&#24635;&#27425;&#25968;&#21644;&#24635;&#32791;&#26102;&#65292;&#20197;&#21450;&#26368;&#22823;&#21333;&#27425;&#32791;&#26102;&#31561;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>{
    "availableTags": [
        { "tag": "exception", "values": ["None"] },
        { "tag": "method", "values": ["GET"] },
        {
            "tag": "uri",
            "values": [
                "/actuator/metrics/{requiredMetricName}",
                "/actuator/metrics"
            ]
        },
        { "tag": "outcome", "values": ["SUCCESS"] },
        { "tag": "status", "values": ["200"] }
    ],
    "baseUnit": "seconds",
    "description": null,
    "measurements": [
        { "statistic": "COUNT", "value": 5.0 },
        { "statistic": "TOTAL_TIME", "value": 0.085699938 },
        { "statistic": "MAX", "value": 0.042694752 }
    ],
    "name": "http.server.requests"
}</code></pre>
<p><code>management.metrics.web.server.request.autotime.enabled</code> &#40664;&#35748;&#20026; <code>true</code>&#65292;&#23427;&#33021;&#33258;&#21160;&#32479;&#35745;&#25152;&#26377;&#30340; Web &#35831;&#27714;&#65292;&#22914;&#26524;&#25105;&#20204;&#23558;&#23427;&#35774;&#32622;&#20026; <code>false</code>&#65292;&#21017;&#38656;&#35201;&#33258;&#24049;&#22312;&#31867;&#19978;&#25110;&#32773;&#26041;&#27861;&#19978;&#28155;&#21152; <code>@Timed</code> &#26469;&#26631;&#35760;&#35201;&#32479;&#35745;&#30340; <code>Controller</code> &#26041;&#27861; <span class="&#27880;&#37322;&#32534;&#21495;">10</span>&#65292;<code>@Timed</code> &#27880;&#35299;&#21487;&#20197;&#20570;&#20123;&#26356;&#31934;&#32454;&#30340;&#35774;&#32622;&#65292;&#20363;&#22914;&#65292;&#28155;&#21152;&#39069;&#22806;&#30340;&#26631;&#31614;&#65292;&#35745;&#31639;&#30334;&#20998;&#20301;&#25968;&#65292;&#31561;&#31561;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>@Controller
public class SampleController {
    @RequestMapping("/")
    @Timed(extraTags = { "region", "cn-shanghai-1" }, percentiles = 0.99)
    public String foo() {}
}</code></pre>
<p>&#160;</p>
</li>
<li><p><strong>HTTP &#23458;&#25143;&#31471;</strong></p>
<p>&#24403;&#20351;&#29992; <code>RestTemplate</code> &#21644; <code>WebClient</code> &#35775;&#38382; HTTP &#26381;&#21153;&#26102; <span class="&#27880;&#37322;&#32534;&#21495;">11</span>&#65292;Spring Boot Actuator &#25552;&#20379;&#20102;&#38024;&#23545; HTTP &#23458;&#25143;&#31471;&#30340;&#24230;&#37327;&#25351;&#26631;&#65292;&#20294;&#36825;&#24182;&#19981;&#26159;&#33258;&#21160;&#30340;&#65292;&#36824;&#38656;&#35201;&#20570;&#19968;&#20123;&#37197;&#32622;&#23427;&#20204;&#25165;&#33021;&#29983;&#25928;&#12290;&#36825;&#37324;&#24314;&#35758;&#36890;&#36807;&#22914;&#19979;&#26041;&#24335;&#26469;&#21019;&#24314; <code>RestTemplate</code>&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>@Bean
public RestTemplate restTemplate(RestTemplateBuilder builder) {
    return builder.build();
}</code></pre>
<p>&#20351;&#29992; <code>RestTemplateBuilder</code> &#26469;&#26500;&#24314; <code>RestTemplate</code> &#26102;&#65292;&#20250;&#23545;&#20854;&#24212;&#29992;&#25152;&#26377;&#37197;&#32622;&#22312; Spring &#19978;&#19979;&#25991;&#37324;&#30340; <code>RestTemplateCustomizer</code>&#65292;&#32780;&#20854;&#20013;&#23601;&#26377;&#19982;&#24230;&#37327;&#30456;&#20851;&#30340; <code>MetricsRestTemplateCustomizer</code>&#12290;&#38024;&#23545; <code>WebClient</code> &#20063;&#26159;&#19968;&#26679;&#30340;&#65292;&#21487;&#20197;&#29992; <code>WebClient.Builder</code>&#12290;</p>
<p>&#22914;&#26524;&#22823;&#23478;&#26377;&#36890;&#36807; <code>RestTemplate</code> &#35775;&#38382;&#36807; HTTP &#26381;&#21153;&#65292;&#35775;&#38382; <code>/actuator/metrics/http.client.requests</code> &#21518;&#23601;&#33021;&#30475;&#21040;&#31867;&#20284;&#19979;&#38754;&#36825;&#26679;&#30340;&#36755;&#20986;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>{
    "availableTags": [
        { "tag": "method", "values": [ "GET" ] },
        { "tag": "clientName", "values": [ "localhost" ] },
        { "tag": "uri", "values": [ "/actuator/metrics" ] },
        { "tag": "outcome", "values": [ "SUCCESS" ] },
        { "tag": "status", "values": [ "200" ] }
    ],
    "baseUnit": "seconds",
    "description": "Timer of RestTemplate operation",
    "measurements": [
        { "statistic": "COUNT", "value": 1.0 },
        { "statistic": "TOTAL_TIME", "value": 0.115555898 },
        { "statistic": "MAX", "value": 0.115555898 }
    ],
    "name": "http.client.requests"
}</code></pre>
<p>&#160;</p>
</li>
<li><p><strong>&#25968;&#25454;&#28304;</strong></p>
<p>&#23545;&#20110;&#37027;&#20123;&#20351;&#29992;&#20102;&#25968;&#25454;&#24211;&#30340;&#31995;&#32479;&#65292;&#20102;&#35299;&#25968;&#25454;&#28304;&#30340;&#20855;&#20307;&#24773;&#20917;&#26159;&#38750;&#24120;&#26377;&#24517;&#35201;&#30340;&#65292;&#20363;&#22914;&#65292;&#24403;&#21069;&#30340;&#36830;&#25509;&#27744;&#37197;&#32622;&#30340;&#22823;&#23567;&#26159;&#20160;&#20040;&#26679;&#30340;&#65292;&#26377;&#22810;&#23569;&#20010;&#36830;&#25509;&#22788;&#20110;&#27963;&#36291;&#29366;&#24577;&#31561;&#12290;&#22914;&#26524;&#36830;&#25509;&#27744;&#32463;&#24120;&#34987;&#21344;&#28385;&#65292;&#23548;&#33268;&#19994;&#21153;&#20195;&#30721;&#26080;&#27861;&#33719;&#21462;&#36830;&#25509;&#65292;&#37027;&#20040;&#26080;&#35770;&#26159;&#35753;&#19994;&#21153;&#32447;&#31243;&#31561;&#24453;&#36830;&#25509;&#65292;&#36824;&#26159;&#31561;&#24453;&#36229;&#26102;&#21518;&#25253;&#38169;&#37117;&#21487;&#33021;&#24433;&#21709;&#19994;&#21153;&#12290;</p>
<p>&#21482;&#35201;&#22312; Spring &#19978;&#19979;&#25991;&#20013;&#23384;&#22312; <code>DataSource</code><span class="&#27880;&#37322;&#32534;&#21495;">12</span> Bean&#65292;Spring Boot Actuator &#23601;&#20250;&#33258;&#21160;&#37197;&#32622;&#23545;&#24212;&#30340;&#24230;&#37327;&#25351;&#26631;&#65292;&#22914;&#26524;&#25105;&#20204;&#20351;&#29992;&#30340;&#26159; HikariCP&#65292;&#36824;&#20250;&#26377;&#39069;&#22806;&#30340;&#20449;&#24687;&#12290;&#35775;&#38382; <code>/actuator/metrics</code> &#21518;&#33021;&#30475;&#21040;&#19979;&#38754;&#36825;&#20123;&#26174;&#31034;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>{
    "names": [
        "hikaricp.connections",
        "hikaricp.connections.acquire",
        "hikaricp.connections.active",
        "hikaricp.connections.creation",
        "hikaricp.connections.idle",
        "hikaricp.connections.max",
        "hikaricp.connections.min",
        "hikaricp.connections.pending",
        "hikaricp.connections.timeout",
        "hikaricp.connections.usage",
        "jdbc.connections.max",
        "jdbc.connections.min"
        // &#30465;&#30053;&#20854;&#20182;&#26080;&#20851;&#30340;&#20869;&#23481;
    ]
}</code></pre>
<p>&#32780;&#20855;&#20307;&#21040; <code>/actuator/metrics/hikaricp.connections</code> &#21017;&#26159;&#36825;&#26679;&#30340;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>{
    "availableTags": [
        { "tag": "pool", "values": [ "HikariPool-1" ] }
    ],
    "baseUnit": null,
    "description": "Total connections",
    "measurements": [
        { "statistic": "VALUE", "value": 10.0 }
    ],
    "name": "hikaricp.connections"
}</code></pre>
<p>&#36890;&#36807;&#36825;&#20123;&#24230;&#37327;&#25351;&#26631;&#65292;&#25105;&#20204;&#21487;&#20197;&#36731;&#26494;&#22320;&#25484;&#25569;&#31995;&#32479;&#20013;&#25968;&#25454;&#28304;&#30340;&#22823;&#27010;&#24773;&#20917;&#65292;&#22312;&#36935;&#21040;&#38382;&#39064;&#26102;&#26356;&#22909;&#22320;&#36827;&#34892;&#20915;&#31574;&#12290;</p>
</li>
</ol><p class="&#27880;&#37322;&#20869;&#23481;"><span class="&#27880;&#37322;&#32534;&#21495;&#19979;">10</span>&#20851;&#20110; Spring MVC <code>Controller</code> &#31867;&#21644;&#30456;&#20851;&#27880;&#35299;&#30340;&#20869;&#23481;&#20250;&#22312;&#31532; 11 &#31456;&#20013;&#35814;&#32454;&#20171;&#32461;&#12290;</p><p class="&#27880;&#37322;&#20869;&#23481;"><span class="&#27880;&#37322;&#32534;&#21495;&#19979;">11</span><code>RestTemplate</code> &#26159;&#20197;&#21516;&#27493;&#26041;&#24335;&#35775;&#38382; HTTP &#26381;&#21153;&#30340;&#65292;&#32780; <code>WebClient</code> &#26159;&#20197;&#38750;&#38459;&#22622;&#26041;&#24335;&#35775;&#38382;&#30340;&#65292;&#20851;&#20110; <code>WebClient</code> &#30340;&#20869;&#23481;&#20250;&#22312;&#31532; 11 &#31456;&#20013;&#35814;&#32454;&#20171;&#32461;&#12290;</p><p class="&#27880;&#37322;&#20869;&#23481;"><span class="&#27880;&#37322;&#32534;&#21495;&#19979;">12</span><code>DataSource</code> &#25509;&#21475;&#30340;&#23454;&#29616;&#22522;&#26412;&#26159;&#26576;&#20010;&#25968;&#25454;&#24211;&#36830;&#25509;&#27744;&#65292;&#27604;&#22914; Spring Boot &#40664;&#35748;&#30340; HikariCP&#65292;&#20197;&#21450;&#25105;&#20204;&#20250;&#20171;&#32461;&#21040;&#30340; Alibaba Druid &#36830;&#25509;&#27744;&#12290;</p><h3 id="nav_point_82">5.2.3&#12288;&#33258;&#23450;&#20041;&#24230;&#37327;&#25351;&#26631;</h3><p>Spring Boot Actuator &#20869;&#32622;&#30340;&#24230;&#37327;&#25351;&#26631;&#21487;&#20197;&#24110;&#21161;&#25105;&#20204;&#25484;&#25569;&#31995;&#32479;&#30340;&#24773;&#20917;&#65292;&#20294;&#20809;&#20102;&#35299;&#31995;&#32479;&#26159;&#36828;&#36828;&#19981;&#22815;&#30340;&#65292;&#31995;&#32479;&#36816;&#34892;&#27491;&#24120;&#65292;&#20294;&#19994;&#21153;&#25351;&#26631;&#21364;&#19968;&#36335;&#19979;&#28369;&#30340;&#24773;&#20917;&#24182;&#19981;&#23569;&#35265;&#65292;&#22240;&#27492;&#36824;&#38656;&#35201;&#38024;&#23545;&#21508;&#31181;&#19994;&#21153;&#20570;&#23545;&#24212;&#30340;&#25968;&#25454;&#22475;&#28857;&#65292;&#36890;&#36807;&#19994;&#21153;&#25351;&#26631;&#25105;&#20204;&#20063;&#21487;&#20197;&#21453;&#36807;&#26469;&#36827;&#19968;&#27493;&#20102;&#35299;&#31995;&#32479;&#30340;&#24773;&#20917;&#12290;</p><p>&#26377;&#20004;&#31181;&#32465;&#23450; <code>Meter</code> &#30340;&#26041;&#27861;&#65292;&#19968;&#33324;&#21487;&#20197;&#32771;&#34385;&#20351;&#29992;&#21518;&#32773;&#65306;</p><ul>
<li class="&#31532;1&#32423;&#26080;&#24207;&#21015;&#34920;">&#27880;&#20837; Spring &#19978;&#19979;&#25991;&#20013;&#30340; <code>MeterRegistry</code>&#65292;&#36890;&#36807;&#23427;&#26469;&#32465;&#23450; <code>Meter</code>&#65307;</li>
<li class="&#31532;1&#32423;&#26080;&#24207;&#21015;&#34920;">&#35753; Bean &#23454;&#29616; <code>MeterBinder</code>&#65292;&#22312;&#20854; <code>bindTo()</code> &#26041;&#27861;&#20013;&#32465;&#23450; <code>Meter</code>&#12290;</li>
</ul><p>&#19979;&#38754;&#65292;&#35753;&#25105;&#20204;&#36890;&#36807;&#20108;&#36827;&#21046;&#22902;&#33590;&#24215;&#39033;&#30446;&#20013;&#30340;&#19968;&#20010;&#20363;&#23376;&#26469;&#20102;&#35299;&#19968;&#19979;&#22914;&#20309;&#33258;&#23450;&#20041;&#24230;&#37327;&#25351;&#26631;&#12290;</p><blockquote>
<p><strong>&#38656;&#27714;&#25551;&#36848;</strong>&#12288;&#38376;&#24215;&#24320;&#22987;&#33829;&#19994;&#21518;&#65292;&#25105;&#20204;&#35201;&#39057;&#32321;&#20851;&#27880;&#32463;&#33829;&#24773;&#20917;&#65292;&#20687;&#35746;&#21333;&#24635;&#31508;&#25968;&#12289;&#24635;&#37329;&#39069;&#12289;&#23458;&#21333;&#20215;&#31561;&#37117;&#26159;&#24120;&#35265;&#30340;&#32463;&#33829;&#25351;&#26631;&#65292;&#26368;&#22909;&#33021;&#26377;&#20010;&#22320;&#26041;&#21487;&#20197;&#35753;&#32463;&#33829;&#32773;&#26041;&#20415;&#22320;&#30475;&#21040;&#36825;&#20123;&#20449;&#24687;&#12290;</p>
</blockquote><p>&#20197; 5.1.4 &#33410;&#30340; binarytea-endpoint &#20316;&#20026;&#22522;&#30784;&#65292;&#22686;&#21152;&#22914;&#34920; 5-10 &#25152;&#31034;&#30340;&#19977;&#20010;&#32463;&#33829;&#25351;&#26631;&#65292;&#29992;&#26469;&#35760;&#24405;&#33258;&#24320;&#22987;&#33829;&#19994;&#36215;&#30340;&#32463;&#33829;&#24773;&#20917;&#65292;&#30456;&#20449;&#26159;&#20010;&#32463;&#33829;&#32773;&#37117;&#20851;&#24515;&#33258;&#24049;&#30340;&#24215;&#26159;&#19981;&#26159;&#36186;&#38065;&#21543;&#65311;&#22823;&#23478;&#21487;&#20197;&#22312;&#26412;&#20070;&#37197;&#22871;&#31034;&#20363;&#30340; ch5/binarytea-metrics &#30446;&#24405;&#20013;&#25214;&#21040;&#36825;&#20010;&#20363;&#23376;&#12290;</p><p><strong>&#34920; 5-10&#12288;&#19977;&#20010;&#32463;&#33829;&#25351;&#26631;</strong></p><table border="1" width="90%">
<thead>
<tr>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#25351;&#26631;&#21517;&#31216;</p></th>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#31867;&#22411;</p></th>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#21547;&#20041;</p></th>
</tr>
</thead>
<tbody>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>order.count</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>Counter</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#24635;&#35746;&#21333;&#25968;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>order.amount.sum</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>Counter</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#24635;&#35746;&#21333;&#37329;&#39069;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>order.amount.average</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>Gauge</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#23458;&#21333;&#20215;</p></td>
</tr>
</tbody>
</table><p>&#38500;&#27492;&#20043;&#22806;&#65292;&#20026;&#20102;&#28436;&#31034; <code>DistributionSummary</code> &#30340;&#29992;&#27861;&#65292;&#25105;&#20204;&#36824;&#39069;&#22806;&#22686;&#21152;&#20102;&#19968;&#20010; <code>order.summary</code> &#30340;&#25351;&#26631;&#65292;&#21487;&#20197;&#36755;&#20986; 95 &#20998;&#20301;&#30340;&#35746;&#21333;&#24773;&#20917; <span class="&#27880;&#37322;&#32534;&#21495;">13</span>&#12290;&#23545;&#24212;&#30340; <code>Meter</code> &#37197;&#32622;&#19982;&#32465;&#23450;&#20195;&#30721;&#22914;&#20195;&#30721;&#31034;&#20363; 5-6 &#25152;&#31034;&#65292;&#20854;&#20013;&#32465;&#23450;&#20102;&#22235;&#20010; <code>Meter</code>&#65288;&#20026;&#20102;&#26041;&#20415;&#28436;&#31034;&#65292;&#23458;&#21333;&#20215;&#20351;&#29992;&#20102;&#19968;&#20010;&#25972;&#25968;&#65289;&#65292;&#36824;&#25552;&#20379;&#20102;&#19968;&#20010;&#26032;&#30340;&#19979;&#35746;&#21333;&#26041;&#27861;&#65292;&#29992;&#26469;&#25913;&#21464;&#21508; <code>Meter</code> &#30340;&#20540;&#12290;</p><p class="&#27880;&#37322;&#20869;&#23481;"><span class="&#27880;&#37322;&#32534;&#21495;&#19979;">13</span>&#20854;&#23454;&#35745;&#25968;&#12289;&#27714;&#21644;&#19982;&#24179;&#22343;&#20540;&#37117;&#21487;&#20197;&#36890;&#36807;&#19968;&#20010; <code>DistributionSummary</code> &#26469;&#23454;&#29616;&#65292;&#20294;&#36825;&#37324;&#20026;&#20102;&#28436;&#31034;&#65292;&#27809;&#26377;&#21512;&#24182;&#12290;</p><blockquote>
<p><strong>&#20195;&#30721;&#31034;&#20363; 5-6</strong>&#12288;<code>SalesMetrics</code> &#30340;&#20195;&#30721;&#29255;&#27573;</p>
</blockquote><pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>@Component
public class SalesMetrics implements MeterBinder {
    private Counter orderCount;
    private Counter totalAmount;
    private DistributionSummary orderSummary;
    private AtomicInteger averageAmount = new AtomicInteger();

    @Override
    public void bindTo(MeterRegistry registry) {
        this.orderCount = registry.counter("order.count", "direction", "income");
        this.totalAmount = registry.counter("order.amount.sum", "direction", "income");
        this.orderSummary = registry.summary("order.summary", "direction", "income");
        registry.gauge("order.amount.average", averageAmount);
    }

    public void makeNewOrder(int amount) {
        orderCount.increment();
        totalAmount.increment(amount);
        orderSummary.record(amount);
        averageAmount.set((int) orderSummary.mean());
    }
}</code></pre><p>&#30001;&#20110;&#29616;&#38454;&#27573;&#36824;&#27809;&#26377;&#24320;&#21457;&#19979;&#21333;&#30340;&#23458;&#25143;&#31471;&#65292;&#25105;&#20204;&#21487;&#20197;&#22312; <code>BinaryTeaApplication</code> &#36825;&#20010;&#20027;&#31243;&#24207;&#20013;&#36890;&#36807; 2.4.2 &#33410;&#20013;&#20171;&#32461;&#30340;&#23450;&#26102;&#20219;&#21153;&#26469;&#23450;&#26102;&#19979;&#21333;&#65292;&#22914;&#20195;&#30721;&#31034;&#20363; 5-7 &#25152;&#31034;&#65292;&#20854;&#20013;&#37329;&#39069;&#20026; 0 &#33267; 100 &#20803;&#20869;&#30340;&#38543;&#26426;&#25972;&#25968; <span class="&#27880;&#37322;&#32534;&#21495;">14</span>&#65292;&#27599;&#38548; 5 &#31186;&#20250;&#19979;&#19968;&#21333;&#24182;&#25171;&#21360;&#26085;&#24535;&#12290;</p><p class="&#27880;&#37322;&#20869;&#23481;"><span class="&#27880;&#37322;&#32534;&#21495;&#19979;">14</span>&#37329;&#39069;&#30340;&#34920;&#31034;&#24456;&#26377;&#35762;&#31350;&#65292;&#29992;&#28014;&#28857;&#25968;&#26469;&#34920;&#31034;&#37329;&#39069;&#26159;&#20010;&#24456;&#31967;&#31957;&#30340;&#20570;&#27861;&#12290;&#36890;&#24120;&#24314;&#35758;&#20351;&#29992;&#19987;&#38376;&#30340; <code>Money</code> &#31867;&#65292;&#26368;&#19981;&#27982;&#20063;&#35201;&#36873;&#25321;&#26368;&#23567;&#30340;&#21333;&#20301;&#20174;&#32780;&#23613;&#21487;&#33021;&#29992;&#25972;&#25968;&#26469;&#34920;&#31034;&#37329;&#39069;&#65292;&#20363;&#22914;&#65292;&#20197;&#20998;&#20316;&#20026;&#21333;&#20301;&#65292;&#29992; <code>long</code> &#26469;&#34920;&#31034;&#37329;&#39069;&#12290;&#26412;&#20070;&#30340;&#21518;&#32493;&#31456;&#33410;&#20250;&#20171;&#32461; Joda Money &#30340;&#29992;&#27861;&#12290;</p><blockquote>
<p><strong>&#20195;&#30721;&#31034;&#20363; 5-7</strong>&#12288;&#21487;&#20197;&#23450;&#26102;&#19979;&#21333;&#30340;&#20027;&#31243;&#24207;&#20195;&#30721;&#29255;&#27573;</p>
</blockquote><pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>@SpringBootApplication
@EnableScheduling
public class BinaryTeaApplication {
    private static Logger logger = LoggerFactory.getLogger(BinaryTeaApplication.class);
    private Random random = new Random();
    @Autowired
    private SalesMetrics salesMetrics;

    public static void main(String[] args) {
        SpringApplication.run(BinaryTeaApplication.class, args);
    }

    @Scheduled(fixedRate = 5000, initialDelay = 1000)
    public void periodicallyMakeAnOrder() {
        int amount = random.nextInt(100);
        salesMetrics.makeNewOrder(amount);
        logger.info("Make an order of RMB {} yuan.", amount);
    }
}</code></pre><p>&#27492;&#26102;&#65292;&#36890;&#36807; <code>/actuator/metrics</code> &#25105;&#20204;&#20250;&#30475;&#21040;&#22810;&#20986;&#20102;&#22914;&#19979;&#20960;&#20010;&#25351;&#26631;&#65306;</p><pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code class="language-{">    "names": [
        "order.amount.average",
        "order.amount.sum",
        "order.count",
        "order.summary",
        // &#30465;&#30053;&#20854;&#20182;&#20869;&#23481;
    ]
}</code></pre><p>&#20855;&#20307;&#35775;&#38382; <code>/actuator/metrics/order.summary</code> &#21017;&#33021;&#30475;&#21040;&#31867;&#20284;&#19979;&#38754;&#36825;&#26679;&#30340;&#36755;&#20986;&#65306;</p><pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>{
    "availableTags": [
        { "tag": "direction", "values": [ "income" ] }
    ],
    "baseUnit": null,
    "description": null,
    "measurements": [
        { "statistic": "COUNT", "value": 168.0 },
        { "statistic": "TOTAL", "value": 7890.0 },
        { "statistic": "MAX", "value": 95.0 }
    ],
    "name": "order.summary"
}</code></pre><p>Spring Boot Actuator &#20013;&#21487;&#20197;&#23545; Micrometer &#30340;&#24230;&#37327;&#25351;&#26631;&#20570;&#24456;&#22810;&#23450;&#21046;&#65292;&#25105;&#20204;&#26082;&#21487;&#20197;&#25353;&#29031; Micrometer &#30340;&#23448;&#26041;&#20570;&#27861;&#29992; <code>MeterFilter</code> &#31934;&#30830;&#22320;&#36827;&#34892;&#35843;&#25972;&#65292;&#20063;&#21487;&#20197;&#31616;&#21333;&#22320;&#20351;&#29992;&#37197;&#32622;&#26469;&#20570;&#20123;&#24120;&#35268;&#30340;&#25913;&#21160;&#12290;</p><p>&#20363;&#22914;&#65292;&#21487;&#20197;&#20687;&#19979;&#38754;&#36825;&#26679;&#26469;&#35774;&#32622;&#20844;&#20849;&#26631;&#31614;&#65292;&#23558; <code>region</code> &#26631;&#31614;&#30340;&#20540;&#35774;&#32622;&#20026; <code>cn-shanghai-1</code>&#65306;</p><pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>management.metrics.tags.region=cn-shanghai-1</code></pre><p>&#38024;&#23545;&#27599;&#20010; <code>Meter</code> &#20063;&#26377;&#19968;&#20123;&#23545;&#24212;&#30340;&#23646;&#24615;&#65292;&#22914;&#34920; 5-11 &#25152;&#31034;&#65292;&#34920;&#20013;&#32473;&#20986;&#30340;&#26159;&#21069;&#32512;&#65292;&#22312;&#20854;&#21518;&#38754;&#24102;&#19978;&#20855;&#20307;&#30340;&#24230;&#37327;&#25351;&#26631;&#21517;&#31216;&#21518;&#65292;&#21363;&#21487;&#26377;&#38024;&#23545;&#24615;&#22320;&#36827;&#34892;&#35774;&#32622;&#20102;&#65292;&#20363;&#22914; <code>management.metrics.enable.order.amount.average=false</code>&#12290;</p><p><strong>&#34920; 5-11&#12288;&#37096;&#20998;&#38024;&#23545;&#21333;&#20010; <code>Meter</code> &#30340;&#23646;&#24615;&#21069;&#32512;</strong></p><table border="1" width="90%">
<thead>
<tr>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#23646;&#24615;&#21069;&#32512;</p></th>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#35828;&#26126;</p></th>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#36866;&#29992;&#33539;&#22260;</p></th>
</tr>
</thead>
<tbody>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>management.metrics.enable</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#26159;&#21542;&#24320;&#21551;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#20840;&#37096;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>management.metrics.distribution.minimum-expected-value</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#20998;&#24067;&#32479;&#35745;&#26102;&#33539;&#22260;&#30340;&#26368;&#23567;&#20540;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>Timer</code> &#19982; <code>DistributionSummary</code></p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>management.metrics.distribution.maximum-expected-value</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#20998;&#24067;&#32479;&#35745;&#26102;&#33539;&#22260;&#30340;&#26368;&#22823;&#20540;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>Timer</code> &#19982; <code>DistributionSummary</code></p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>management.metrics.distribution.percentiles</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#20998;&#24067;&#32479;&#35745;&#26102;&#24076;&#26395;&#35745;&#31639;&#30340;&#30334;&#20998;&#20301;&#20540;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>Timer</code> &#19982; <code>DistributionSummary</code></p></td>
</tr>
</tbody>
</table><p>&#22914;&#26524;&#24076;&#26395;&#36755;&#20986; 95 &#20998;&#20301;&#30340;&#35746;&#21333;&#24773;&#20917;&#65292;&#21487;&#20197;&#20687;&#20195;&#30721;&#31034;&#20363; 5-8 &#37027;&#26679;&#20462;&#25913; <code>application.properties</code> &#25991;&#20214;&#12290;</p><blockquote>
<p><strong>&#20195;&#30721;&#31034;&#20363; 5-8</strong>&#12288;&#20462;&#25913;&#21518;&#30340; <code>application.properties</code></p>
</blockquote><pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>binarytea.ready=true
binarytea.open-hours=8:30-22:00

management.endpoint.health.show-details=always
management.endpoints.web.exposure.include=health,info,shop,metrics

management.metrics.distribution.percentiles.order.summary=0.95</code></pre><p>&#37197;&#32622;&#21518;&#20250;&#22810;&#20986;&#19968;&#20010; <code>order.summary.percentile</code> &#30340;&#24230;&#37327;&#25351;&#26631;&#65292;&#20855;&#20307;&#30340;&#20869;&#23481;&#22823;&#33268;&#22914;&#19979;&#25152;&#31034;&#65306;</p><pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>{
    "availableTags": [
        { "tag": "phi", "values": [ "0.95" ] },
        { "tag": "direction", "values": [ "income" ] }
    ],
    "baseUnit": null,
    "description": null,
    "measurements": [
        { "statistic": "VALUE", "value": 87 }
    ],
    "name": "order.summary.percentile"
}</code></pre><blockquote>
<p><strong>&#33590;&#27463;&#26102;&#38388;&#65306;&#24615;&#33021;&#20998;&#26512;&#26102;&#30340; 95 &#32447;&#19982; 99 &#32447;&#26159;&#20160;&#20040;&#21547;&#20041;</strong></p>
<p>&#35828;&#21040;&#34913;&#37327;&#19968;&#20010;&#25509;&#21475;&#30340;&#32791;&#26102;&#24590;&#20040;&#26679;&#65292;&#22823;&#23478;&#30340;&#31532;&#19968;&#21453;&#24212;&#22823;&#22810;&#26159;&#20351;&#29992;&#24179;&#22343;&#21709;&#24212;&#26102;&#38388;&#12290;&#30340;&#30830;&#65292;&#24179;&#22343;&#32791;&#26102;&#33021;&#20195;&#34920;&#22823;&#37096;&#20998;&#24773;&#20917;&#19979;&#25509;&#21475;&#30340;&#34920;&#29616;&#12290;&#20551;&#35774;&#19968;&#20010;&#25509;&#21475;&#30340;&#26368;&#23567;&#32791;&#26102;&#20026; 4 &#27627;&#31186;&#65292;&#24179;&#22343;&#32791;&#26102;&#20026; 8 &#27627;&#31186;&#8212;&#30475;&#36215;&#26469;&#24615;&#33021;&#25402;&#22909;&#30340;&#65292;&#20294;&#22914;&#26524;&#32463;&#24120;&#20250;&#26377;&#37027;&#20040;&#20960;&#20010;&#35831;&#27714;&#30340;&#26102;&#38388;&#36229;&#36807; 1000 &#27627;&#31186;&#65292;&#37027;&#25105;&#20204;&#26159;&#21542;&#24212;&#35813;&#32487;&#32493;&#21435;&#20248;&#21270;&#23427;&#21602;&#65311;</p>
<p>&#31572;&#26696;&#26159;&#32943;&#23450;&#30340;&#65292;&#23545;&#20110;&#36825;&#31867;&#38271;&#23614;&#30340;&#35831;&#27714;&#65292;&#25105;&#20204;&#36824;&#38656;&#35201;&#21435;&#20570;&#36827;&#19968;&#27493;&#30340;&#20998;&#26512;&#65292;&#36825;&#20854;&#20013;&#24517;&#28982;&#38544;&#34255;&#30528;&#19968;&#20123;&#38382;&#39064;&#12290;&#22312;&#24615;&#33021;&#27979;&#35797;&#20013;&#65292;&#25105;&#20204;&#24448;&#24448;&#20250;&#26356;&#22810;&#22320;&#20851;&#27880; TP95 &#25110;&#32773; TP99&#65288;TP &#26159; Top Percentile &#30340;&#32553;&#20889;&#65289;&#65292;&#20063;&#23601;&#26159;&#36890;&#24120;&#25152;&#35828;&#30340; 95 &#32447;&#21644; 99 &#32447;&#25351;&#26631;&#12290;&#22312; 100 &#20010;&#35831;&#27714;&#20013;&#65292;&#25353;&#32791;&#26102;&#20174;&#23567;&#21040;&#22823;&#25490;&#24207;&#65292;&#31532; 95 &#20010;&#23601;&#26159;&#32791;&#26102;&#30340; 95 &#32447;&#65292;95%&#30340;&#35831;&#27714;&#37117;&#33021;&#22312;&#36825;&#20010;&#26102;&#38388;&#20869;&#23436;&#25104;&#12290;</p>
<p>&#36824;&#26377;&#26356;&#33499;&#21051;&#30340;&#26465;&#20214;&#26159;&#35201;&#21435;&#20998;&#26512; TP9999&#65292;&#20063;&#23601;&#26159; 99.99%&#30340;&#24773;&#20917;&#65292;&#36825;&#26679;&#25165;&#33021;&#30830;&#20445;&#32477;&#22823;&#37096;&#20998;&#35831;&#27714;&#30340;&#32791;&#26102;&#37117;&#36798;&#21040;&#35201;&#27714;&#12290;</p>
</blockquote><h3 id="nav_point_83">5.2.4&#12288;&#24230;&#37327;&#20540;&#30340;&#36755;&#20986;</h3><p>&#36890;&#36807; <code>/actuator/metrics</code> &#34429;&#28982;&#21487;&#20197;&#30475;&#21040;&#27599;&#20010;&#24230;&#37327;&#20540;&#30340;&#24773;&#20917;&#65292;&#20294;&#25105;&#20204;&#26080;&#27861;&#19968;&#30452;&#30447;&#30528;&#36825;&#20010; URI &#30475;&#36755;&#20986;&#12290;&#22312;&#23454;&#38469;&#29983;&#20135;&#29615;&#22659;&#20013;&#65292;&#25105;&#20204;&#38656;&#35201;&#19968;&#20010;&#26356;&#25104;&#29087;&#30340;&#24230;&#37327;&#20540;&#36755;&#20986;&#21644;&#25910;&#38598;&#30340;&#26041;&#26696;&#12290;&#22909;&#22312; Micrometer &#21644; Spring Boot &#26089;&#24050;&#32463;&#32771;&#34385;&#21040;&#20102;&#36825;&#20123;&#65292;&#20026;&#25105;&#20204;&#20934;&#22791;&#22909;&#20102;&#12290;</p><ol>
<li><p><strong>&#36755;&#20986;&#21040;&#26085;&#24535;</strong></p>
<p>Micrometer &#25552;&#20379;&#20102;&#20960;&#20010;&#22522;&#26412;&#30340; <code>MeterRegistry</code>&#65292;&#20854;&#20013;&#20043;&#19968;&#23601;&#26159; <code>LoggingMeterRegistry</code>&#65292;&#23427;&#21487;&#20197;&#23450;&#26102;&#23558;&#31995;&#32479;&#20013;&#30340;&#21508;&#20010;&#24230;&#37327;&#25351;&#26631;&#36755;&#20986;&#21040;&#26085;&#24535;&#20013;&#12290;&#26377;&#20102;&#32467;&#26500;&#21270;&#30340;&#26085;&#24535;&#20449;&#24687;&#65292;&#23601;&#33021;&#36890;&#36807; ELK&#65288;Elasticsearch&#12289;Logstash &#21644; Kibana&#65289;&#31561;&#26041;&#24335;&#23558;&#23427;&#20204;&#25910;&#38598;&#36215;&#26469;&#65292;&#24182;&#21152;&#20197;&#20998;&#26512;&#12290;&#21363;&#20351;&#19981;&#20570;&#21518;&#32493;&#22788;&#29702;&#65292;&#25226;&#36825;&#20123;&#26085;&#24535;&#25918;&#30528;&#65292;&#20316;&#20026;&#26085;&#21518;&#22238;&#28335;&#30340;&#26448;&#26009;&#20063;&#26159;&#21487;&#20197;&#30340;&#12290;</p>
<p>&#21069;&#19968;&#33410;&#30340;&#20363;&#23376;&#20013;&#65292;&#22312; <code>BinaryTeaApplication</code> &#37324;&#21152;&#19978;&#20195;&#30721;&#31034;&#20363; 5-9 &#30340;&#20195;&#30721; <span class="&#27880;&#37322;&#32534;&#21495;">15</span>&#65292;&#29992;&#26469;&#23450;&#20041;&#19968;&#20010;&#32452;&#21512;&#30340; <code>MeterRegistry</code>&#65292;&#20854;&#20013;&#28155;&#21152;&#20102;&#22522;&#30784;&#30340; <code>SimpleMeterRegistry</code> &#21644;&#36755;&#20986;&#26085;&#24535;&#30340; <code>LoggingMeterRegistry</code>&#12290;</p>
<blockquote>
<p><strong>&#20195;&#30721;&#31034;&#20363; 5-9</strong>&#12288;&#32452;&#21512;&#22810;&#20010; <code>MeterRegistry</code> &#30340;&#23450;&#20041;</p>
</blockquote>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>@Bean
public MeterRegistry customMeterRegistry() {
    CompositeMeterRegistry meterRegistry = new CompositeMeterRegistry();
    meterRegistry.add(new SimpleMeterRegistry());
    meterRegistry.add(new LoggingMeterRegistry());
    return meterRegistry;
}</code></pre>
<p>&#36816;&#34892;&#21518;&#65292;&#36807;&#19968;&#27573;&#26102;&#38388;&#23601;&#33021;&#22312;&#25511;&#21046;&#21488;&#36755;&#20986;&#30340;&#26085;&#24535;&#20013;&#30475;&#21040;&#31867;&#20284;&#19979;&#38754;&#30340;&#20869;&#23481;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>2022-02-06 22:44:00.029 INFO 50342 --- [trics-publisher] i.m.c.i.logging.LoggingMeterRegistry : jvm.gc.
pause{action=end of minor GC,cause=Metadata GC Threshold} throughput=0.033333/s mean=0.012s max=0.012s
2022-02-06 22:44:00.030 INFO 50342 --- [trics-publisher] i.m.c.i.logging.LoggingMeterRegistry : order.
summary{direction=income} throughput=0.133333/s mean=40.125 max=84</code></pre>
<p>&#22312;&#29983;&#20135;&#29615;&#22659;&#20013;&#20351;&#29992;&#26102;&#65292;&#25105;&#20204;&#21487;&#20197;&#35843;&#25972;&#26085;&#24535;&#30340;&#37197;&#32622;&#25991;&#20214;&#65292;&#23558; <code>LoggingMeterRegistry</code> &#36755;&#20986;&#30340;&#26085;&#24535;&#25171;&#21360;&#21040;&#21333;&#29420;&#30340;&#26085;&#24535;&#20013;&#65292;&#26041;&#20415;&#31649;&#29702;&#12290;</p>
<p>&#160;</p>
</li>
<li><p><strong>&#36755;&#20986;&#21040; Prometheus</strong></p>
<p>&#22312;&#20171;&#32461; Mircometer &#26102;&#65292;&#25105;&#20204;&#25552;&#21040;&#36807;&#23427;&#25903;&#25345;&#22810;&#31181;&#19981;&#21516;&#30340;&#30417;&#25511;&#31995;&#32479;&#65292;&#23558;&#24230;&#37327;&#20449;&#24687;&#30452;&#25509;&#36755;&#20986;&#21040;&#30417;&#25511;&#31995;&#32479;&#20063;&#26159;&#19968;&#31181;&#24120;&#35265;&#20570;&#27861;&#12290;&#19979;&#38754;&#20197; Prometheus &#20026;&#20363;&#65292;&#20171;&#32461;&#19968;&#19979;&#23427;&#22312; Spring Boot &#31995;&#32479;&#20013;&#35813;&#22914;&#20309;&#25805;&#20316;&#12290;</p>
<p>&#39318;&#20808;&#65292;&#38656;&#35201;&#22312;&#39033;&#30446;&#30340; pom.xml &#20013;&#28155;&#21152; Micrometer &#20026; Prometheus &#32534;&#20889;&#30340; <code>MeterRegistry</code> &#20381;&#36182;&#65292;&#26377;&#20102;&#36825;&#20010;&#20381;&#36182;&#65292;&#21518;&#38754;&#30340;&#20107;&#20132;&#32473; Spring Boot &#30340;&#33258;&#21160;&#37197;&#32622;&#21363;&#21487;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>&lt;dependency&gt;
    &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
    &lt;artifactId&gt;micrometer-registry-prometheus&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
<p>&#38543;&#21518;&#65292;&#22312; <code>application.properties</code> &#20013;&#25918;&#24320;&#23545;&#23545;&#24212;&#31471;&#28857;&#30340;&#25511;&#21046;&#65292;&#35753; <code>prometheus</code> &#31471;&#28857;&#21487;&#20197;&#36890;&#36807; Web &#35775;&#38382;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>management.endpoints.web.exposure.include=health,info,shop,metrics,prometheus</code></pre>
<p>&#20877;&#27425;&#36816;&#34892;&#25105;&#20204;&#30340;&#31243;&#24207;&#65292;&#22312;&#27983;&#35272;&#22120;&#20013;&#35775;&#38382; <code>/actuator/prometheus</code> &#23601;&#33021;&#30475;&#21040;&#19968;&#20010;&#25991;&#26412;&#36755;&#20986;&#65292;Prometheus &#22312;&#32463;&#36807;&#36866;&#24403;&#37197;&#32622;&#21518;&#20250;&#35835;&#21462;&#20854;&#20013;&#30340;&#20869;&#23481;&#65292;&#21487;&#20197;&#30475;&#21040;&#20854;&#20013;&#30340;&#21517;&#31216;&#24050;&#32463;&#20174; Micrometer &#30340;&#20197;&#28857;&#20998;&#38548;&#65292;&#21464;&#20026;&#20102; Prometheus &#30340;&#19979;&#21010;&#32447;&#20998;&#38548;&#65292;&#36825;&#20063;&#26159; Micrometer &#23454;&#29616;&#30340;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code># &#30465;&#30053;&#20102;&#24456;&#22810;&#20869;&#23481;&#65292;&#20197;&#19979;&#20165;&#20026;&#29255;&#27573;
jvm_memory_max_bytes{area="nonheap",id="CodeHeap 'non-profiled nmethods'",} 2.44105216E8
# HELP order_count_total
# TYPE order_count_total counter
order_count_total{direction="income",} 7.0
# HELP order_summary_max
# TYPE order_summary_max gauge
order_summary_max{direction="income",} 76.0
# HELP order_summary
# TYPE order_summary summary
order_summary{direction="income",quantile="0.95",} 79.5
order_summary_count{direction="income",} 7.0
order_summary_sum{direction="income",} 347.0
# HELP tomcat_sessions_active_current_sessions
# TYPE tomcat_sessions_active_current_sessions gauge
tomcat_sessions_active_current_sessions 0.0</code></pre>
</li>
</ol><p class="&#27880;&#37322;&#20869;&#23481;"><span class="&#27880;&#37322;&#32534;&#21495;&#19979;">15</span>5.2.4 &#33410;&#20013;&#30340;&#31034;&#20363;&#22312; ch5/binarytea-export &#39033;&#30446;&#20013;&#12290;</p><h2 id="nav_point_84">5.3&#12288;&#37096;&#32626; Spring Boot &#24212;&#29992;&#31243;&#24207;</h2><p>&#22312; Spring Boot Actuator &#30340;&#24110;&#21161;&#19979;&#65292;&#25105;&#20204;&#26089;&#26089;&#22320;&#23601;&#20934;&#22791;&#22909;&#20102;&#19968;&#20123;&#25163;&#27573;&#26469;&#25484;&#25569;&#31995;&#32479;&#22312;&#36816;&#34892;&#26102;&#30340;&#21508;&#31181;&#25351;&#26631;&#65292;&#29616;&#22312;&#23601;&#24046;&#20020;&#38376;&#19968;&#33050;&#65292;&#35753;&#31995;&#32479;&#22312;&#26381;&#21153;&#22120;&#19978;&#36305;&#36215;&#26469;&#20102;&#65292;&#32780;&#36825;&#20063;&#26159;&#19968;&#38376;&#23398;&#38382;&#65292;&#22312;&#36825;&#19968;&#33410;&#37324;&#23601;&#35753;&#25105;&#20204;&#19968;&#21516;&#26469;&#20102;&#35299;&#19968;&#19979;&#20854;&#20013;&#30340;&#31192;&#35776;&#12290;</p><h3 id="nav_point_85">5.3.1&#12288;&#21487;&#25191;&#34892; Jar &#21450;&#20854;&#21407;&#29702;</h3><p>&#25918;&#21040;&#20197;&#21069;&#65292;&#35201;&#36816;&#34892; Java EE &#30340;&#24212;&#29992;&#31243;&#24207;&#38656;&#35201;&#19968;&#20010;&#24212;&#29992;&#23481;&#22120;&#65292;&#27604;&#22914; JBoss &#25110;&#32773; Tomcat&#12290;&#20294;&#38543;&#30528;&#25216;&#26415;&#30340;&#21457;&#23637;&#65292;&#22806;&#32622;&#23481;&#22120;&#24050;&#32463;&#19981;&#20877;&#26159;&#24517;&#36873;&#39033;&#20102;&#65292;Spring Boot &#21487;&#20197;&#20869;&#23884; Tomcat&#12289;Jetty &#31561;&#23481;&#22120;&#65292;&#19968;&#21477;&#31616;&#21333;&#30340; <code>java -jar</code> &#21629;&#20196;&#23601;&#33021;&#35753;&#25105;&#20204;&#30340;&#24037;&#31243;&#20687;&#20010;&#26222;&#36890;&#36827;&#31243;&#19968;&#26679;&#36816;&#34892;&#36215;&#26469;&#12290;</p><ol>
<li><p><strong>&#36890;&#36807; Maven &#25171;&#21253;&#25972;&#20010;&#24037;&#31243;</strong></p>
<p>&#22312;&#29992; Maven &#21629;&#20196;&#25171;&#21253;&#21069;&#65292;&#20808;&#26469;&#22238;&#39038;&#19968;&#19979; pom.xml &#20013;&#37197;&#32622;&#30340;&#25554;&#20214;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;</code></pre>
<p><code>spring-boot-maven-plugin</code> &#20250;&#22312; Maven &#30340;&#25171;&#21253;&#36807;&#31243;&#20013;&#33258;&#21160;&#20171;&#20837;&#65292;&#38500;&#20102;&#29983;&#25104;&#26222;&#36890;&#30340; Jar &#21253;&#22806;&#65292;&#36824;&#20250;&#29983;&#25104;&#19968;&#20010;&#21253;&#21547;&#25152;&#26377;&#20381;&#36182;&#30340; Fat Jar&#12290;&#20197;&#19978;&#19968;&#33410;&#29992;&#21040;&#30340; ch5/binarytea-export &#20026;&#20363;&#65292;&#25171;&#24320;&#19968;&#20010;&#32456;&#31471;&#65288;macOS &#20013;&#30340;&#32456;&#31471;&#65292;&#23545;&#24212; Windows &#20013;&#30340; CMD &#25110;&#32773; PowerShell&#65289;&#65292;&#22312;&#24037;&#31243;&#30446;&#24405;&#20013;&#65288;&#21363; pom.xml &#30340;&#30446;&#24405;&#65289;&#38190;&#20837;&#22914;&#19979;&#21629;&#20196; <span class="&#27880;&#37322;&#32534;&#21495;">16</span>&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>&#9656; mvn clean package -Dmaven.test.skip</code></pre>
<p>&#38543;&#21518;&#65292;&#26597;&#30475; <code>target</code> &#30446;&#24405;&#30340;&#20869;&#23481;&#65292;&#22823;&#33268;&#20250;&#26159;&#19979;&#38754;&#36825;&#26679;&#30340;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>total 38712
-rw-r--r--  1 digitalsonic  staff    19M  2  7 22:43 binarytea-0.0.1-SNAPSHOT.jar
-rw-r--r--  1 digitalsonic  staff   8.3K  2  7 22:43 binarytea-0.0.1-SNAPSHOT.jar.original
drwxr-xr-x  5 digitalsonic  staff   160B  2  7 22:43 classes
drwxr-xr-x  3 digitalsonic  staff    96B  2  7 22:43 generated-sources
drwxr-xr-x  3 digitalsonic  staff    96B  2  7 22:43 maven-archiver
drwxr-xr-x  3 digitalsonic  staff    96B  2  7 22:43 maven-status</code></pre>
<p>&#20854;&#20013;&#30340; <code>binarytea-0.0.1-SNAPSHOT.jar.original</code> &#26159;&#21407;&#22987;&#30340; Jar &#21253;&#65292;&#20165;&#21253;&#21547;&#24037;&#31243;&#20195;&#30721;&#32534;&#35793;&#21518;&#30340;&#20869;&#23481;&#65292;&#22823;&#23567;&#21482;&#26377; 8.3KB&#65307;&#32780; <code>binarytea-0.0.1-SNAPSHOT.jar</code> &#21017;&#26377; 19MB&#65292;&#36825;&#23601;&#26159;&#29983;&#25104;&#30340;&#21487;&#25191;&#34892; Jar &#21253;&#12290;&#21482;&#38656;&#31616;&#21333;&#30340;&#19968;&#26465;&#21629;&#20196;&#23601;&#33021;&#23558;&#24037;&#31243;&#36816;&#34892;&#36215;&#26469;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>&#9656; java -jar target/binarytea-0.0.1-SNAPSHOT.jar</code></pre>
<p>&#160;</p>
</li>
<li><p><strong>&#21487;&#25191;&#34892; Jar &#32972;&#21518;&#30340;&#21407;&#29702;</strong></p>
<p><code>binarytea-0.0.1-SNAPSHOT.jar</code> &#30456;&#27604; <code>binarytea-0.0.1-SNAPSHOT.jar.original</code> &#32780;&#35328;&#65292;&#31616;&#30452;&#23601;&#26159;&#19968;&#20010;&#24222;&#28982;&#22823;&#29289;&#65292;&#36890;&#36807; <code>unzip</code> &#21629;&#20196;&#26597;&#30475; Jar &#21253;&#20869;&#23481;&#65292;&#25105;&#20204;&#21487;&#20197;&#30475;&#21040;&#23427;&#22522;&#26412;&#30001;&#20197;&#19979;&#20960;&#37096;&#20998;&#32452;&#25104;&#65306;</p>
<ul>
<li class="&#31532;2&#32423;&#26080;&#24207;&#21015;&#34920;"><strong><code>META-INF</code></strong>&#65292;&#24037;&#31243;&#30340;&#20803;&#25968;&#25454;&#65292;&#20363;&#22914; Maven &#30340;&#25551;&#36848;&#25991;&#20214;&#19982; <code>spring.factories</code> &#25991;&#20214;&#65307;</li>
<li class="&#31532;2&#32423;&#26080;&#24207;&#21015;&#34920;"><strong><code>org/springframework/boot/loader</code></strong>&#65292;Spring Boot &#29992;&#26469;&#24341;&#23548;&#24037;&#31243;&#21551;&#21160;&#30340; Loader &#30456;&#20851;&#31867;&#65307;</li>
<li class="&#31532;2&#32423;&#26080;&#24207;&#21015;&#34920;"><strong><code>BOOT-INF/classes</code></strong>&#65292;&#24037;&#31243;&#33258;&#36523;&#30340;&#31867;&#19982;&#36164;&#28304;&#25991;&#20214;&#65307;</li>
<li class="&#31532;2&#32423;&#26080;&#24207;&#21015;&#34920;"><strong><code>BOOT-INF/lib</code></strong>&#65292;&#24037;&#31243;&#25152;&#20381;&#36182;&#30340;&#21508;&#31181;&#20854;&#20182; Jar &#25991;&#20214;&#12290;</li>
</ul>
<p>&#22823;&#27010;&#23601;&#20687;&#19979;&#38754;&#36825;&#26679;&#65306;</p>
<pre>
&#9656; unzip -l binarytea-0.0.1-SNAPSHOT.jar
Archive:  binarytea-0.0.1-SNAPSHOT.jar
  Length      Date    Time    Name
---------  ---------- -----   ----
        0  02-07-2022 22:43   META-INF/
      472  02-07-2022 22:43   META-INF/MANIFEST.MF
      103  02-07-2022 22:43   META-INF/spring.factories
# &#30465;&#30053;&#22823;&#37327;META-INF/&#19979;&#30340;&#25991;&#20214;
        0  02-01-1980 00:00   org/
        0  02-01-1980 00:00   org/springframework/
        0  02-01-1980 00:00   org/springframework/boot/
        0  02-01-1980 00:00   org/springframework/boot/loader/
     5871  02-01-1980 00:00   org/springframework/boot/loader/ClassPathIndexFile.class
# &#30465;&#30053;&#22823;&#37327;org/&#19979;&#30340;&#25991;&#20214;
        0  02-07-2022 22:43   BOOT-INF/
        0  02-07-2022 22:43   BOOT-INF/classes/

      242  02-07-2022 22:43   BOOT-INF/classes/application.properties
        0  02-07-2022 22:43   BOOT-INF/classes/learning/
        0  02-07-2022 22:43   BOOT-INF/classes/learning/spring/
# &#30465;&#30053;&#22823;&#37327;BOOT-INF/classes/&#19979;&#30340;&#25991;&#20214;
        0  02-07-2022 22:43   BOOT-INF/lib/
  1423985  01-20-2022 14:03   BOOT-INF/lib/spring-boot-2.6.3.jar
  1627754  01-20-2022 14:02   BOOT-INF/lib/spring-boot-autoconfigure-2.6.3.jar
# &#30465;&#30053;&#22823;&#37327;BOOT-INF/lib/&#19979;&#30340;&#25991;&#20214;
---------                     -------
 19930105                     141 files
</pre>
<p>&#36816;&#34892;&#36825;&#20010; Jar &#25152;&#38656;&#35201;&#30340;&#20449;&#24687;&#37117;&#35760;&#24405;&#22312;&#20102; <code>META-INF/MANIFEST.MF</code> &#20013;&#65292;&#20855;&#20307;&#20869;&#23481;&#22914;&#19979;&#25152;&#31034;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>Manifest-Version: 1.0
Created-By: Maven JAR Plugin 3.2.2
Build-Jdk-Spec: 11
Implementation-Title: BinaryTea
Implementation-Version: 0.0.1-SNAPSHOT
Main-Class: org.springframework.boot.loader.JarLauncher
Start-Class: learning.spring.binarytea.BinaryTeaApplication
Spring-Boot-Version: 2.6.3
Spring-Boot-Classes: BOOT-INF/classes/
Spring-Boot-Lib: BOOT-INF/lib/
Spring-Boot-Classpath-Index: BOOT-INF/classpath.idx
Spring-Boot-Layers-Index: BOOT-INF/layers.idx</code></pre>
<p><code>java</code> &#21629;&#20196;&#20250;&#25214;&#21040; <code>Main-Class</code> &#20316;&#20026;&#21551;&#21160;&#31867;&#65292;Spring Boot &#25552;&#20379;&#20102;&#19977;&#31181;&#19981;&#21516;&#30340; <code>Launcher</code>&#65292;&#21487;&#20197;&#20174;&#20869;&#23884;&#25991;&#20214;&#20013;&#21152;&#36733;&#21551;&#21160;&#25152;&#38656;&#30340;&#36164;&#28304;&#65306;</p>
<ul>
<li class="&#31532;2&#32423;&#26080;&#24207;&#21015;&#34920;"><strong><code>JarLauncher</code></strong>&#65292;&#20174; Jar &#21253;&#30340;&#22266;&#23450;&#20301;&#32622;&#21152;&#36733;&#20869;&#23884;&#36164;&#28304;&#65292;&#21363; <code>BOOT-INF/lib/</code>&#65307;</li>
<li class="&#31532;2&#32423;&#26080;&#24207;&#21015;&#34920;"><strong><code>WarLauncher</code></strong>&#65292;&#20174; War &#21253;&#30340;&#22266;&#23450;&#20301;&#32622;&#21152;&#36733;&#20869;&#23884;&#36164;&#28304;&#65292;&#20998;&#21035;&#20026; <code>WEB-INF/lib/</code> &#21644; <code>WEB-INF/lib-provided/</code>&#65307;</li>
<li class="&#31532;2&#32423;&#26080;&#24207;&#21015;&#34920;"><strong><code>PropertiesLauncher</code></strong><span class="&#27880;&#37322;&#32534;&#21495;">17</span>&#65292;&#40664;&#35748;&#20174; <code>BOOT-INF/lib/</code> &#21152;&#36733;&#36164;&#28304;&#65292;&#20294;&#21487;&#20197;&#36890;&#36807;&#29615;&#22659;&#21464;&#37327;&#26469;&#25351;&#23450;&#39069;&#22806;&#30340;&#20301;&#32622;&#12290;</li>
</ul>
<p>&#40664;&#35748;&#29983;&#25104;&#30340;&#24037;&#31243;&#20250;&#20351;&#29992; <code>JarLauncher</code> &#29983;&#25104;&#21487;&#25191;&#34892; Jar &#21253;&#65292;&#32780;&#21551;&#21160;&#21518;&#25191;&#34892;&#30340;&#20855;&#20307;&#20195;&#30721;&#21017;&#30001; <code>StartClass</code> &#25351;&#23450;&#65292;&#25105;&#20204;&#21487;&#20197;&#30475;&#21040;&#36825;&#20010;&#31867;&#23601;&#26159;&#28155;&#21152;&#20102; <code>@SpringBootApplication</code> &#27880;&#35299;&#30340;&#31867;&#12290;</p>
<p>&#29992;&#36825;&#31181;&#26041;&#24335;&#25171;&#21253;&#26377;&#20004;&#20010;<strong>&#23616;&#38480;</strong>&#12290;</p>
<ul>
<li class="&#31532;2&#32423;&#26080;&#24207;&#21015;&#34920;">Jar &#25991;&#20214;&#20854;&#23454;&#23601;&#26159;&#19968;&#20010; ZIP &#25991;&#20214;&#65292;ZIP &#25991;&#20214;&#21487;&#20197;&#35774;&#32622;&#21387;&#32553;&#21147;&#24230;&#65292;&#20174;&#20165;&#23384;&#20648;&#65288;&#19981;&#21387;&#32553;&#65289;&#21040;&#26368;&#22823;&#21270;&#21387;&#32553;&#65292;&#22312;&#20869;&#23884; Jar &#30340;&#24773;&#20917;&#19979;&#65292;&#25105;&#20204;&#21482;&#33021;&#20351;&#29992; <code>ZipEntry.STORED</code>&#65292;&#21363;&#20165;&#23384;&#20648;&#65292;&#19981;&#21387;&#32553;&#30340;&#26041;&#24335;&#12290;</li>
<li class="&#31532;2&#32423;&#26080;&#24207;&#21015;&#34920;">&#35201;&#33719;&#21462; <code>ClassLoader</code> &#26102;&#24517;&#39035;&#20351;&#29992; <code>Thread.getContextClassLoader()</code>&#65292;&#32780;&#19981;&#33021;&#20351;&#29992; <code>ClassLoader.getSystemClassLoader()</code>&#12290;</li>
</ul>
<p>Spring Boot &#20013;&#36824;&#26377;&#19968;&#31181;&#26356;&#28608;&#36827;&#30340;&#26041;&#24335;&#65292;&#29983;&#25104;&#21487;&#20197;&#30452;&#25509;&#22312; Linux &#20013;&#36816;&#34892;&#30340; Jar &#25991;&#20214;&#65292;&#19981;&#20877;&#38656;&#35201; <code>java -jar</code> &#21629;&#20196;&#65288;&#24403;&#28982;&#65292;&#36825;&#20010;&#25991;&#20214;&#20013;&#19981;&#21253;&#21547; JRE&#65289;&#65292;&#20855;&#20307;&#20462;&#25913; <code>spring-boot-maven-plugin</code> &#37197;&#32622;&#30340;&#26041;&#24335;&#22914;&#19979;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;configuration&gt;
                &lt;executable&gt;true&lt;/executable&gt;
            &lt;/configuration&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;</code></pre>
<p>&#36825;&#26679;&#36890;&#36807; <code>mvn package</code> &#25171;&#20986;&#30340; Jar &#21253;&#20250;&#26356;&#29305;&#27530;&#19968;&#20123;&#65292;&#29992;&#25991;&#26412;&#32534;&#36753;&#22120;&#25110;&#32773; <code>less</code> &#21629;&#20196;&#26597;&#30475;&#36825;&#20010;&#25991;&#20214;&#65292;&#25105;&#20204;&#20250;&#21457;&#29616;&#36825;&#20010;&#25991;&#20214;&#30340;&#22836;&#37096;&#20854;&#23454;&#26159;&#20010; Shell &#33050;&#26412;&#65292;&#21518;&#38754;&#25165;&#26159;&#21387;&#32553;&#30340; Jar &#21253;&#20869;&#23481;&#12290;&#36825;&#32972;&#21518;&#30340;&#8220;&#39764;&#27861;&#8221;&#27491;&#26159;<strong>&#21033;&#29992;&#20102; Shell &#33050;&#26412;&#26159;&#20174;&#21069;&#24448;&#21518;&#35299;&#26512;&#65292;&#32780; Jar &#25991;&#20214;&#21017;&#26159;&#20174;&#21518;&#24448;&#21069;&#35299;&#26512;&#30340;&#29305;&#24615;</strong>&#12290;</p>
<p>&#29616;&#22312;&#35201;&#36816;&#34892;&#36825;&#20010;&#25991;&#20214;&#21482;&#38656;&#31616;&#21333;&#30340; <code>./target/binarytea-0.0.1-SNAPSHOT.jar</code> &#23601;&#21487;&#20197;&#20102;&#12290;&#23545;&#24212;&#30340;&#19968;&#20123;&#31867;&#20284; JVM &#21442;&#25968;&#21644;&#36816;&#34892;&#30340;&#21442;&#25968;&#65292;&#21487;&#20197;&#25918;&#22312;&#21516;&#21517;&#30340; <code>.conf</code> &#37197;&#32622;&#25991;&#20214;&#20013;&#65292;&#19968;&#20123;&#22522;&#26412;&#30340;&#25191;&#34892;&#37197;&#32622;&#39033;&#35265;&#34920; 5-12&#12290;</p>
<p><strong>&#34920; 5-12&#12288;&#19968;&#20123;&#22522;&#26412;&#30340;&#25191;&#34892;&#37197;&#32622;&#39033;</strong></p>
<table border="1" class="table table-bordered table-striped table-condensed" width="90%"><tr><th>&#37197;&#32622;&#39033;</th><th>&#35828;&#26126;</th></tr><tr><td>`CONF_FOLDER`</td><td>`.conf` &#25991;&#20214;&#30340;&#30446;&#24405;&#20301;&#32622;&#65292;&#22240;&#20026;&#35201;&#38752;&#23427;&#21152;&#36733;&#37197;&#32622;&#25991;&#20214;&#65292;&#25152;&#20197;&#36825;&#20010;&#21442;&#25968;&#24517;&#39035;&#25918;&#22312;&#29615;&#22659;&#21464;&#37327;&#37324;</td></tr><tr><td>`JAVA_OPTS`</td><td>&#21551;&#21160; Java &#31243;&#24207;&#20351;&#29992;&#30340; JVM &#21442;&#25968;&#65292;&#27604;&#22914; JVM &#20869;&#23384;&#21644; GC &#30456;&#20851;&#30340;&#21442;&#25968;</td></tr><tr><td>`RUN_ARGS`</td><td>&#36816;&#34892;&#31243;&#24207;&#25152;&#38656;&#25552;&#20379;&#30340;&#36816;&#34892;&#26102;&#21442;&#25968;</td></tr></table>
<p>&#36825;&#26679;&#19968;&#26469;&#23601;&#21487;&#20197;&#25226;&#36825;&#20010; Jar &#25991;&#20214;&#25918;&#22312; init.d &#25110; systemd &#37324;&#36816;&#34892;&#20102;&#65292;&#20294;&#19981;&#24471;&#19981;&#35828;&#65292;&#30456;&#27604; <code>java -jar</code>&#65292;&#36825;&#31181;&#29992;&#27861;&#36824;&#26159;&#24456;&#23569;&#35265;&#30340;&#12290;&#27492;&#22806;&#65292;&#26356;&#26032;&#30340;&#25216;&#26415;&#20986;&#29616;&#20102;&#65292;&#19981;&#20165;&#33021;&#20195;&#26367;&#36825;&#31181;&#26041;&#24335;&#65292;&#32780;&#19988;&#36824;&#24102;&#26469;&#20102;&#26356;&#22909;&#30340;&#20307;&#39564;&#65292;&#36825;&#23601;&#26159; GraalVM<span class="&#27880;&#37322;&#32534;&#21495;">18</span>&#12290;GraalVM &#33021;&#25226; Java &#31243;&#24207;&#32534;&#35793;&#20026; Linux &#20108;&#36827;&#21046;&#65292;&#31995;&#32479;&#21551;&#21160;&#36895;&#24230;&#26356;&#24555;&#65292;&#25152;&#21344;&#20869;&#23384;&#26356;&#23567;&#12290;</p>
</li>
</ol><p class="&#27880;&#37322;&#20869;&#23481;"><span class="&#27880;&#37322;&#32534;&#21495;&#19979;">16</span><code>mvn</code> &#21629;&#20196;&#21518;&#30340; <code>clean</code> &#20195;&#34920;&#28165;&#29702;&#30446;&#26631;&#30446;&#24405;&#65292;<code>package</code> &#26159;&#25191;&#34892;&#25171;&#21253;&#21160;&#20316;&#65292;<code>-Dmaven.test.skip</code> &#26159;&#20026;&#20102;&#21152;&#36895;&#25171;&#21253;&#36807;&#31243;&#65292;&#36339;&#36807;&#27979;&#35797;&#12290;</p><p class="&#27880;&#37322;&#20869;&#23481;"><span class="&#27880;&#37322;&#32534;&#21495;&#19979;">17</span>&#20851;&#20110; <code>PropertiesLauncher</code> &#30340;&#29992;&#27861;&#21487;&#20197;&#21442;&#32771; Spring Boot &#23448;&#26041;&#25991;&#26723;&#8220;PropertiesLauncher Features&#8221;&#37096;&#20998;&#30340;&#20869;&#23481;&#65292;&#26412;&#20070;&#19981;&#20570;&#35814;&#32454;&#23637;&#24320;&#20102;&#12290;</p><p class="&#27880;&#37322;&#20869;&#23481;"><span class="&#27880;&#37322;&#32534;&#21495;&#19979;">18</span>Oracle &#25512;&#20986;&#30340;&#19968;&#27454;&#39640;&#24615;&#33021;&#36890;&#29992;&#34394;&#25311;&#26426;&#65292;&#21487;&#20197;&#36816;&#34892;&#22810;&#31181;&#35821;&#35328;&#65292;&#23427;&#28040;&#38500;&#20102;&#35821;&#35328;&#38388;&#30340;&#38548;&#38402;&#65292;&#36890;&#36807;&#20849;&#20139;&#36816;&#34892;&#26102;&#22686;&#24378;&#20102;&#20114;&#25805;&#20316;&#24615;&#12290;&#23448;&#26041;&#23459;&#31216;&#65292;&#30456;&#27604;&#20256;&#32479; JVM&#65292;GraalVM &#30340;&#21551;&#21160;&#26102;&#38388;&#26356;&#30701;&#65292;&#21344;&#29992;&#20869;&#23384;&#26356;&#23569;&#65292;&#26159;&#24494;&#26381;&#21153;&#30340;&#29702;&#24819;&#36873;&#25321;&#12290;</p><h3 id="nav_point_86">5.3.2&#12288;&#26500;&#24314;&#21551;&#21160;&#20195;&#30721;</h3><p>&#22312;&#20043;&#21069;&#30340;&#20363;&#23376;&#20013;&#25105;&#20204;&#24050;&#32463;&#22810;&#27425;&#30475;&#21040;&#36807;&#24102;&#26377; <code>@SpringBootApplication</code> &#27880;&#35299;&#30340;&#20027;&#31867;&#65292;&#20854;&#20013;&#29992; <code>SpringApplication.run()</code> &#26041;&#27861;&#26469;&#36816;&#34892;&#25105;&#20204;&#30340;&#20195;&#30721;&#12290;Spring Boot &#20026;&#25105;&#20204;&#39044;&#30041;&#20102;&#24456;&#22810;&#33258;&#23450;&#20041;&#24037;&#31243;&#21551;&#21160;&#30340;&#25193;&#23637;&#28857;&#65292;&#27604;&#22914;&#21487;&#20197;&#35774;&#32622;&#21551;&#21160;&#30340;&#21508;&#31181;&#21442;&#25968;&#65292;&#33021;&#38024;&#23545;&#22833;&#36133;&#36827;&#34892;&#21508;&#31181;&#22788;&#29702;&#12289;&#36824;&#33021;&#23450;&#21046;&#33258;&#24049;&#30340; Banner &#26639;&#31561;&#12290;</p><ol>
<li><p><strong>&#33258;&#23450;&#20041; SpringApplication</strong></p>
<p>&#36890;&#36807; Spring Initializr &#29983;&#25104;&#30340;&#24037;&#31243;&#65292;&#20854;&#20013;&#30340; <code>main()</code> &#26041;&#27861;&#24212;&#35813;&#26159;&#19979;&#38754;&#36825;&#26679;&#30340;&#65292;&#23427;&#21487;&#20197;&#28385;&#36275;&#32477;&#22823;&#37096;&#20998;&#30340;&#38656;&#27714;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>public static void main(String[] args) {
    SpringApplication.run(BinaryTeaApplication.class, args);
}</code></pre>
<p>&#25105;&#20204;&#20063;&#23436;&#20840;&#21487;&#20197;&#33258;&#24049;&#26032;&#24314;&#19968;&#20010; <code>SpringApplication</code> &#23545;&#35937;&#65292;&#35774;&#32622;&#21508;&#31181;&#23646;&#24615;&#65292;&#20363;&#22914; <code>bannerMode</code> &#21644; <code>lazyInitialization</code> &#31561;&#65292;&#38543;&#21518;&#20877;&#35843;&#29992;&#23427;&#30340; <code>run()</code> &#26041;&#27861;&#12290;</p>
<p>&#24403;&#28982;&#65292;&#36825;&#26679;&#30340;&#25805;&#20316;&#30053;&#26174;&#32321;&#29712;&#65292;Spring Boot &#36148;&#24515;&#22320;&#25552;&#20379;&#20102;&#19968;&#20010; <code>SpringApplicationBuilder</code> &#26500;&#36896;&#22120;&#65292;&#36890;&#36807;&#23427;&#25105;&#20204;&#21487;&#20197;&#27969;&#30021;&#22320;&#32534;&#20889;&#31867;&#20284;&#20195;&#30721;&#31034;&#20363; 5-10 &#36825;&#26679;&#30340;&#20195;&#30721;&#12290;<span class="&#27880;&#37322;&#32534;&#21495;">19</span></p>
<blockquote>
<p><strong>&#20195;&#30721;&#31034;&#20363; 5-10</strong>&#12288;&#36890;&#36807; <code>SpringApplicationBuilder</code> &#21551;&#21160;&#24212;&#29992;&#31243;&#24207;</p>
</blockquote>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>public static void main(String[] args) {
    new SpringApplicationBuilder()
        .sources(BinaryTeaApplication.class)
        .main(BinaryTeaApplication.class)
        .bannerMode(Banner.Mode.OFF)
        .web(WebApplicationType.SERVLET)
        .run(args);
}</code></pre>
<p>&#19978;&#38754;&#30340;&#19968;&#20123;&#35774;&#32622;&#20195;&#30721;&#65292;&#20063;&#21487;&#20197;&#25913;&#29992;&#37197;&#32622;&#25991;&#20214;&#30340;&#26041;&#24335;&#65292;&#22312; <code>application.properties</code> &#25110; <code>application.yml</code> &#37324;&#36827;&#34892;&#35774;&#32622;&#65292;&#20363;&#22914;&#22312; <code>application.properties</code> &#37324;&#21487;&#20197;&#20687;&#19979;&#38754;&#36825;&#26679;&#26469;&#20851;&#38381; Web &#23481;&#22120;&#21644; Banner &#26639;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>spring.main.web-application-type=none
spring.main.banner-mode=off</code></pre>
<p>&#160;</p>
</li>
<li><p><strong>&#36890;&#36807; FailureAnalyzer &#25552;&#20379;&#22833;&#36133;&#21407;&#22240;&#20998;&#26512;</strong></p>
<p>&#31243;&#24207;&#21551;&#21160;&#26102;&#65292;&#22914;&#26524;&#36935;&#21040;&#24322;&#24120;&#23601;&#20250;&#36864;&#20986;&#65292;&#36825;&#26102;&#38656;&#35201;&#26597;&#30475;&#26085;&#24535;&#65292;&#20998;&#26512;&#21407;&#22240;&#65292;&#37027;&#26377;&#27809;&#26377;&#21487;&#33021;&#35753;&#31995;&#32479;&#33258;&#24049;&#20998;&#26512;&#21407;&#22240;&#65292;&#28982;&#21518;&#21578;&#35785;&#25105;&#20204;&#20026;&#20160;&#20040;&#22833;&#36133;&#20102;&#21602;&#65311;&#31572;&#26696;&#26159;&#32943;&#23450;&#30340;&#65292;&#22240;&#20026; Spring Boot &#21487;&#20197;&#36890;&#36807; <code>FailureAnalyzer</code> &#26469;&#20998;&#26512;&#22833;&#36133;&#65292;&#24182;&#25171;&#21360;&#20998;&#26512;&#20986;&#30340;&#21407;&#22240;&#12290;&#34920; 5-13 &#32599;&#21015;&#20102;&#19968;&#20123;&#20869;&#32622;&#30340; <code>FailureAnalyzer</code> &#23454;&#29616;&#31867;&#65292;Spring Boot &#20869;&#32622;&#20102;&#36817; 20 &#31181;&#19981;&#21516;&#30340;&#20998;&#26512;&#22120;&#65292;&#34920; 5-13 &#37324;&#23637;&#31034;&#30340;&#21482;&#26159;&#20854;&#20013;&#30340;&#19968;&#23567;&#37096;&#20998;&#12290;</p>
<p><strong>&#34920; 5-13&#12288;Spring Boot &#30340;&#37096;&#20998;&#20869;&#32622; <code>FailureAnalyzer</code> &#23454;&#29616;&#31867;</strong></p>
<table border="1" class="table table-bordered table-striped table-condensed" width="90%"><tr><th>`FailureAnalyzer` &#23454;&#29616;&#31867;</th><th>&#21151;&#33021;</th></tr><tr><td>`BindFailureAnalyzer`</td><td>&#25552;&#31034;&#23646;&#24615;&#32465;&#23450;&#30456;&#20851;&#24322;&#24120;</td></tr><tr><td>`DataSourceBeanCreationFailureAnalyzer`</td><td>&#25552;&#31034;&#25968;&#25454;&#28304;&#21019;&#24314;&#30456;&#20851;&#24322;&#24120;</td></tr><tr><td>`InvalidConfigurationPropertyNameFailureAnalyzer`</td><td>&#25552;&#31034;&#37197;&#32622;&#23646;&#24615;&#21517;&#19981;&#27491;&#30830;</td></tr><tr><td>`NoSuchBeanDefinitionFailureAnalyzer`</td><td>&#25552;&#31034; Spring &#19978;&#19979;&#25991;&#20013;&#25214;&#19981;&#21040;&#38656;&#35201;&#30340; Bean &#23450;&#20041;</td></tr><tr><td>`NoUniqueBeanDefinitionFailureAnalyzer`</td><td>&#25552;&#31034;&#35201;&#27880;&#20837;&#19968;&#20010; Bean&#65292;&#20294;&#23454;&#38469;&#21364;&#25214;&#21040;&#20102;&#19981;&#27490;&#19968;&#20010;</td></tr></table>
<p>&#25105;&#20204;&#20063;&#21487;&#20197;&#26681;&#25454;&#23454;&#38469;&#24773;&#20917;&#65292;&#25552;&#20379;&#33258;&#24049;&#30340; <code>FailureAnalyzer</code> &#23454;&#29616;&#31867;&#12290;&#26041;&#20415;&#36215;&#35265;&#65292;Spring Boot &#25552;&#20379;&#20102;&#19968;&#20010; <code>AbstractFailureAnalyzer&lt;T extends Throwable&gt;</code> &#25277;&#35937;&#31867;&#65292;&#20854;&#20013;&#30340;&#27867;&#22411; <code>T</code> &#23601;&#26159;&#35201;&#20998;&#26512;&#30340;&#24322;&#24120;&#65292;&#23454;&#29616;&#36825;&#20010;&#25277;&#35937;&#31867;&#20250;&#26356;&#31616;&#21333;&#65292;&#26694;&#26550;&#20869;&#32622;&#30340;&#22823;&#37096;&#20998;&#23454;&#29616;&#37117;&#26159;&#22522;&#20110;&#36825;&#20010;&#25277;&#35937;&#31867;&#26469;&#24320;&#21457;&#30340;&#12290;&#25105;&#20204;&#20197; Spring Boot &#30340; <code>PortInUseFailureAnalyzer</code> &#20026;&#20363;&#65292;&#30475;&#21040;&#20256;&#20837;&#24453;&#20998;&#26512;&#30340;&#24322;&#24120;&#26159; <code>PortInUseException</code> &#23601;&#33021;&#30693;&#36947;&#31471;&#21475;&#24050;&#32463;&#34987;&#21344;&#29992;&#20102;&#65292;&#20174;&#32780;&#30452;&#35266;&#22320;&#25552;&#31034; Web &#26381;&#21153;&#22120;&#31471;&#21475;&#24050;&#34987;&#21344;&#29992;&#65306;</p>
<pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>class PortInUseFailureAnalyzer extends AbstractFailureAnalyzer&lt;PortInUseException&gt; {
    @Override
    protected FailureAnalysis analyze(Throwable rootFailure, PortInUseException cause) {
        return new FailureAnalysis("Web server failed to start. Port " + cause.getPort() + " was already in use.",
               "Identify and stop the process that's listening on port " + cause.getPort() + " or configure this "
               + "application to listen on another port.", cause);
    }
}</code></pre>
<p>&#160;</p>
</li>
<li><p><strong>&#33258;&#23450;&#20041; Banner &#26639;</strong></p>
<p>&#21551;&#21160;&#31243;&#24207;&#26102;&#65292;&#40664;&#35748;&#20250;&#25171;&#20986; Spring &#30340;&#23383;&#26679;&#65292;&#36825;&#26159;&#30001; ASCII &#23383;&#31526;&#32452;&#25104;&#30340;&#22270;&#26696;&#65292;&#30475;&#36215;&#26469;&#38750;&#24120;&#30340;&#37239;&#28843;&#12290;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807; <code>spring.main.banner-mode</code> &#23646;&#24615;&#26469;&#25511;&#21046; Banner &#30340;&#36755;&#20986;&#26041;&#24335;&#65306;</p>
<ul>
<li class="&#31532;2&#32423;&#26080;&#24207;&#21015;&#34920;"><strong><code>Banner.Mode.OFF</code></strong>&#65288;&#23646;&#24615;&#20540;&#20026; <code>off</code>&#65289;&#65292;&#20851;&#38381;&#36755;&#20986;&#65307;</li>
<li class="&#31532;2&#32423;&#26080;&#24207;&#21015;&#34920;"><strong><code>Banner.Mode.CONSOLE</code></strong>&#65288;&#23646;&#24615;&#20540;&#20026; <code>console</code>&#65289;&#65292;&#36755;&#20986;&#21040;&#25511;&#21046;&#21488;&#65292;&#21363;&#26631;&#20934;&#36755;&#20986; STDOUT&#65307;</li>
<li class="&#31532;2&#32423;&#26080;&#24207;&#21015;&#34920;"><strong><code>Banner.Mode.LOG</code></strong>&#65288;&#23646;&#24615;&#20540;&#20026; <code>log</code>&#65289;&#65292;&#36755;&#20986;&#21040;&#26085;&#24535;&#12290;</li>
</ul>
<p>&#22914;&#26524;&#35201;&#33258;&#23450;&#20041;&#36755;&#20986;&#30340;&#20869;&#23481;&#65292;&#21487;&#20197;&#22312; CLASSPATH &#20013;&#25918;&#32622;&#19968;&#20010; banner.txt<span class="&#27880;&#37322;&#32534;&#21495;">20</span>&#65292;&#20063;&#21487;&#20197;&#36890;&#36807; <code>spring.banner.location</code> &#25351;&#23450;&#25991;&#20214;&#20301;&#32622;&#65292;&#25991;&#20214;&#20013;&#38500;&#20102; ASCII &#22270;&#26696;&#65292;&#36824;&#21487;&#20197;&#20889;&#19968;&#20123;&#21344;&#20301;&#31526;&#65292;&#20363;&#22914;&#65292;&#21487;&#20197;&#20174; MANIFEST.MF &#25991;&#20214;&#20013;&#33719;&#21462;&#19968;&#20123;&#20449;&#24687;&#65306;</p>
<ul>
<li class="&#31532;2&#32423;&#26080;&#24207;&#21015;&#34920;"><strong><code>${application.title}</code></strong>&#65292;&#23545;&#24212; <code>Implementation-Title</code>&#65307;</li>
<li class="&#31532;2&#32423;&#26080;&#24207;&#21015;&#34920;"><strong><code>${application.version}</code></strong>&#65292;&#23545;&#24212; <code>Implementation-Version</code>&#65307;</li>
<li class="&#31532;2&#32423;&#26080;&#24207;&#21015;&#34920;"><strong><code>${application.formatted-version}</code></strong>&#65292;&#21516;&#26679;&#23545;&#24212; <code>Implementation-Version</code>&#65292;&#20294;&#20250;&#28155;&#21152; <code>v</code> &#21069;&#32512;&#65292;&#20877;&#23558;&#29256;&#26412;&#25918;&#22312;&#25324;&#21495;&#20869;&#12290;</li>
</ul>
<p>&#24403;&#28982;&#65292;&#22914;&#26524;&#36824;&#24076;&#26395;&#20570;&#24471;&#26356;&#24443;&#24213;&#65292;&#25105;&#20204;&#21487;&#20197;&#30452;&#25509;&#20889;&#19968;&#20010;&#33258;&#24049;&#30340; <code>org.springframework.boot.Banner</code> &#25509;&#21475;&#23454;&#29616;&#65292;&#22312;&#20854;&#20013;&#30340; <code>printBanner()</code> &#26041;&#27861;&#37324;&#25171;&#21360; Banner&#12290;</p>
<blockquote>
<p><strong>&#33590;&#27463;&#26102;&#38388;&#65306;&#22914;&#20309;&#20248;&#38597;&#22320;&#20851;&#38381;&#31995;&#32479;</strong></p>
<p>&#31995;&#32479;&#26377;&#21551;&#21160;&#65292;&#33258;&#28982;&#23601;&#20250;&#26377;&#20851;&#38381;&#30340;&#26102;&#20505;&#12290;&#22914;&#26524;&#35828;&#24322;&#24120;&#23445;&#26426;&#26102;&#25439;&#22833;&#19968;&#20010;&#23454;&#20363;&#23545;&#25972;&#20010;&#38598;&#32676;&#30340;&#26381;&#21153;&#36896;&#25104;&#37096;&#20998;&#24433;&#21709;&#36824;&#24773;&#26377;&#21487;&#21407;&#65292;&#37027;&#24120;&#35268;&#30340;&#31995;&#32479;&#21319;&#32423;&#21457;&#24067;&#23601;&#19981;&#24212;&#35813;&#23545;&#25972;&#20307;&#26381;&#21153;&#26377;&#20219;&#20309;&#24433;&#21709;&#12290;</p>
<p>&#22312;&#25105;&#20204;&#25171;&#31639;&#20851;&#38381;&#31995;&#32479;&#26102;&#65292;&#21487;&#33021;&#20250;&#36935;&#21040;&#22914;&#19979;&#30340;&#24773;&#20917;&#65288;&#19981;&#20165;&#38480;&#20110;&#27492;&#65289;&#65306;</p>
<ul>
<li class="&#31532;3&#32423;&#26080;&#24207;&#21015;&#34920;"><strong>&#31995;&#32479;&#20173;&#22312;&#25509;&#25910;&#21516;&#27493;&#35831;&#27714;</strong>&#65292;&#20363;&#22914;&#65292;&#22312;&#22788;&#29702; HTTP &#35831;&#27714;&#65307;</li>
<li class="&#31532;3&#32423;&#26080;&#24207;&#21015;&#34920;"><strong>&#31995;&#32479;&#20173;&#22312;&#28040;&#36153;&#28040;&#24687;</strong>&#65292;&#20363;&#22914;&#65292;&#22312;&#28040;&#36153; Kafka &#28040;&#24687;&#65307;</li>
<li class="&#31532;3&#32423;&#26080;&#24207;&#21015;&#34920;"><strong>&#31995;&#32479;&#26377;&#23450;&#26102;&#20219;&#21153;&#22312;&#36816;&#34892;</strong>&#65292;&#21487;&#33021;&#26159;&#20998;&#24067;&#24335;&#35843;&#24230;&#65292;&#20063;&#21487;&#33021;&#26159;&#21333;&#26426;&#30340;&#35843;&#24230;&#20219;&#21153;&#12290;</li>
</ul>
<p>&#24403;&#31995;&#32479;&#22788;&#20110;&#22788;&#29702;&#20013;&#30340;&#29366;&#24577;&#26102;&#65292;&#30452;&#25509;&#20851;&#38381;&#31995;&#32479;&#21487;&#33021;&#20250;&#24433;&#21709;&#24403;&#21069;&#30340;&#22788;&#29702;&#12290;</p>
<p>&#20026;&#27492;&#65292;&#25105;&#20204;&#35201;&#38024;&#23545;&#24615;&#22320;&#20570;&#19968;&#20123;&#22788;&#29702;&#65292;&#20363;&#22914;&#65292;&#23558;&#24403;&#21069;&#33410;&#28857;&#20174;&#36127;&#36733;&#22343;&#34913;&#20013;&#21076;&#38500;&#65292;&#22914;&#26524;&#20351;&#29992; Nginx &#36827;&#34892;&#36127;&#36733;&#22343;&#34913;&#65292;&#23601;&#35843;&#25972; <code>upstream</code> &#30340;&#37197;&#32622;&#65307;&#22914;&#26524;&#26159;&#21160;&#24577;&#21457;&#29616;&#30340;&#65292;&#23601;&#35753;&#20581;&#24247;&#26816;&#26597;&#22833;&#36133;&#65288;&#21487;&#20197;&#20351;&#29992; 5.1 &#33410;&#20013;&#25552;&#21040;&#30340; <code>health</code> &#31471;&#28857;&#65289;&#65292;&#35753;&#26381;&#21153;&#27880;&#20876;&#20013;&#24515;&#23558;&#33410;&#28857;&#19979;&#32447;&#12290;&#65288;&#22312;&#31532; 13 &#31456;&#20013;&#25105;&#20204;&#36824;&#20250;&#32842;&#21040;&#26381;&#21153;&#30340;&#27880;&#20876;&#20013;&#24515;&#12290;&#65289;</p>
<p>&#28040;&#24687;&#30340;&#28040;&#36153;&#35201;&#21147;&#20105;&#20570;&#21040;&#21487;&#37325;&#22797;&#28040;&#36153;&#65292;&#22240;&#20026;&#28040;&#36153;&#26412;&#36523;&#23601;&#35201;&#32771;&#34385;&#21040;&#28040;&#24687;&#30340;&#20081;&#24207;&#21644;&#37325;&#21457;&#31561;&#24773;&#20917;&#12290;&#22914;&#26524;&#19968;&#26465;&#28040;&#24687;&#28040;&#36153;&#21040;&#19968;&#21322;&#65292;&#36827;&#31243;&#34987;&#26432;&#25481;&#20102;&#65292;&#37027;&#20040;&#28040;&#24687;&#20013;&#38388;&#20214;&#20250;&#35748;&#20026;&#35813;&#28040;&#24687;&#26410;&#34987;&#27491;&#24120;&#22788;&#29702;&#65292;&#20250;&#20877;&#37325;&#26032;&#21457;&#36865;&#12290;&#24403;&#28982;&#65292;&#25105;&#20204;&#20063;&#21487;&#20197;&#20570;&#20123;&#20248;&#21270;&#65292;&#22312;&#20572;&#27490;&#36827;&#31243;&#21069;&#65292;&#19981;&#20877;&#25509;&#25910;&#26032;&#28040;&#24687;&#65292;&#38024;&#23545;&#25289;&#65288;PULL&#65289;&#27169;&#24335;&#30340;&#23458;&#25143;&#31471;&#65292;&#19981;&#20877;&#20174;&#26381;&#21153;&#31471;&#25289;&#21462;&#26032;&#28040;&#24687;&#65292;&#25512;&#65288;PUSH&#65289;&#27169;&#24335;&#30340;&#21017;&#19981;&#20877;&#22788;&#29702;&#26032;&#28040;&#24687;&#65292;&#31561;&#24453;&#25110;&#25298;&#32477;&#20063;&#19981;&#22833;&#20026;&#19968;&#20010;&#22909;&#21150;&#27861;&#12290;</p>
<p>&#23545;&#35843;&#24230;&#20219;&#21153;&#20063;&#26159;&#19968;&#26679;&#30340;&#65292;&#20219;&#21153;&#38656;&#35201;&#33021;&#22815;&#25903;&#25345;&#8220;&#37325;&#36305;&#8221;&#65292;&#39640;&#39057;&#20219;&#21153;&#19981;&#24517;&#22810;&#35828;&#65292;&#20302;&#39057;&#20219;&#21153;&#19975;&#19968;&#34987;&#20013;&#26029;&#65292;&#38656;&#35201;&#26377;&#34917;&#20607;&#26426;&#21046;&#65292;&#33021;&#22815;&#24555;&#36895;&#24674;&#22797;&#12290;&#20363;&#22914;&#65292;&#20998;&#24067;&#24335;&#35843;&#24230;&#65288;&#35832;&#22914; ElasticJob &#20043;&#31867;&#30340;&#35843;&#24230;&#65289;&#21487;&#20197;&#35774;&#32622;&#25925;&#38556;&#36716;&#31227;&#12290;</p>
<p>Spring Boot &#25552;&#20379;&#20102;&#20248;&#38597;&#20851;&#38381;&#30340;&#33021;&#21147;&#65292;&#36890;&#36807; <code>server.shutdown=graceful</code> &#36825;&#20010;&#37197;&#32622;&#21487;&#20197;&#24320;&#21551; Web &#26381;&#21153;&#22120;&#20248;&#38597;&#20851;&#38381;&#30340;&#25903;&#25345;&#65292;&#35753;&#31995;&#32479;&#22312;&#25910;&#21040;&#20851;&#38381;&#20449;&#21495;&#26102;&#31561;&#24453;&#19968;&#27573;&#26102;&#38388;&#65288;&#36890;&#36807; <code>spring.lifecycle.timeout-per-shutdown-phase</code> &#35774;&#32622;&#65289;&#65292;&#20197;&#20415;&#31561;&#24453;&#24403;&#21069;&#27491;&#22312;&#22788;&#29702;&#30340;&#35831;&#27714;&#22788;&#29702;&#32467;&#26463;&#12290;&#20294;&#36890;&#36807;&#21069;&#38754;&#30340;&#25551;&#36848;&#65292;&#25105;&#20204;&#19981;&#38590;&#21457;&#29616;&#65292;&#20165;&#25552;&#20379;&#36825;&#20123;&#33021;&#21147;&#24182;&#19981;&#36275;&#20197;&#22312;&#29983;&#20135;&#29615;&#22659;&#20013;&#20570;&#21040;&#26080;&#25439;&#30340;&#33410;&#28857;&#19979;&#32447;&#65292;&#36824;&#26377;&#22823;&#37327;&#30340;&#24037;&#20316;&#38656;&#35201;&#25105;&#20204;&#33258;&#24049;&#26469;&#23454;&#29616;&#12290;</p>
</blockquote>
</li>
</ol><p class="&#27880;&#37322;&#20869;&#23481;"><span class="&#27880;&#37322;&#32534;&#21495;&#19979;">19</span>&#36825;&#20010;&#20363;&#23376;&#22312; ch5/binarytea-start &#39033;&#30446;&#37324;&#12290;</p><p class="&#27880;&#37322;&#20869;&#23481;"><span class="&#27880;&#37322;&#32534;&#21495;&#19979;">20</span>&#20174; Spring Boot 3.0.0-M2 &#24320;&#22987;&#65292;Banner &#19981;&#20877;&#25903;&#25345;&#22270;&#29255;&#31867;&#22411;&#65292;&#31995;&#32479;&#20250;&#24573;&#30053; banner.gif&#12289;banner.jpg &#21644; banner.png &#25991;&#20214;&#12290;&#35201;&#23450;&#21046;&#28418;&#20142;&#30340; Banner&#65292;&#36824;&#26159;&#29992; banner.txt &#25991;&#26412;&#26041;&#24335;&#21543;&#12290;</p><h3 id="nav_point_87">5.3.3&#12288;&#21551;&#21160;&#21518;&#30340;&#19968;&#27425;&#24615;&#25191;&#34892;&#36923;&#36753;</h3><p>&#22312;&#31995;&#32479;&#21551;&#21160;&#26102;&#65292;&#21487;&#33021;&#20250;&#26377;&#20123;&#21021;&#22987;&#21270;&#21518;&#38656;&#35201;&#31435;&#21363;&#25191;&#34892;&#30340;&#36923;&#36753;&#65292;&#20063;&#26377;&#21487;&#33021;&#36825;&#23601;&#26159;&#19968;&#20010;&#21629;&#20196;&#34892;&#31243;&#24207; <span class="&#27880;&#37322;&#32534;&#21495;">21</span>&#65292;&#25191;&#34892;&#23436;&#29305;&#23450;&#36923;&#36753;&#21518;&#31243;&#24207;&#23601;&#35813;&#36864;&#20986;&#20102;&#12290;&#36825;&#26102;&#25105;&#20204;&#35813;&#24590;&#20040;&#21150;&#65311;&#20889;&#19968;&#20010; Bean&#65292;&#22312;&#23427;&#30340; <code>@PostConstruct</code> &#26041;&#27861;&#20013;&#25191;&#34892;&#36923;&#36753;&#20040;&#65311;&#20854;&#23454;&#65292;&#22312; Spring Boot &#20013;&#26377;&#26356;&#22909;&#30340;&#36873;&#25321;&#12290;</p><p class="&#27880;&#37322;&#20869;&#23481;"><span class="&#27880;&#37322;&#32534;&#21495;&#19979;">21</span>&#22914;&#26524;&#26159;&#32431;&#21629;&#20196;&#34892;&#30340;&#31243;&#24207;&#65292;&#19981;&#24341;&#20837; Web &#30456;&#20851;&#20381;&#36182;&#21363;&#21487;&#65307;&#22914;&#26524; CLASSPATH &#37324;&#23384;&#22312; Web &#30340;&#20381;&#36182;&#65292;&#20063;&#21487;&#20197;&#37197;&#32622; <code>spring.main.web-application-type=none</code>&#65292;&#25110;&#32773;&#35774;&#32622; <code>SpringApplication</code> &#30340; <code>webApplicationType</code> &#20026; <code>NONE</code>&#12290;</p><p>Spring Boot &#20026;&#25105;&#20204;&#25552;&#20379;&#20102;&#20004;&#20010;&#25509;&#21475;&#65292;&#20998;&#21035;&#26159; <code>ApplicationRunner</code> &#19982; <code>CommandLineRunner</code>&#65292;&#23427;&#20204;&#30340;&#21151;&#33021;&#22522;&#26412;&#26159;&#30456;&#21516;&#30340;&#65292;&#21482;&#26159;&#26041;&#27861;&#30340;&#21442;&#25968;&#19981;&#21516;&#65292;&#20855;&#20307;&#22914;&#19979;&#25152;&#31034;&#65306;</p><pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>public interface ApplicationRunner {
    void run(ApplicationArguments args) throws Exception;
}

public interface CommandLineRunner {
    void run(String... args) throws Exception;
}</code></pre><p><code>CommandLineRunner</code> &#30340; <code>run(String... args)</code> &#20256;&#20837;&#30340;&#21442;&#25968;&#19982; <code>main(String... args)</code> &#26041;&#27861;&#19968;&#26679;&#65292;&#23601;&#26159;&#21629;&#20196;&#34892;&#30340;&#25152;&#26377;&#21442;&#25968;&#12290;&#32780;&#36890;&#36807; <code>ApplicationArguments</code>&#65292;&#25105;&#20204;&#21487;&#20197;&#26356;&#26041;&#20415;&#28789;&#27963;&#22320;&#25511;&#21046;&#21629;&#20196;&#34892;&#20013;&#30340;&#21442;&#25968;&#12290;&#22914;&#26524; Spring &#19978;&#19979;&#25991;&#20013;&#23384;&#22312;&#22810;&#20010; <code>ApplicationRunner</code> &#25110; <code>CommandLineRunner</code> Bean&#65292;&#21487;&#20197;&#36890;&#36807; <code>@Order</code> &#27880;&#35299;&#25110; <code>Ordered</code> &#25509;&#21475;&#26469;&#25351;&#23450;&#36816;&#34892;&#30340;&#39034;&#24207;&#12290;&#25509;&#19979;&#26469;&#65292;&#35753;&#25105;&#20204;&#30475;&#20010;&#20363;&#23376;&#12290;</p><blockquote>
<p><strong>&#38656;&#27714;&#25551;&#36848;</strong>&#12288;&#26377;&#22902;&#33590;&#24215;&#65292;&#33258;&#28982;&#23601;&#20250;&#26377;&#39038;&#23458;&#65292;&#27599;&#27425;&#37117;&#35753;&#39038;&#23458;&#36305;&#21040;&#38376;&#24215;&#25214;&#26381;&#21153;&#21592;&#28857;&#21333;&#22810;&#23569;&#26377;&#20123;&#19981;&#26041;&#20415;&#65292;&#25105;&#20204;&#38656;&#35201;&#19968;&#20010;&#31243;&#24207;&#35753;&#39038;&#23458;&#21487;&#20197;&#33258;&#24049;&#19979;&#21333;&#12290;&#25152;&#20197;&#65292;&#20026;&#39038;&#23458;&#24320;&#21457;&#19968;&#20010;&#31243;&#24207;&#21543;&#12290;</p>
</blockquote><p>&#20026;&#20102;&#26041;&#20415;&#28436;&#31034;&#65292;&#24314;&#31435;&#19968;&#20010;&#26032;&#30340; Customer &#24037;&#31243;&#65292;&#20195;&#34920;&#20108;&#36827;&#21046;&#22902;&#33590;&#24215;&#30340;&#39038;&#23458;&#65292;&#25918;&#22312; ch5/customer &#39033;&#30446;&#20013;&#65292;&#20854;&#35814;&#32454;&#20449;&#24687;&#22914;&#34920; 5-14 &#25152;&#31034;&#12290;</p><p><strong>&#34920; 5-14&#12288;Customer &#24037;&#31243;&#30340;&#35814;&#32454;&#20449;&#24687;</strong></p><table border="1" width="90%">
<thead>
<tr>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#26465;&#30446;</p></th>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#20869;&#23481;</p></th>
</tr>
</thead>
<tbody>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#39033;&#30446;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">Maven Project</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#35821;&#35328;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">Java</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">Spring Boot &#29256;&#26412;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">2.6.3</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">Group</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>learning.spring</code></p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">Artifact</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>customer</code></p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#21517;&#31216;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">Customer</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">Java &#21253;&#21517;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>learning.spring.customer</code></p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#25171;&#21253;&#26041;&#24335;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">Jar</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">Java &#29256;&#26412;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">11</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#20381;&#36182;</p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">Lombok</p></td>
</tr>
</tbody>
</table><p>&#36825;&#20010;&#39033;&#30446;&#20250;&#27169;&#25311;&#39038;&#23458;&#30340;&#25805;&#20316;&#65292;&#30446;&#21069;&#25105;&#20204;&#30340;&#22902;&#33590;&#24215;&#36824;&#27809;&#24320;&#38376;&#33829;&#19994;&#65292;&#21487;&#20197;&#35753;&#39038;&#23458;&#36873;&#25321;&#31561;&#24453;&#22902;&#33590;&#24215;&#24320;&#38376;&#65292;&#36824;&#26159;&#30452;&#25509;&#31163;&#24320;&#12290;</p><p>&#20195;&#30721;&#31034;&#20363; 5-11<span class="&#27880;&#37322;&#32534;&#21495;">22</span> &#26159;&#19968;&#20010; <code>CommandLineRunner</code> &#30340;&#23454;&#29616;&#65292;&#23427;&#30340;&#20316;&#29992;&#26159;&#25171;&#21360;&#25152;&#26377;&#30340;&#21629;&#20196;&#34892;&#21442;&#25968;&#65292;&#20854;&#20013;&#30340;&#26085;&#24535;&#36755;&#20986;&#36890;&#36807; Lombok &#30340; <code>@Slf4j</code> &#25351;&#23450;&#20102;&#20351;&#29992; SLF4J &#26085;&#24535;&#26694;&#26550;&#65292;&#26080;&#39035;&#25105;&#20204;&#33258;&#24049;&#23450;&#20041; <code>log</code> &#25104;&#21592;&#21464;&#37327;&#12290;</p><p class="&#27880;&#37322;&#20869;&#23481;"><span class="&#27880;&#37322;&#32534;&#21495;&#19979;">22</span>&#36825;&#20010;&#20363;&#23376;&#22312; ch5/customer &#39033;&#30446;&#20013;&#12290;</p><blockquote>
<p><strong>&#20195;&#30721;&#31034;&#20363; 5-11</strong>&#12288;<code>ArgsPrinterRunner</code> &#20195;&#30721;&#29255;&#27573;</p>
</blockquote><pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>@Component
@Slf4j
@Order(1)
public class ArgsPrinterRunner implements CommandLineRunner {
    @Override
    public void run(String... args) throws Exception {
        log.info("&#20849;&#20256;&#20837;&#20102;{}&#20010;&#21442;&#25968;&#12290;&#20998;&#21035;&#26159;&#65306;{}", args.length, StringUtils.arrayToCommaDelimitedString(args));
    }
}</code></pre><p>&#20195;&#30721;&#31034;&#20363; 5-12 &#26159;&#19968;&#20010; <code>ApplicationRunner</code> &#30340;&#23454;&#29616;&#65292;&#23427;&#20250;&#26681;&#25454;&#21629;&#20196;&#34892;&#19978;&#20256;&#20837;&#30340;&#21442;&#25968;&#26469;&#20915;&#23450;&#26159;&#21542;&#31561;&#24453;&#65292;&#22914;&#26524;&#25105;&#20204;&#36890;&#36807; <code>wait</code> &#36873;&#39033;&#35774;&#32622;&#20102;&#31561;&#24453;&#26102;&#38388;&#65292;&#21017;&#31561;&#24453;&#26102;&#38388;&#21363;&#20026;&#31243;&#24207;&#37324; <code>sleep</code> &#23545;&#24212;&#30340;&#31186;&#25968;&#65292;&#27809;&#26377; <code>wait</code> &#23601;&#30452;&#25509;&#32467;&#26463;&#12290;&#20854;&#20013;&#28436;&#31034;&#20102;&#20960;&#20010;&#26041;&#27861;&#65306;</p><ul>
<li class="&#31532;1&#32423;&#26080;&#24207;&#21015;&#34920;"><strong><code>containsOption()</code></strong>&#65292;&#26159;&#21542;&#21253;&#21547;&#25351;&#23450;&#36873;&#39033;&#65288;&#25152;&#35859;&#36873;&#39033;&#65292;&#20854;&#24418;&#24335;&#26159; <code>--</code> &#36873;&#39033;&#21517; <code>=</code> &#20540;&#65289;&#65307;</li>
<li class="&#31532;1&#32423;&#26080;&#24207;&#21015;&#34920;"><strong><code>getOptionValues()</code></strong>&#65292;&#33719;&#21462;&#25351;&#23450;&#36873;&#39033;&#30340;&#20540;&#65292;&#36820;&#22238;&#30340;&#26159;&#19968;&#20010; <code>List</code>&#65292;&#22240;&#20026;&#21487;&#20197;&#22810;&#27425;&#35774;&#20540;&#65292;&#20363;&#22914; <code>--wait=5--wait=6</code>&#65307;</li>
<li class="&#31532;1&#32423;&#26080;&#24207;&#21015;&#34920;"><strong><code>getNonOptionArgs()</code></strong>&#65292;&#33719;&#21462;&#38750;&#36873;&#39033;&#31867;&#22411;&#30340;&#20854;&#20182;&#21442;&#25968;&#12290;</li>
</ul><blockquote>
<p><strong>&#20195;&#30721;&#31034;&#20363; 5-12</strong>&#12288;<code>WaitForOpenRunner</code> &#20195;&#30721;&#29255;&#27573;</p>
</blockquote><pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>@Component
@Slf4j
@Order(2)
public class WaitForOpenRunner implements ApplicationRunner {
    @Override

    public void run(ApplicationArguments args) throws Exception {
        boolean needWait = args.containsOption("wait");
        if (!needWait) {
            log.info("&#22914;&#26524;&#27809;&#24320;&#38376;&#65292;&#23601;&#19981;&#29992;&#31561;&#20102;&#12290;");
            return;
        }
        List&lt;String&gt; waitSeconds = args.getOptionValues("wait");
        if (!waitSeconds.isEmpty()) {
            int seconds = NumberUtils.parseNumber(waitSeconds.get(0), Integer.class);
            log.info("&#36824;&#27809;&#24320;&#38376;&#65292;&#20808;&#31561;{}&#31186;&#12290;", seconds);
            Thread.sleep(seconds * 1000);
        }

        log.info("&#20854;&#20182;&#21442;&#25968;&#65306;{}",StringUtils.collectionToCommaDelimitedString(args.getNonOptionArgs()));
    }
}</code></pre><p>&#20351;&#29992; <code>mvn clean package -Dmaven.test.skip</code> &#21629;&#20196;&#25171;&#21253;&#21518;&#65292;&#36890;&#36807;&#22914;&#19979;&#21629;&#20196;&#21551;&#21160;&#31243;&#24207;&#65306;</p><pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>&#9656; java -jar target/customer-0.0.1-SNAPSHOT.jar --wait=3 Hello</code></pre><p>&#36816;&#34892;&#30340;&#32467;&#26524;&#24212;&#35813;&#19982;&#19979;&#38754;&#30340;&#36755;&#20986;&#31867;&#20284;&#65306;</p><pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>INFO 85578 --- [main] l.spring.customer.CustomerApplication : Started CustomerApplication in 1.059
seconds (JVM running for 1.482)
INFO 85578 --- [main] l.spring.customer.ArgsPrinterRunner : &#20849;&#20256;&#20837;&#20102;2&#20010;&#21442;&#25968;&#12290;&#20998;&#21035;&#26159;&#65306;--wait=3,Hello
INFO 85578 --- [main] l.spring.customer.WaitForOpenRunner : &#20934;&#22791;&#31561;&#24453;3&#31186;&#12290;
INFO 85578 --- [main] l.spring.customer.WaitForOpenRunner : &#20854;&#20182;&#21442;&#25968;&#65306;Hello</code></pre><p>&#31243;&#24207;&#36864;&#20986;&#26102;&#21487;&#20197;&#25351;&#23450;&#19968;&#20010;&#36864;&#20986;&#30721;&#65292;&#22312; Linux &#25110; macOS &#25805;&#20316;&#31995;&#32479;&#20013;&#65292;&#21487;&#20197;&#29992; <code>echo $?</code> &#21629;&#20196;&#30475;&#21040;&#19978;&#19968;&#26465;&#21629;&#20196;&#30340;&#36864;&#20986;&#30721;&#12290;&#36890;&#24120;&#65292;&#36864;&#20986;&#30721; <code>0</code> &#34920;&#31034;<strong>&#27491;&#24120;&#32467;&#26463;</strong>&#65292;&#20854;&#20182;&#30340;&#36864;&#20986;&#30721;&#37117;&#34920;&#31034;<strong>&#38750;&#27491;&#24120;&#32467;&#26463;</strong>&#12290;&#22312; Shell &#33050;&#26412;&#20013;&#24448;&#24448;&#37117;&#20250;&#26681;&#25454;&#26576;&#26465;&#21629;&#20196;&#30340;&#36864;&#20986;&#30721;&#20915;&#23450;&#21518;&#32493;&#30340;&#21160;&#20316;&#12290;</p><p>&#22312; Java &#37324;&#65292;&#21487;&#20197;&#35843;&#29992; <code>System.exit()</code> &#36864;&#20986;&#31243;&#24207;&#65292;&#36825;&#20010;&#26041;&#27861;&#33021;&#22815;&#20256;&#20837;&#38656;&#35201;&#36820;&#22238;&#30340;&#36864;&#20986;&#30721;&#12290;Spring Boot &#20026;&#25105;&#20204;&#25552;&#20379;&#20102; <code>ExitCodeGenerator</code> &#25509;&#21475;&#65292;&#36890;&#36807;&#23454;&#29616;&#35813;&#25509;&#21475;&#25105;&#20204;&#21487;&#20197;&#21152;&#20837;&#33258;&#24049;&#30340;&#36923;&#36753;&#26469;&#25511;&#21046;&#36864;&#20986;&#30721;&#65292;&#22914;&#26524;&#23384;&#22312;&#22810;&#20010; Bean&#65292;&#21487;&#20197;&#21644;&#21069;&#25991;&#19968;&#26679;&#29992; <code>@Order</code> &#27880;&#35299;&#25110; <code>Ordered</code> &#25509;&#21475;&#26469;&#25511;&#21046;&#39034;&#24207;&#12290;&#35843;&#29992; <code>SpringApplication.exit()</code> &#26041;&#27861;&#21363;&#21487;&#33719;&#24471;&#26368;&#32456;&#35745;&#31639;&#20986;&#30340;&#36864;&#20986;&#30721;&#65292;&#25226;&#23427;&#20256;&#20837; <code>System.exit()</code> &#23601;&#21487;&#20197;&#20102;&#12290;</p><p>&#20316;&#20026;&#32463;&#33829;&#32773;&#65292;&#25105;&#20204;&#24403;&#28982;&#26159;&#24076;&#26395;&#39038;&#23458;&#26469;&#33258;&#24049;&#24215;&#37324;&#65292;&#32780;&#19988;&#22914;&#26524;&#39038;&#23458;&#24895;&#24847;&#31561;&#25105;&#20204;&#24320;&#38376;&#26368;&#22909;&#20102;&#65292;&#20026;&#27492;&#65292;&#25105;&#20204;&#32534;&#20889;&#19968;&#20010;&#33258;&#24049;&#30340; <code>ExitCodeGenerator</code> &#23454;&#29616;&#65292;&#21629;&#20196;&#34892;&#37324;&#25552;&#20379;&#20102; <code>wait</code> &#36873;&#39033;&#21017;&#35270;&#20026;&#27491;&#24120;&#65292;&#21542;&#21017;&#19981;&#27491;&#24120;&#65292;&#20855;&#20307;&#20195;&#30721;&#22914;&#20195;&#30721;&#31034;&#20363; 5-13 &#25152;&#31034;&#12290;</p><blockquote>
<p><strong>&#20195;&#30721;&#31034;&#20363; 5-13</strong>&#12288;&#30452;&#25509;&#22312; <code>@Bean</code> &#26041;&#27861;&#20013;&#23454;&#29616; <code>ExitCodeGenerator</code></p>
</blockquote><pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>@SpringBootApplication
public class CustomerApplication {

    public static void main(String[] args) {
        SpringApplication.run(CustomerApplication.class, args);
    }

    /**
     * &#22914;&#26524;&#21629;&#20196;&#34892;&#37324;&#32473;&#20102;wait&#36873;&#39033;&#65292;&#36820;&#22238;0&#65292;&#21542;&#21017;&#36820;&#22238;1
    */
    @Bean
    public ExitCodeGenerator waitExitCodeGenerator(ApplicationArguments args) {
        return () -&gt; (args.containsOption("wait") ? 0 : 1);
    }
}</code></pre><p>&#26694;&#26550;&#20250;&#33258;&#21160;&#25226;&#19978;&#19979;&#25991;&#20013;&#30340; ApplicationArguments &#20316;&#20026;&#21442;&#25968;&#20256;&#20837; waitExitCodeGenerator()&#65292;&#36825;&#37324;&#21462;&#21040;&#30340;&#20540;&#21644;&#25105;&#20204;&#22312; ApplicationRunner &#37324;&#21462;&#21040;&#30340;&#20540;&#26159;&#19968;&#26679;&#30340;&#12290;</p><p>&#38543;&#21518;&#65292;&#31616;&#21333;&#35843;&#25972;&#19968;&#19979; <code>WaitForOpenRunner</code>&#65292;&#22312;&#25191;&#34892;&#23436;&#26085;&#24535;&#36755;&#20986;&#21518;&#35843;&#29992;&#36864;&#20986;&#36923;&#36753;&#65292;&#22914;&#20195;&#30721;&#31034;&#20363; 5-14 &#25152;&#31034;&#12290;<code>SpringApplication.exit()</code> &#38656;&#35201;&#20256;&#20837; <code>ApplicationContext</code>&#65292;&#22240;&#27492;&#25105;&#20204;&#35753; <code>WaitForOpenRunner</code> &#23454;&#29616; <code>ApplicationContextAware</code>&#65292;&#36825;&#37324;&#30340; <code>Setter</code> &#26041;&#27861;&#30452;&#25509;&#36890;&#36807; Lombok &#30340; <code>@Setter</code> &#26469;&#23454;&#29616;&#12290;</p><blockquote>
<p><strong>&#20195;&#30721;&#31034;&#20363; 5-14</strong>&#12288;&#35843;&#25972;&#21518;&#30340; <code>WaitForOpenRunner</code> &#20195;&#30721;&#29255;&#27573;</p>
</blockquote><pre class="&#20195;&#30721;&#26080;&#34892;&#21495;"><code>@Component
@Slf4j
@Order(2)
public class WaitForOpenRunner implements ApplicationRunner, ApplicationContextAware {
    @Setter
    private ApplicationContext applicationContext;

    @Override
    public void run(ApplicationArguments args) throws Exception {
        boolean needWait = args.containsOption("wait");
        if (!needWait) {
            log.info("&#22914;&#26524;&#27809;&#24320;&#38376;&#65292;&#23601;&#19981;&#29992;&#31561;&#20102;&#12290;");
        } else {
            List&lt;String&gt; waitSeconds = args.getOptionValues("wait");
            if (!waitSeconds.isEmpty()) {
                int seconds = NumberUtils.parseNumber(waitSeconds.get(0), Integer.class);
                log.info("&#36824;&#27809;&#24320;&#38376;&#65292;&#20808;&#31561;{}&#31186;&#12290;", seconds);
                Thread.sleep(seconds * 1000);
            }

            log.info("&#20854;&#20182;&#21442;&#25968;&#65306;{}", StringUtils.collectionToCommaDelimitedString(args.getNonOptionArgs()));
        }

        System.exit(SpringApplication.exit(applicationContext));
    }
}</code></pre><p>&#29616;&#22312;&#37325;&#26032;&#25171;&#21253;&#36816;&#34892;&#25105;&#20204;&#30340;&#31243;&#24207;&#65292;&#22914;&#26524;&#21629;&#20196;&#34892;&#37324;&#27809;&#26377; <code>--wait</code>&#65292;&#36864;&#20986;&#30721;&#23601;&#26159; <code>1</code>&#12290;</p><blockquote>
<p><strong>&#33590;&#27463;&#26102;&#38388;&#65306;&#36890;&#36807; Lombok &#31616;&#21270;&#20195;&#30721;</strong></p>
<p>&#30456;&#20449;&#21482;&#35201;&#26159;&#20889;&#36807; Java &#30340;&#20154;&#37117;&#20250;&#20889;&#36807; <code>Getter</code> &#21644; <code>Setter</code> &#26041;&#27861;&#65292;&#34429;&#28982;&#32477;&#22823;&#22810;&#25968;&#20154;&#20250;&#36873;&#25321;&#35753; IDE &#26469;&#33258;&#21160;&#29983;&#25104;&#65292;&#20294;&#26412;&#30528;&#8220;&#25042;&#24816;&#26159;&#31243;&#24207;&#21592;&#30340;&#31532;&#19968;&#22823;&#32654;&#24503;&#8221;&#30340;&#29702;&#24565;&#65292;&#33021;&#19981;&#35201;&#36825;&#20123;&#20195;&#30721;&#65292;&#25105;&#20204;&#36824;&#26159;&#24076;&#26395;&#23601;&#19981;&#20986;&#29616;&#36825;&#20123;&#20195;&#30721;&#12290;&#19982;&#20043;&#31867;&#20284;&#30340;&#36824;&#26377;&#31616;&#21333;&#30340;&#29992;&#20110;&#25104;&#21592;&#21464;&#37327;&#36171;&#20540;&#30340;&#26500;&#36896;&#26041;&#27861;&#12289;<code>Logger</code> &#23545;&#35937;&#30340;&#23450;&#20041;&#35821;&#21477;&#31561;&#12290;</p>
<p>Lombok<span class="&#27880;&#37322;&#32534;&#21495;">23</span> &#23601;&#26159;&#36825;&#26679;&#19968;&#20010;&#35299;&#25918;&#29983;&#20135;&#21147;&#30340;&#21033;&#22120;&#65292;&#23427;&#36890;&#36807;&#19968;&#31995;&#21015;&#27880;&#35299;&#28040;&#28781;&#20102;&#19978;&#36848;&#20887;&#38271;&#32321;&#29712;&#30340;&#35821;&#21477;&#12290;&#24120;&#29992;&#30340;&#19968;&#20123;&#27880;&#35299;&#22914;&#34920; 5-15 &#25152;&#31034;&#12290;</p>
<p><strong>&#34920; 5-15&#12288;&#24120;&#29992;&#30340; Lombok &#27880;&#35299;</strong></p>
</blockquote><p class="&#27880;&#37322;&#20869;&#23481;"><span class="&#27880;&#37322;&#32534;&#21495;&#19979;">23</span>&#23448;&#26041;&#39318;&#39029;&#22320;&#22336; <a href="https://projectlombok.org/">https://projectlombok.org/</a>&#12290;</p><table border="1" width="90%">
<thead>
<tr>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#27880;&#35299;</p></th>
<th><p class="&#34920;&#22836;&#21333;&#20803;&#26684;">&#20316;&#29992;</p></th>
</tr>
</thead>
<tbody>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>@Getter / @Setter</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#33258;&#21160;&#29983;&#25104;&#25104;&#21592;&#23646;&#24615;&#30340; <code>Getter</code> &#21644; <code>Setter</code> &#26041;&#27861;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>@ToString</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#33258;&#21160;&#29983;&#25104; <code>toString()</code> &#26041;&#27861;&#65292;&#40664;&#35748;&#25340;&#25509;&#25152;&#26377;&#30340;&#25104;&#21592;&#23646;&#24615;&#65292;&#20063;&#21487;&#20197;&#25490;&#38500;&#25351;&#23450;&#30340;&#23646;&#24615;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>@NoArgsConstructor</code> / <code>@RequiredArgsConstructor</code> / <code>@AllArgsConstructor</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#33258;&#21160;&#29983;&#25104;&#26080;&#21442;&#25968;&#30340;&#26500;&#36896;&#26041;&#27861;&#65292;&#24517;&#35201;&#21442;&#25968;&#30340;&#26500;&#36896;&#26041;&#27861;&#20197;&#21450;&#21253;&#21547;&#20840;&#37096;&#21442;&#25968;&#30340;&#26500;&#36896;&#26041;&#27861;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>@EqualsAndHashCode</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#33258;&#21160;&#29983;&#25104; <code>equals()</code> &#19982; <code>hashCode()</code> &#26041;&#27861;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>@Data</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#30456;&#24403;&#20110;&#28155;&#21152;&#20102; <code>@ToString</code>&#12289;<code>@EqualsAndHashCode</code>&#12289;<code>@Getter</code>&#12289;<code>@Setter</code> &#21644; <code>@RequiredArgsConstructor</code> &#27880;&#35299;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>@Builder</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#25552;&#20379;&#20102;&#19968;&#20010;&#28789;&#27963;&#30340;&#26500;&#36896;&#22120;&#65292;&#33021;&#22815;&#35774;&#32622;&#21508;&#20010;&#25104;&#21592;&#21464;&#37327;&#65292;&#20877;&#25454;&#27492;&#21019;&#24314;&#23545;&#35937;&#23454;&#20363;</p></td>
</tr>
<tr>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;"><code>@Slf4j</code> / <code>@CommonsLog</code> / <code>@Log4j2</code></p></td>
<td><p class="&#34920;&#26684;&#21333;&#20803;&#26684;">&#33258;&#21160;&#29983;&#25104;&#23545;&#24212;&#26085;&#24535;&#26694;&#26550;&#30340;&#26085;&#24535;&#31867;&#65292;&#20363;&#22914;&#23450;&#20041;&#20102;&#19968;&#20010; <code>Logger</code> &#31867;&#22411;&#30340; <code>log</code>&#65292;&#26041;&#20415;&#36755;&#20986;&#26085;&#24535;</p></td>
</tr>
</tbody>
</table><p>&#38656;&#35201;&#27880;&#24847;&#30340;&#26159;&#65292;&#34429;&#28982;&#32534;&#35793;&#26102;&#27809;&#26377;&#20160;&#20040;&#29305;&#27530;&#35774;&#32622;&#65292;&#20294;&#22312; IDE &#20013;&#65292;&#20026;&#20102;&#24320;&#21551;&#23545; Lombok &#30340;&#25903;&#25345;&#65292;&#25105;&#20204;&#38656;&#35201;&#23433;&#35013;&#23545;&#24212; IDE &#30340; Lombok &#25554;&#20214;&#65292;&#20363;&#22914;&#65292;IDEA &#20013;&#35201;&#23433;&#35013; IntelliJ Lombok plugin&#12290;</p><h2 id="nav_point_88">5.4&#12288;&#23567;&#32467;</h2><p>&#26412;&#31456;&#25105;&#20204;&#23398;&#20064;&#20102; Spring Boot &#25552;&#20379;&#30340;&#38754;&#21521;&#29983;&#20135;&#29615;&#22659;&#30340;&#35832;&#22810;&#21151;&#33021;&#65292;&#20363;&#22914;&#65292;Spring Boot Actuator &#30340;&#21508;&#31181;&#31471;&#28857;&#65292;&#22914;&#20309;&#33258;&#24049;&#23450;&#21046;&#20581;&#24247;&#26816;&#26597;&#20449;&#24687;&#12290;&#36824;&#23398;&#20064;&#20102;&#29983;&#20135;&#29615;&#22659;&#20013;&#25152;&#24517;&#19981;&#21487;&#23569;&#30340;&#24230;&#37327;&#26041;&#27861;&#65292;&#36890;&#36807; Micrometer &#36755;&#20986;&#21508;&#31181;&#20869;&#23481;&#65292;&#24110;&#21161;&#25105;&#20204;&#20102;&#35299;&#31995;&#32479;&#30340;&#36816;&#34892;&#24773;&#20917;&#12290;&#26368;&#21518;&#65292;&#25226;&#24320;&#21457;&#22909;&#30340;&#20195;&#30721;&#25171;&#21253;&#25104;&#20102;&#23454;&#38469;&#21487;&#20197;&#37096;&#32626;&#30340; Jar &#21253;&#65292;Spring Boot &#30340; Jar &#21253;&#21487;&#20197;&#30452;&#25509;&#25191;&#34892;&#65292;&#25105;&#20204;&#23545;&#36825;&#32972;&#21518;&#30340;&#21407;&#29702;&#20063;&#20570;&#20102;&#35828;&#26126;&#12290;&#38500;&#27492;&#20043;&#22806;&#65292;&#36824;&#32842;&#20102;&#32842;&#24590;&#20040;&#32534;&#20889;&#29992;&#26469;&#21551;&#21160;&#25972;&#20010;&#24037;&#31243;&#30340; <code>SpringAppliation</code> &#20195;&#30721;&#65292;&#25511;&#21046;&#25972;&#20010;&#21551;&#21160;&#21644;&#36816;&#34892;&#30340;&#36923;&#36753;&#12290;</p><p>&#22312;&#20195;&#30721;&#31034;&#20363;&#20013;&#65292;&#25105;&#20204;&#31532;&#19968;&#27425;&#24341;&#20837;&#20102; Lombok&#65292;&#23427;&#21487;&#20197;&#22312;&#24456;&#22823;&#31243;&#24230;&#19978;&#31616;&#21270;&#25105;&#20204;&#30340;&#20195;&#30721;&#65292;&#22312;&#26085;&#24120;&#24037;&#20316;&#20013;&#20063;&#24378;&#28872;&#24314;&#35758;&#22823;&#23478;&#20351;&#29992;&#12290;</p><p>&#20840;&#20070;&#30340;&#31532;&#19968;&#37096;&#20998;&#21040;&#27492;&#23601;&#21578;&#19968;&#27573;&#33853;&#20102;&#65292;&#25105;&#20204;&#23398;&#20064;&#20102; Spring Framework &#19982; Spring Boot &#30340;&#19968;&#20123;&#22522;&#30784;&#30693;&#35782;&#21644;&#29992;&#27861;&#65292;&#20174;&#19979;&#19968;&#31456;&#24320;&#22987;&#65292;&#25105;&#20204;&#23558;&#36827;&#20837;&#26032;&#30340;&#29615;&#33410;&#65292;&#32534;&#20889;&#19982;&#25968;&#25454;&#24211;&#20132;&#20114;&#30340;&#31995;&#32479;&#12290;</p><blockquote>
<p style="text-align: center"><strong>&#20108;&#36827;&#21046;&#22902;&#33590;&#24215;&#39033;&#30446;&#24320;&#21457;&#36827;&#24230;</strong></p>
<p>&#26412;&#31456;&#25105;&#20204;&#20026;&#20108;&#36827;&#21046;&#22902;&#33590;&#24215;&#30340;&#31243;&#24207;&#22686;&#21152;&#20102;&#19968;&#20123;&#38754;&#21521;&#29983;&#20135;&#29615;&#22659;&#30340;&#21151;&#33021;&#65306;</p>
<ul>
<li class="&#31532;2&#32423;&#26080;&#24207;&#21015;&#34920;">&#28155;&#21152;&#20102;&#21487;&#22312;&#36816;&#34892;&#26102;&#20102;&#35299;&#33829;&#19994;&#24773;&#20917;&#30340;&#20581;&#24247;&#26816;&#26597;&#39033;&#21644;&#31471;&#28857;&#65307;</li>
<li class="&#31532;2&#32423;&#26080;&#24207;&#21015;&#34920;">&#28155;&#21152;&#20102;&#21487;&#33719;&#24471;&#32047;&#35745;&#33829;&#25910;&#24773;&#20917;&#30340;&#30417;&#25511;&#39033;&#12290;</li>
</ul>
<p>&#27492;&#22806;&#65292;&#25105;&#20204;&#36824;&#21021;&#22987;&#21270;&#20102;&#20195;&#34920;&#39038;&#23458;&#30340; Customer &#24037;&#31243;&#65292;&#23427;&#30446;&#21069;&#21487;&#20197;&#25509;&#21463;&#19968;&#20123;&#21629;&#20196;&#34892;&#21442;&#25968;&#65292;&#21028;&#26029;&#26159;&#21542;&#31561;&#24453;&#24215;&#38138;&#24320;&#38376;&#12290;</p>
</blockquote><br style="page-break-after:always"/><div style="page-break-after:always"></div>